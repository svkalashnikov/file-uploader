/**
 * @license
 * MIT License
 * 
 * Copyright (c) 2022 Uploadcare (hello@uploadcare.com). All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
var Gi=Object.defineProperty;var mr=(s,i,t)=>i in s?Gi(s,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[i]=t;var fr=(s,i)=>{for(var t in i)Gi(s,t,{get:i[t],enumerable:!0})};var c=(s,i,t)=>(mr(s,typeof i!="symbol"?i+"":i,t),t),_i=(s,i,t)=>{if(!i.has(s))throw TypeError("Cannot "+t)};var L=(s,i,t)=>(_i(s,i,"read from private field"),t?t.call(s):i.get(s)),Tt=(s,i,t)=>{if(i.has(s))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(s):i.set(s,t)},ie=(s,i,t,e)=>(_i(s,i,"write to private field"),e?e.call(s,t):i.set(s,t),t);var Fe=(s,i,t)=>(_i(s,i,"access private method"),t);var fi={};fr(fi,{ActivityBlock:()=>g,ActivityHeader:()=>mi,BaseComponent:()=>Et,Block:()=>f,CameraSource:()=>fe,CloudEditor:()=>vt,CloudImageEditor:()=>pi,ConfirmationDialog:()=>_e,Copyright:()=>Pe,CropFrame:()=>Ce,Data:()=>E,DataOutput:()=>Lt,DropArea:()=>Gt,EditorCropButtonControl:()=>Ot,EditorFilterControl:()=>yt,EditorImageCropper:()=>$e,EditorImageFader:()=>ui,EditorOperationControl:()=>Ut,EditorScroller:()=>ke,EditorSlider:()=>we,EditorToolbar:()=>Se,ExternalSource:()=>Ue,FileItem:()=>tt,FilePreview:()=>Yt,FileUploaderInline:()=>Me,FileUploaderMinimal:()=>Ne,FileUploaderRegular:()=>De,Icon:()=>jt,Img:()=>ii,LineLoaderUi:()=>Ie,LrBtnUi:()=>Jt,MessageBox:()=>ue,Modal:()=>P,PACKAGE_NAME:()=>Mi,PACKAGE_VERSION:()=>Bi,PresenceToggle:()=>Re,ProgressBar:()=>ve,ProgressBarCommon:()=>be,Select:()=>Le,ShadowWrapper:()=>te,SimpleBtn:()=>he,SliderUi:()=>Oe,SourceBtn:()=>qt,SourceList:()=>ri,StartFrom:()=>si,Tabs:()=>Qt,UploadCtxProvider:()=>ni,UploadDetails:()=>ge,UploadList:()=>pe,UploaderBlock:()=>b,UrlSource:()=>me,Video:()=>K,connectBlocksFrom:()=>dr,registerBlocks:()=>ee});var gr=Object.defineProperty,_r=(s,i,t)=>i in s?gr(s,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[i]=t,vi=(s,i,t)=>(_r(s,typeof i!="symbol"?i+"":i,t),t);function br(s){let i=t=>{var e;for(let r in t)((e=t[r])==null?void 0:e.constructor)===Object&&(t[r]=i(t[r]));return{...t}};return i(s)}var E=class{constructor(s){s.constructor===Object?this.store=br(s):(this._storeIsProxy=!0,this.store=s),this.callbackMap=Object.create(null)}static warn(s,i){console.warn(`Symbiote Data: cannot ${s}. Prop name: `+i)}read(s){return!this._storeIsProxy&&!this.store.hasOwnProperty(s)?(E.warn("read",s),null):this.store[s]}has(s){return this._storeIsProxy?this.store[s]!==void 0:this.store.hasOwnProperty(s)}add(s,i,t=!1){!t&&Object.keys(this.store).includes(s)||(this.store[s]=i,this.notify(s))}pub(s,i){if(!this._storeIsProxy&&!this.store.hasOwnProperty(s)){E.warn("publish",s);return}this.store[s]=i,this.notify(s)}multiPub(s){for(let i in s)this.pub(i,s[i])}notify(s){this.callbackMap[s]&&this.callbackMap[s].forEach(i=>{i(this.store[s])})}sub(s,i,t=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(s)?(E.warn("subscribe",s),null):(this.callbackMap[s]||(this.callbackMap[s]=new Set),this.callbackMap[s].add(i),t&&i(this.store[s]),{remove:()=>{this.callbackMap[s].delete(i),this.callbackMap[s].size||delete this.callbackMap[s]},callback:i})}static registerCtx(s,i=Symbol()){let t=E.globalStore.get(i);return t?console.warn('State: context UID "'+i+'" already in use'):(t=new E(s),E.globalStore.set(i,t)),t}static deleteCtx(s){E.globalStore.delete(s)}static getCtx(s,i=!0){return E.globalStore.get(s)||(i&&console.warn('State: wrong context UID - "'+s+'"'),null)}};E.globalStore=new Map;var y=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),Yi="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",vr=Yi.length-1,re=class{static generate(s="XXXXXXXXX-XXX"){let i="";for(let t=0;t<s.length;t++)i+=s[t]==="-"?s[t]:Yi.charAt(Math.random()*vr);return i}};function Zi(s,i,t){let e=!0,r,n=i.split(".");return n.forEach((o,a)=>{a<n.length-1?s=s[o]:r=o}),s?s[r]=t:e=!1,e}function yr(s){return s.split("-").map((i,t)=>i&&t?i[0].toUpperCase()+i.slice(1):i).join("").split("_").map((i,t)=>i&&t?i.toUpperCase():i).join("")}function Cr(s,i){[...s.querySelectorAll(`[${y.REPEAT_ATTR}]`)].forEach(t=>{let e=t.getAttribute(y.REPEAT_ITEM_TAG_ATTR),r;if(e&&(r=window.customElements.get(e)),!r){r=class extends i.BaseComponent{constructor(){super(),e||(this.style.display="contents")}};let o=t.innerHTML;r.template=o,r.reg(e)}for(;t.firstChild;)t.firstChild.remove();let n=t.getAttribute(y.REPEAT_ATTR);i.sub(n,o=>{if(!o){for(;t.firstChild;)t.firstChild.remove();return}let a=[...t.children],l,h=u=>{u.forEach((p,m)=>{if(a[m])if(a[m].set$)setTimeout(()=>{a[m].set$(p)});else for(let _ in p)a[m][_]=p[_];else{l||(l=new DocumentFragment);let _=new r;Object.assign(_.init$,p),l.appendChild(_)}}),l&&t.appendChild(l);let d=a.slice(u.length,a.length);for(let p of d)p.remove()};if(o.constructor===Array)h(o);else if(o.constructor===Object){let u=[];for(let d in o){let p=o[d];Object.defineProperty(p,"_KEY_",{value:d,enumerable:!0}),u.push(p)}h(u)}else console.warn("Symbiote repeat data type error:"),console.log(o)}),t.removeAttribute(y.REPEAT_ATTR),t.removeAttribute(y.REPEAT_ITEM_TAG_ATTR)})}var qi="__default__";function xr(s,i){if(i.shadowRoot)return;let t=[...s.querySelectorAll("slot")];if(!t.length)return;let e={};t.forEach(r=>{let n=r.getAttribute("name")||qi;e[n]={slot:r,fr:document.createDocumentFragment()}}),i.initChildren.forEach(r=>{var n;let o=qi;r instanceof Element&&r.hasAttribute("slot")&&(o=r.getAttribute("slot"),r.removeAttribute("slot")),(n=e[o])==null||n.fr.appendChild(r)}),Object.values(e).forEach(r=>{if(r.fr.childNodes.length)r.slot.parentNode.replaceChild(r.fr,r.slot);else if(r.slot.childNodes.length){let n=document.createDocumentFragment();n.append(...r.slot.childNodes),r.slot.parentNode.replaceChild(n,r.slot)}else r.slot.remove()})}function wr(s,i){[...s.querySelectorAll(`[${y.EL_REF_ATTR}]`)].forEach(t=>{let e=t.getAttribute(y.EL_REF_ATTR);i.ref[e]=t,t.removeAttribute(y.EL_REF_ATTR)})}function Tr(s,i){[...s.querySelectorAll(`[${y.BIND_ATTR}]`)].forEach(t=>{let r=t.getAttribute(y.BIND_ATTR).split(";");[...t.attributes].forEach(n=>{if(n.name.startsWith("-")&&n.value){let o=yr(n.name.replace("-",""));r.push(o+":"+n.value),t.removeAttribute(n.name)}}),r.forEach(n=>{if(!n)return;let o=n.split(":").map(u=>u.trim()),a=o[0],l;a.indexOf(y.ATTR_BIND_PRFX)===0&&(l=!0,a=a.replace(y.ATTR_BIND_PRFX,""));let h=o[1].split(",").map(u=>u.trim());for(let u of h){let d;u.startsWith("!!")?(d="double",u=u.replace("!!","")):u.startsWith("!")&&(d="single",u=u.replace("!","")),i.sub(u,p=>{d==="double"?p=!!p:d==="single"&&(p=!p),l?(p==null?void 0:p.constructor)===Boolean?p?t.setAttribute(a,""):t.removeAttribute(a):t.setAttribute(a,p):Zi(t,a,p)||(t[y.SET_LATER_KEY]||(t[y.SET_LATER_KEY]=Object.create(null)),t[y.SET_LATER_KEY][a]=p)})}}),t.removeAttribute(y.BIND_ATTR)})}var Ve="{{",se="}}",Er="skip-text";function Ar(s){let i,t=[],e=document.createTreeWalker(s,NodeFilter.SHOW_TEXT,{acceptNode:r=>{var n;return!((n=r.parentElement)!=null&&n.hasAttribute(Er))&&r.textContent.includes(Ve)&&r.textContent.includes(se)&&1}});for(;i=e.nextNode();)t.push(i);return t}var $r=function(s,i){Ar(s).forEach(e=>{let r=[],n;for(;e.textContent.includes(se);)e.textContent.startsWith(Ve)?(n=e.textContent.indexOf(se)+se.length,e.splitText(n),r.push(e)):(n=e.textContent.indexOf(Ve),e.splitText(n)),e=e.nextSibling;r.forEach(o=>{let a=o.textContent.replace(Ve,"").replace(se,"");o.textContent="",i.sub(a,l=>{o.textContent=l})})})},kr=[Cr,xr,wr,Tr,$r],ze="'",Dt='"',Sr=/\\([0-9a-fA-F]{1,6} ?)/g;function Ir(s){return(s[0]===Dt||s[0]===ze)&&(s[s.length-1]===Dt||s[s.length-1]===ze)}function Rr(s){return(s[0]===Dt||s[0]===ze)&&(s=s.slice(1)),(s[s.length-1]===Dt||s[s.length-1]===ze)&&(s=s.slice(0,-1)),s}function Or(s){let i="",t="";for(var e=0;e<s.length;e++){let r=s[e+1];s[e]==="\\"&&r==='"'?(i+='\\"',e++):s[e]==='"'&&t!=="\\"?i+='\\"':i+=s[e],t=s[e]}return i}function Ur(s){let i=s;Ir(s)&&(i=Rr(i),i=i.replace(Sr,(t,e)=>String.fromCodePoint(parseInt(e.trim(),16))),i=i.replaceAll(`\\
`,"\\n"),i=Or(i),i=Dt+i+Dt);try{return JSON.parse(i)}catch{throw new Error(`Failed to parse CSS property value: ${i}. Original input: ${s}`)}}var Ki=0,Pt=null,at=null,dt=class extends HTMLElement{constructor(){super(),vi(this,"updateCssData",()=>{var s;this.dropCssDataCache(),(s=this.__boundCssProps)==null||s.forEach(i=>{let t=this.getCssData(this.__extractCssName(i),!0);t!==null&&this.$[i]!==t&&(this.$[i]=t)})}),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return dt}initCallback(){}__initCallback(){var s;this.__initialized||(this.__initialized=!0,(s=this.initCallback)==null||s.call(this))}render(s,i=this.renderShadow){let t;if((i||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.allowCustomTemplate){let r=this.getAttribute(y.USE_TPL);if(r){let n=this.getRootNode(),o=(n==null?void 0:n.querySelector(r))||document.querySelector(r);o?s=o.content.cloneNode(!0):console.warn(`Symbiote template "${r}" is not found...`)}}if(this.processInnerHtml)for(let r of this.tplProcessors)r(this,this);if(s||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(s==null?void 0:s.constructor)===DocumentFragment)t=s;else if((s==null?void 0:s.constructor)===String){let r=document.createElement("template");r.innerHTML=s,t=r.content.cloneNode(!0)}else this.constructor.__tpl&&(t=this.constructor.__tpl.content.cloneNode(!0));for(let r of this.tplProcessors)r(t,this)}let e=()=>{t&&(i&&this.shadowRoot.appendChild(t)||this.appendChild(t)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){i=!0;let r=document.createElement("link");r.rel="stylesheet",r.href=this.constructor.__shadowStylesUrl,r.onload=e,this.shadowRoot.prepend(r)}else e()}addTemplateProcessor(s){this.tplProcessors.add(s)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=re.generate(),this.style.setProperty(y.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(y.CSS_CTX_PROP,!0)}get ctxName(){var s;let i=((s=this.getAttribute(y.CTX_NAME_ATTR))==null?void 0:s.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=i,i}get localCtx(){return this.__localCtx||(this.__localCtx=E.registerCtx({},this)),this.__localCtx}get nodeCtx(){return E.getCtx(this.ctxName,!1)||E.registerCtx({},this.ctxName)}static __parseProp(s,i){let t,e;if(s.startsWith(y.EXT_DATA_CTX_PRFX))t=i.nodeCtx,e=s.replace(y.EXT_DATA_CTX_PRFX,"");else if(s.includes(y.NAMED_DATA_CTX_SPLTR)){let r=s.split(y.NAMED_DATA_CTX_SPLTR);t=E.getCtx(r[0]),e=r[1]}else t=i.localCtx,e=s;return{ctx:t,name:e}}sub(s,i,t=!0){let e=n=>{this.isConnected&&i(n)},r=dt.__parseProp(s,this);r.ctx.has(r.name)?this.allSubs.add(r.ctx.sub(r.name,e,t)):window.setTimeout(()=>{this.allSubs.add(r.ctx.sub(r.name,e,t))})}notify(s){let i=dt.__parseProp(s,this);i.ctx.notify(i.name)}has(s){let i=dt.__parseProp(s,this);return i.ctx.has(i.name)}add(s,i,t=!1){let e=dt.__parseProp(s,this);e.ctx.add(e.name,i,t)}add$(s,i=!1){for(let t in s)this.add(t,s[t],i)}get $(){if(!this.__stateProxy){let s=Object.create(null);this.__stateProxy=new Proxy(s,{set:(i,t,e)=>{let r=dt.__parseProp(t,this);return r.ctx.pub(r.name,e),!0},get:(i,t)=>{let e=dt.__parseProp(t,this);return e.ctx.read(e.name)}})}return this.__stateProxy}set$(s,i=!1){for(let t in s){let e=s[t];i||![String,Number,Boolean].includes(e==null?void 0:e.constructor)?this.$[t]=e:this.$[t]!==e&&(this.$[t]=e)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(y.CTX_OWNER_ATTR)&&this.getAttribute(y.CTX_OWNER_ATTR)!=="false"}__initDataCtx(){let s=this.constructor.__attrDesc;if(s)for(let i of Object.values(s))Object.keys(this.init$).includes(i)||(this.init$[i]="");for(let i in this.init$)if(i.startsWith(y.EXT_DATA_CTX_PRFX))this.nodeCtx.add(i.replace(y.EXT_DATA_CTX_PRFX,""),this.init$[i],this.__ctxOwner);else if(i.includes(y.NAMED_DATA_CTX_SPLTR)){let t=i.split(y.NAMED_DATA_CTX_SPLTR),e=t[0].trim(),r=t[1].trim();if(e&&r){let n=E.getCtx(e,!1);n||(n=E.registerCtx({},e)),n.add(r,this.init$[i])}}else this.localCtx.add(i,this.init$[i]);for(let i in this.cssInit$)this.bindCssData(i,this.cssInit$[i]);this.__dataCtxInitialized=!0}connectedCallback(){var s;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let i=(s=this.getAttribute(y.CTX_NAME_ATTR))==null?void 0:s.trim();if(i&&this.style.setProperty(y.CSS_CTX_PROP,`'${i}'`),this.__initDataCtx(),this[y.SET_LATER_KEY]){for(let t in this[y.SET_LATER_KEY])Zi(this,t,this[y.SET_LATER_KEY][t]);delete this[y.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let t of kr)this.addTemplateProcessor(t);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let t=this.getRootNode();if(!t)return;if(t==null?void 0:t.querySelector(`link[${y.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`)){this.render();return}let r=this.constructor.__rootStylesLink.cloneNode(!0);r.setAttribute(y.ROOT_STYLE_ATTR_NAME,this.constructor.is),r.onload=()=>{this.render()},t.nodeType===Node.DOCUMENT_NODE?t.head.appendChild(r):t.prepend(r)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let s of this.allSubs)s.remove(),this.allSubs.delete(s);for(let s of this.tplProcessors)this.tplProcessors.delete(s);at==null||at.delete(this.updateCssData),at!=null&&at.size||(Pt==null||Pt.disconnect(),Pt=null,at=null)},100)))}static reg(s,i=!1){if(s||(Ki++,s=`${y.AUTO_TAG_PRFX}-${Ki}`),this.__tag=s,window.customElements.get(s)){console.warn(`${s} - is already in "customElements" registry`);return}window.customElements.define(s,i?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(s){this.observedAttributes=Object.keys(s),this.__attrDesc=s}attributeChangedCallback(s,i,t){var e;if(i===t)return;let r=(e=this.constructor.__attrDesc)==null?void 0:e[s];r?this.__dataCtxInitialized?this.$[r]=t:this.init$[r]=t:this[s]=t}getCssData(s,i=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(s)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let t=this.__computedStyle.getPropertyValue(s).trim();try{this.__cssDataCache[s]=Ur(t)}catch{!i&&console.warn(`CSS Data error: ${s}`),this.__cssDataCache[s]=null}}return this.__cssDataCache[s]}__extractCssName(s){return s.split("--").map((i,t)=>t===0?"":i).join("--")}__initStyleAttrObserver(){at||(at=new Set),at.add(this.updateCssData),Pt||(Pt=new MutationObserver(s=>{s[0].type==="attributes"&&at.forEach(i=>{i()})}),Pt.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}))}bindCssData(s,i=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(s);let t=this.getCssData(this.__extractCssName(s),!0);t===null&&(t=i),this.add(s,t),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(s,i,t){let e="__"+s;this[e]=this[s],Object.defineProperty(this,s,{set:r=>{this[e]=r,t?window.setTimeout(()=>{i==null||i(r)}):i==null||i(r)},get:()=>this[e]}),this[s]=this[e]}static set shadowStyles(s){let i=new Blob([s],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(i)}static set rootStyles(s){if(!this.__rootStylesLink){let i=new Blob([s],{type:"text/css"}),t=URL.createObjectURL(i),e=document.createElement("link");e.href=t,e.rel="stylesheet",this.__rootStylesLink=e}}},Et=dt;vi(Et,"template");var bi=class{static _print(s){console.warn(s)}static setDefaultTitle(s){this.defaultTitle=s}static setRoutingMap(s){Object.assign(this.appMap,s);for(let i in this.appMap)!this.defaultRoute&&this.appMap[i].default===!0?this.defaultRoute=i:!this.errorRoute&&this.appMap[i].error===!0&&(this.errorRoute=i)}static set routingEventName(s){this.__routingEventName=s}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let s={route:null,options:{}};return window.location.search.split(this.separator).forEach(t=>{if(t.includes("?"))s.route=t.replace("?","");else if(t.includes("=")){let e=t.split("=");s.options[e[0]]=decodeURI(e[1])}else s.options[t]=!0}),s}static notify(){let s=this.readAddressBar(),i=this.appMap[s.route];if(i&&i.title&&(document.title=i.title),s.route===null&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!i&&this.errorRoute){this.applyRoute(this.errorRoute);return}else if(!i&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!i){this._print(`Route "${s.route}" not found...`);return}let t=new CustomEvent(bi.routingEventName,{detail:{route:s.route,options:Object.assign(i||{},s.options)}});window.dispatchEvent(t)}static reflect(s,i={}){let t=this.appMap[s];if(!t){this._print("Wrong route: "+s);return}let e="?"+s;for(let n in i)i[n]===!0?e+=this.separator+n:e+=this.separator+n+`=${i[n]}`;let r=t.title||this.defaultTitle||"";window.history.pushState(null,r,e),document.title=r}static applyRoute(s,i={}){this.reflect(s,i),this.notify()}static setSeparator(s){this._separator=s}static get separator(){return this._separator||"&"}static createRouterData(s,i){this.setRoutingMap(i);let t=E.registerCtx({route:null,options:null,title:null},s);return window.addEventListener(this.routingEventName,e=>{var r;t.multiPub({route:e.detail.route,options:e.detail.options,title:((r=e.detail.options)==null?void 0:r.title)||this.defaultTitle||""})}),bi.notify(),this.initPopstateListener(),t}static initPopstateListener(){this.__onPopstate||(this.__onPopstate=()=>{this.notify()},window.addEventListener("popstate",this.__onPopstate))}static removePopstateListener(){window.removeEventListener("popstate",this.__onPopstate),this.__onPopstate=null}};bi.appMap=Object.create(null);function Lr(s,i){for(let t in i)t.includes("-")?s.style.setProperty(t,i[t]):s.style[t]=i[t]}function Pr(s,i){for(let t in i)i[t].constructor===Boolean?i[t]?s.setAttribute(t,""):s.removeAttribute(t):s.setAttribute(t,i[t])}function ne(s={tag:"div"}){let i=document.createElement(s.tag);if(s.attributes&&Pr(i,s.attributes),s.styles&&Lr(i,s.styles),s.properties)for(let t in s.properties)i[t]=s.properties[t];return s.processors&&s.processors.forEach(t=>{t(i)}),s.children&&s.children.forEach(t=>{let e=ne(t);i.appendChild(e)}),i}var Ji="idb-store-ready",Dr="symbiote-db",Nr="symbiote-idb-update_",Mr=class{_notifyWhenReady(s=null){window.dispatchEvent(new CustomEvent(Ji,{detail:{dbName:this.name,storeName:this.storeName,event:s}}))}get _updEventName(){return Nr+this.name}_getUpdateEvent(s){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:s}})}_notifySubscribers(s){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,s),window.dispatchEvent(this._getUpdateEvent(s))}constructor(s,i){this.name=s,this.storeName=i,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=t=>{this.db=t.target.result,this.objStore=this.db.createObjectStore(i,{keyPath:"_key"}),this.objStore.transaction.oncomplete=e=>{this._notifyWhenReady(e)}},this.request.onsuccess=t=>{this.db=t.target.result,this._notifyWhenReady(t)},this.request.onerror=t=>{console.error(t)},this._subscriptionsMap={},this._updateHandler=t=>{t.key===this.name&&this._subscriptionsMap[t.newValue]&&this._subscriptionsMap[t.newValue].forEach(async r=>{r(await this.read(t.newValue))})},this._localUpdateHandler=t=>{this._updateHandler(t.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(s){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(s);return new Promise((e,r)=>{t.onsuccess=n=>{var o;(o=n.target.result)!=null&&o._value?e(n.target.result._value):(e(null),console.warn(`IDB: cannot read "${s}"`))},t.onerror=n=>{r(n)}})}write(s,i,t=!1){let e={_key:s,_value:i},n=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(e);return new Promise((o,a)=>{n.onsuccess=l=>{t||this._notifySubscribers(s),o(l.target.result)},n.onerror=l=>{a(l)}})}delete(s,i=!1){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(s);return new Promise((r,n)=>{e.onsuccess=o=>{i||this._notifySubscribers(s),r(o)},e.onerror=o=>{n(o)}})}getAll(){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((t,e)=>{i.onsuccess=r=>{let n=r.target.result;t(n.map(o=>o._value))},i.onerror=r=>{e(r)}})}subscribe(s,i){this._subscriptionsMap[s]||(this._subscriptionsMap[s]=new Set);let t=this._subscriptionsMap[s];return t.add(i),{remove:()=>{t.delete(i),t.size||delete this._subscriptionsMap[s]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,Qi.clear(this.name)}},Qi=class{static get readyEventName(){return Ji}static open(s=Dr,i="store"){let t=s+"/"+i;return this._reg[t]||(this._reg[t]=new Mr(s,i)),this._reg[t]}static clear(s){window.indexedDB.deleteDatabase(s);for(let i in this._reg)i.split("/")[0]===s&&delete this._reg[i]}};vi(Qi,"_reg",Object.create(null));var Br=s=>s,yi="{{",es="}}",ts="plural:";function oe(s,i,t={}){var o;let{openToken:e=yi,closeToken:r=es,transform:n=Br}=t;for(let a in i){let l=(o=i[a])==null?void 0:o.toString();s=s.replaceAll(e+a+r,typeof l=="string"?n(l):l)}return s}function is(s){let i=[],t=s.indexOf(yi);for(;t!==-1;){let e=s.indexOf(es,t),r=s.substring(t+2,e);if(r.startsWith(ts)){let n=s.substring(t+2,e).replace(ts,""),o=n.substring(0,n.indexOf("(")),a=n.substring(n.indexOf("(")+1,n.indexOf(")"));i.push({variable:r,pluralKey:o,countVariable:a})}t=s.indexOf(yi,e)}return i}function ss(s,i){[...s.querySelectorAll("[l10n]")].forEach(t=>{let e=t.getAttribute("l10n"),r="textContent";if(e.includes(":")){let o=e.split(":");r=o[0],e=o[1]}let n="l10n:"+e;i.__l10nKeys.push(n),i.add(n,e),i.sub(n,o=>{t[r]=i.l10n(o)}),t.removeAttribute("l10n")})}var Ci=()=>({"*blocksRegistry":new Set}),xi=s=>({...Ci(),"*currentActivity":"","*currentActivityParams":{},"*history":[],"*historyBack":null,"*closeModal":()=>{s.set$({"*modalActive":!1,"*currentActivity":""})}}),He=s=>({...xi(s),"*commonProgress":0,"*uploadList":[],"*outputData":null,"*focusedEntry":null,"*uploadMetadata":null});function Z(s,i){let t,e=(...r)=>{clearTimeout(t),t=setTimeout(()=>s(...r),i)};return e.cancel=()=>{clearTimeout(t)},e}var Fr="--uploadcare-blocks-window-height",je="__UPLOADCARE_BLOCKS_WINDOW_HEIGHT_TRACKER_ENABLED__";function wi(){return typeof window[je]=="undefined"?!1:!!window[je]}function rs(){if(wi())return;let s=()=>{document.documentElement.style.setProperty(Fr,`${window.innerHeight}px`),window[je]=!0},i=Z(s,100);return window.addEventListener("resize",i,{passive:!0}),s(),()=>{window[je]=!1,window.removeEventListener("resize",i)}}var ns="lr-",f=class extends Et{constructor(){super();c(this,"allowCustomTemplate",!0);c(this,"ctxInit",Ci());c(this,"init$",this.ctxInit);c(this,"updateCtxCssData",()=>{let t=this.$["*blocksRegistry"];for(let e of t)e.isConnected&&e.updateCssData()});this.activityType=null,this.addTemplateProcessor(ss),this.__l10nKeys=[]}l10n(t,e={}){if(!t)return"";let r=this.getCssData("--l10n-"+t,!0)||t,n=is(r);for(let a of n)e[a.variable]=this.pluralize(a.pluralKey,Number(e[a.countVariable]));return oe(r,e)}pluralize(t,e){let r=this.l10n("locale-name")||"en-US",n=new Intl.PluralRules(r).select(e);return this.l10n(`${t}__${n}`)}applyL10nKey(t,e){let r="l10n:"+t;this.$[r]=e,this.__l10nKeys.push(t)}findBlockInCtx(t){let e=this.$["*blocksRegistry"];for(let r of e)if(t(r))return!0;return!1}setForCtxTarget(t,e,r){this.findBlockInCtx(n=>n.constructor.StateConsumerScope===t)&&(this.$[e]=r)}setActivity(t){if(this.findBlockInCtx(e=>e.activityType===t)){this.$["*currentActivity"]=t;return}console.warn(`Activity type "${t}" not found in the context`)}connectedCallback(){if(wi()||(this._destroyInnerHeightTracker=rs()),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.isConnected&&this.__ctxOwner){let t=E.getCtx(this.ctxName,!1);t&&(t.store={...this.ctxInit})}super.connectedCallback()}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._destroyInnerHeightTracker)==null||t.call(this)}initCallback(){this.$["*blocksRegistry"].add(this)}destroyCallback(){this.$["*blocksRegistry"].delete(this)}fileSizeFmt(t,e=2){let r=["B","KB","MB","GB","TB"],n=h=>this.getCssData("--l10n-unit-"+h.toLowerCase(),!0)||h;if(t===0)return`0 ${n(r[0])}`;let o=1024,a=e<0?0:e,l=Math.floor(Math.log(t)/Math.log(o));return parseFloat((t/o**l).toFixed(a))+" "+n(r[l])}proxyUrl(t){let e=this.getCssData("--cfg-secure-delivery-proxy",!0);return e?oe(e,{previewUrl:t},{transform:r=>window.encodeURIComponent(r)}):t}static reg(t){if(!t){super.reg();return}super.reg(t.startsWith(ns)?t:ns+t)}};c(f,"StateConsumerScope",null);var Ti=class extends f{constructor(){super(...arguments);c(this,"_handleBackdropClick",()=>{this._closeDialog()});c(this,"_closeDialog",()=>{this.setForCtxTarget(Ti.StateConsumerScope,"*modalActive",!1)});c(this,"_handleDialogClose",()=>{this._closeDialog()});c(this,"_handleDialogClick",t=>{t.target===this.ref.dialog&&this._closeDialog()});c(this,"init$",{...this.ctxInit,"*modalActive":!1,isOpen:!1,closeClicked:this._handleDialogClose});c(this,"cssInit$",{"--cfg-modal-backdrop-strokes":0})}show(){this.ref.dialog.showModal?this.ref.dialog.showModal():this.ref.dialog.setAttribute("open","")}hide(){this.ref.dialog.close?this.ref.dialog.close():this.ref.dialog.removeAttribute("open")}initCallback(){if(super.initCallback(),typeof HTMLDialogElement=="function")this.ref.dialog.addEventListener("close",this._handleDialogClose),this.ref.dialog.addEventListener("click",this._handleDialogClick);else{this.setAttribute("dialog-fallback","");let t=document.createElement("div");t.className="backdrop",this.appendChild(t),t.addEventListener("click",this._handleBackdropClick)}this.sub("*modalActive",t=>{this.$.isOpen!==t&&(this.$.isOpen=t),t&&this.getCssData("--cfg-modal-scroll-lock")?document.body.style.overflow="hidden":document.body.style.overflow=null}),this.sub("--cfg-modal-backdrop-strokes",t=>{t?this.setAttribute("strokes",""):this.removeAttribute("strokes")}),this.sub("isOpen",t=>{t?this.show():this.hide()})}destroyCallback(){super.destroyCallback(),document.body.style.overflow=null,this.ref.dialog.removeEventListener("close",this._handleDialogClose),this.ref.dialog.removeEventListener("click",this._handleDialogClick)}},P=Ti;c(P,"StateConsumerScope","modal");P.template=`<dialog ref="dialog"><slot></slot></dialog>`;var os="active",ae="___ACTIVITY_IS_ACTIVE___",Q=class extends f{constructor(){super(...arguments);c(this,"historyTracked",!1);c(this,"ctxInit",xi(this));c(this,"_debouncedHistoryFlush",Z(this._historyFlush.bind(this),10))}_deactivate(){var e;let t=Q._activityRegistry[this.activityKey];this[ae]=!1,this.removeAttribute(os),(e=t==null?void 0:t.deactivateCallback)==null||e.call(t)}_activate(){var e;let t=Q._activityRegistry[this.activityKey];this.$["*historyBack"]=this.historyBack.bind(this),this[ae]=!0,this.setAttribute(os,""),(e=t==null?void 0:t.activateCallback)==null||e.call(t),this._debouncedHistoryFlush()}initCallback(){super.initCallback(),this.hasAttribute("current-activity")&&this.sub("*currentActivity",t=>{this.setAttribute("current-activity",t)}),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",t=>{this.activityType!==t&&this[ae]?this._deactivate():this.activityType===t&&!this[ae]&&this._activate(),t||(this.$["*history"]=[])}))}_historyFlush(){let t=this.$["*history"];t&&(t.length>10&&(t=t.slice(t.length-11,t.length-1)),this.historyTracked&&t.push(this.activityType),this.$["*history"]=t)}_isActivityRegistered(){return this.activityType&&!!Q._activityRegistry[this.activityKey]}get isActivityActive(){return this[ae]}registerActivity(t,e={}){let{onActivate:r,onDeactivate:n}=e;Q._activityRegistry||(Q._activityRegistry=Object.create(null)),Q._activityRegistry[this.activityKey]={activateCallback:r,deactivateCallback:n}}unregisterActivity(){this.isActivityActive&&this._deactivate(),Q._activityRegistry[this.activityKey]=void 0}destroyCallback(){super.destroyCallback(),this._isActivityRegistered()&&this.unregisterActivity(),Object.keys(Q._activityRegistry).length===0&&(this.$["*currentActivity"]=null)}get activityKey(){return this.ctxName+this.activityType}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){let t=this.$["*history"];if(t){let e=t.pop();for(;e===this.activityType;)e=t.pop();this.$["*currentActivity"]=e,this.$["*history"]=t,e||this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!1)}}},g=Q;c(g,"_activityRegistry",Object.create(null));g.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});var R=(s,i=",")=>s.trim().split(i).map(t=>t.trim()).filter(t=>t.length>0);var Nt=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],We=s=>s?s.filter(i=>typeof i=="string").map(i=>R(i)).flat():[],Ei=(s,i)=>i.some(t=>t.endsWith("*")?(t=t.replace("*",""),s.startsWith(t)):s===t),Mt=s=>{let i=s==null?void 0:s.type;return i?Ei(i,Nt):!1};function as(s){return Object.prototype.toString.call(s)==="[object Object]"}var Vr=/\W|_/g;function zr(s){return s.split(Vr).map((i,t)=>i.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+i.slice(1)).join("")}function ls(s,{ignoreKeys:i}={ignoreKeys:[]}){return Array.isArray(s)?s.map(t=>ct(t,{ignoreKeys:i})):s}function ct(s,{ignoreKeys:i}={ignoreKeys:[]}){if(Array.isArray(s))return ls(s,{ignoreKeys:i});if(!as(s))return s;let t={};for(let e of Object.keys(s)){let r=s[e];if(i.includes(e)){t[e]=r;continue}as(r)?r=ct(r,{ignoreKeys:i}):Array.isArray(r)&&(r=ls(r,{ignoreKeys:i})),t[zr(e)]=r}return t}var Hr=s=>new Promise(i=>setTimeout(i,s));function Oi({libraryName:s,libraryVersion:i,userAgent:t,publicKey:e="",integration:r=""}){let n="JavaScript";if(typeof t=="string")return t;if(typeof t=="function")return t({publicKey:e,libraryName:s,libraryVersion:i,languageName:n,integration:r});let o=[s,i,e].filter(Boolean).join("/"),a=[n,r].filter(Boolean).join("; ");return`${o} (${a})`}var jr={factor:2,time:100};function Wr(s,i=jr){let t=0;function e(r){let n=Math.round(i.time*i.factor**t);return r({attempt:t,retry:a=>Hr(a!=null?a:n).then(()=>(t+=1,e(r)))})}return e(s)}var Ht=class extends Error{constructor(t){super();c(this,"originalProgressEvent");this.name="UploadcareNetworkError",this.message="Network error",Object.setPrototypeOf(this,Ht.prototype),this.originalProgressEvent=t}},Ge=(s,i)=>{s&&(s.aborted?Promise.resolve().then(i):s.addEventListener("abort",()=>i(),{once:!0}))},pt=class extends Error{constructor(t="Request canceled"){super(t);c(this,"isCancel",!0);Object.setPrototypeOf(this,pt.prototype)}},Xr=500,us=({check:s,interval:i=Xr,timeout:t,signal:e})=>new Promise((r,n)=>{let o,a;Ge(e,()=>{o&&clearTimeout(o),n(new pt("Poll cancelled"))}),t&&(a=setTimeout(()=>{o&&clearTimeout(o),n(new pt("Timed out"))},t));let l=()=>{try{Promise.resolve(s(e)).then(h=>{h?(a&&clearTimeout(a),r(h)):o=setTimeout(l,i)}).catch(h=>{a&&clearTimeout(a),n(h)})}catch(h){a&&clearTimeout(a),n(h)}};o=setTimeout(l,0)}),T={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",maxContentLength:50*1024*1024,retryThrottledRequestMaxTimes:1,retryNetworkErrorMaxTimes:3,multipartMinFileSize:25*1024*1024,multipartChunkSize:5*1024*1024,multipartMinLastPartSize:1024*1024,maxConcurrentRequests:4,pollingTimeoutMilliseconds:1e4,pusherKey:"79ae88bd931ea68464d9"},qe="application/octet-stream",ds="original",ft=({method:s,url:i,data:t,headers:e={},signal:r,onProgress:n})=>new Promise((o,a)=>{let l=new XMLHttpRequest,h=(s==null?void 0:s.toUpperCase())||"GET",u=!1;l.open(h,i,!0),e&&Object.entries(e).forEach(d=>{let[p,m]=d;typeof m!="undefined"&&!Array.isArray(m)&&l.setRequestHeader(p,m)}),l.responseType="text",Ge(r,()=>{u=!0,l.abort(),a(new pt)}),l.onload=()=>{if(l.status!=200)a(new Error(`Error ${l.status}: ${l.statusText}`));else{let d={method:h,url:i,data:t,headers:e||void 0,signal:r,onProgress:n},p=l.getAllResponseHeaders().trim().split(/[\r\n]+/),m={};p.forEach(function(C){let A=C.split(": "),w=A.shift(),v=A.join(": ");w&&typeof w!="undefined"&&(m[w]=v)});let _=l.response,x=l.status;o({request:d,data:_,headers:m,status:x})}},l.onerror=d=>{u||a(new Ht(d))},n&&typeof n=="function"&&(l.upload.onprogress=d=>{d.lengthComputable?n({isComputable:!0,value:d.loaded/d.total}):n({isComputable:!1})}),t?l.send(t):l.send()});function Gr(s,...i){return s}var qr=({name:s})=>s?[s]:[],Kr=Gr,Yr=()=>new FormData,ps=s=>!1,Ke=s=>typeof Blob!="undefined"&&s instanceof Blob,Ye=s=>typeof File!="undefined"&&s instanceof File,Ze=s=>!!s&&typeof s=="object"&&!Array.isArray(s)&&"uri"in s&&typeof s.uri=="string",le=s=>Ke(s)||Ye(s)||ps()||Ze(s),Zr=s=>typeof s=="string"||typeof s=="number"||typeof s=="undefined",Jr=s=>!!s&&typeof s=="object"&&!Array.isArray(s),Qr=s=>!!s&&typeof s=="object"&&"data"in s&&le(s.data);function tn(s,i,t){if(Qr(t)){let{name:e,contentType:r}=t,n=Kr(t.data,e,r!=null?r:qe),o=qr({name:e,contentType:r});s.push([i,n,...o])}else if(Jr(t))for(let[e,r]of Object.entries(t))typeof r!="undefined"&&s.push([`${i}[${e}]`,String(r)]);else Zr(t)&&t&&s.push([i,t.toString()])}function en(s){let i=[];for(let[t,e]of Object.entries(s))tn(i,t,e);return i}function Ui(s){let i=Yr(),t=en(s);for(let e of t){let[r,n,...o]=e;i.append(r,n,...o)}return i}var N=class extends Error{constructor(t,e,r,n,o){super();c(this,"isCancel");c(this,"code");c(this,"request");c(this,"response");c(this,"headers");this.name="UploadClientError",this.message=t,this.code=e,this.request=r,this.response=n,this.headers=o,Object.setPrototypeOf(this,N.prototype)}},sn=s=>{let i=new URLSearchParams;for(let[t,e]of Object.entries(s))e&&typeof e=="object"&&!Array.isArray(e)?Object.entries(e).filter(r=>{var n;return(n=r[1])!=null?n:!1}).forEach(r=>i.set(`${t}[${r[0]}]`,String(r[1]))):Array.isArray(e)?e.forEach(r=>{i.append(`${t}[]`,r)}):typeof e=="string"&&e?i.set(t,e):typeof e=="number"&&i.set(t,e.toString());return i.toString()},lt=(s,i,t)=>{let e=new URL(s);return e.pathname=(e.pathname+i).replace("//","/"),t&&(e.search=sn(t)),e.toString()},rn="6.6.1",nn="UploadcareUploadClient",on=rn;function kt(s){return Oi({libraryName:nn,libraryVersion:on,...s})}var an="RequestThrottledError",cs=15e3,ln=1e3;function cn(s){let{headers:i}=s||{};if(!i||typeof i["retry-after"]!="string")return cs;let t=parseInt(i["retry-after"],10);return Number.isFinite(t)?t*1e3:cs}function gt(s,i){let{retryThrottledRequestMaxTimes:t,retryNetworkErrorMaxTimes:e}=i;return Wr(({attempt:r,retry:n})=>s().catch(o=>{if("response"in o&&(o==null?void 0:o.code)===an&&r<t)return n(cn(o));if(o instanceof Ht&&r<e)return n((r+1)*ln);throw o}))}var ms=s=>{let i="";return(Ke(s)||Ye(s)||Ze(s))&&(i=s.type),i||qe},fs=s=>{let i="";return Ye(s)&&s.name?i=s.name:Ke(s)||ps()?i="":Ze(s)&&s.name&&(i=s.name),i||ds};function Li(s){return typeof s=="undefined"||s==="auto"?"auto":s?"1":"0"}function hn(s,{publicKey:i,fileName:t,contentType:e,baseURL:r=T.baseURL,secureSignature:n,secureExpire:o,store:a,signal:l,onProgress:h,source:u="local",integration:d,userAgent:p,retryThrottledRequestMaxTimes:m=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:_=T.retryNetworkErrorMaxTimes,metadata:x}){return gt(()=>ft({method:"POST",url:lt(r,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":kt({publicKey:i,integration:d,userAgent:p})},data:Ui({file:{data:s,name:t||fs(s),contentType:e||ms(s)},UPLOADCARE_PUB_KEY:i,UPLOADCARE_STORE:Li(a),signature:n,expire:o,source:u,metadata:x}),signal:l,onProgress:h}).then(({data:C,headers:A,request:w})=>{let v=ct(JSON.parse(C));if("error"in v)throw new N(v.error.content,v.error.errorCode,w,v,A);return v}),{retryNetworkErrorMaxTimes:_,retryThrottledRequestMaxTimes:m})}var ki;(function(s){s.Token="token",s.FileInfo="file_info"})(ki||(ki={}));function un(s,{publicKey:i,baseURL:t=T.baseURL,store:e,fileName:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,source:h="url",signal:u,integration:d,userAgent:p,retryThrottledRequestMaxTimes:m=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:_=T.retryNetworkErrorMaxTimes,metadata:x}){return gt(()=>ft({method:"POST",headers:{"X-UC-User-Agent":kt({publicKey:i,integration:d,userAgent:p})},url:lt(t,"/from_url/",{jsonerrors:1,pub_key:i,source_url:s,store:Li(e),filename:r,check_URL_duplicates:n?1:void 0,save_URL_duplicates:o?1:void 0,signature:a,expire:l,source:h,metadata:x}),signal:u}).then(({data:C,headers:A,request:w})=>{let v=ct(JSON.parse(C));if("error"in v)throw new N(v.error.content,v.error.errorCode,w,v,A);return v}),{retryNetworkErrorMaxTimes:_,retryThrottledRequestMaxTimes:m})}var V;(function(s){s.Unknown="unknown",s.Waiting="waiting",s.Progress="progress",s.Error="error",s.Success="success"})(V||(V={}));var dn=s=>"status"in s&&s.status===V.Error;function pn(s,{publicKey:i,baseURL:t=T.baseURL,signal:e,integration:r,userAgent:n,retryThrottledRequestMaxTimes:o=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=T.retryNetworkErrorMaxTimes}={}){return gt(()=>ft({method:"GET",headers:i?{"X-UC-User-Agent":kt({publicKey:i,integration:r,userAgent:n})}:void 0,url:lt(t,"/from_url/status/",{jsonerrors:1,token:s}),signal:e}).then(({data:l,headers:h,request:u})=>{let d=ct(JSON.parse(l));if("error"in d&&!dn(d))throw new N(d.error.content,void 0,u,d,h);return d}),{retryNetworkErrorMaxTimes:a,retryThrottledRequestMaxTimes:o})}function mn(s,{publicKey:i,baseURL:t=T.baseURL,jsonpCallback:e,secureSignature:r,secureExpire:n,signal:o,source:a,integration:l,userAgent:h,retryThrottledRequestMaxTimes:u=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:d=T.retryNetworkErrorMaxTimes}){return gt(()=>ft({method:"POST",headers:{"X-UC-User-Agent":kt({publicKey:i,integration:l,userAgent:h})},url:lt(t,"/group/",{jsonerrors:1,pub_key:i,files:s,callback:e,signature:r,expire:n,source:a}),signal:o}).then(({data:p,headers:m,request:_})=>{let x=ct(JSON.parse(p));if("error"in x)throw new N(x.error.content,x.error.errorCode,_,x,m);return x}),{retryNetworkErrorMaxTimes:d,retryThrottledRequestMaxTimes:u})}function gs(s,{publicKey:i,baseURL:t=T.baseURL,signal:e,source:r,integration:n,userAgent:o,retryThrottledRequestMaxTimes:a=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=T.retryNetworkErrorMaxTimes}){return gt(()=>ft({method:"GET",headers:{"X-UC-User-Agent":kt({publicKey:i,integration:n,userAgent:o})},url:lt(t,"/info/",{jsonerrors:1,pub_key:i,file_id:s,source:r}),signal:e}).then(({data:h,headers:u,request:d})=>{let p=ct(JSON.parse(h));if("error"in p)throw new N(p.error.content,p.error.errorCode,d,p,u);return p}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function fn(s,{publicKey:i,contentType:t,fileName:e,multipartChunkSize:r=T.multipartChunkSize,baseURL:n="",secureSignature:o,secureExpire:a,store:l,signal:h,source:u="local",integration:d,userAgent:p,retryThrottledRequestMaxTimes:m=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:_=T.retryNetworkErrorMaxTimes,metadata:x}){return gt(()=>ft({method:"POST",url:lt(n,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":kt({publicKey:i,integration:d,userAgent:p})},data:Ui({filename:e||ds,size:s,content_type:t||qe,part_size:r,UPLOADCARE_STORE:Li(l),UPLOADCARE_PUB_KEY:i,signature:o,expire:a,source:u,metadata:x}),signal:h}).then(({data:C,headers:A,request:w})=>{let v=ct(JSON.parse(C));if("error"in v)throw new N(v.error.content,v.error.errorCode,w,v,A);return v.parts=Object.keys(v.parts).map(Y=>v.parts[Y]),v}),{retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:_})}function gn(s,i,{contentType:t,signal:e,onProgress:r,retryThrottledRequestMaxTimes:n=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:o=T.retryNetworkErrorMaxTimes}){return gt(()=>ft({method:"PUT",url:i,data:s,onProgress:r,signal:e,headers:{"Content-Type":t||qe}}).then(a=>(r&&r({isComputable:!0,value:1}),a)).then(({status:a})=>({code:a})),{retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o})}function _n(s,{publicKey:i,baseURL:t=T.baseURL,source:e="local",signal:r,integration:n,userAgent:o,retryThrottledRequestMaxTimes:a=T.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=T.retryNetworkErrorMaxTimes}){return gt(()=>ft({method:"POST",url:lt(t,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":kt({publicKey:i,integration:n,userAgent:o})},data:Ui({uuid:s,UPLOADCARE_PUB_KEY:i,source:e}),signal:r}).then(({data:h,headers:u,request:d})=>{let p=ct(JSON.parse(h));if("error"in p)throw new N(p.error.content,p.error.errorCode,d,p,u);return p}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function Pi({file:s,publicKey:i,baseURL:t,source:e,integration:r,userAgent:n,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a,signal:l,onProgress:h}){return us({check:u=>gs(s,{publicKey:i,baseURL:t,signal:u,source:e,integration:r,userAgent:n,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a}).then(d=>d.isReady?d:(h&&h({isComputable:!0,value:1}),!1)),signal:l})}var mt=class{constructor(i,{baseCDN:t=T.baseCDN,fileName:e}={}){c(this,"uuid");c(this,"name",null);c(this,"size",null);c(this,"isStored",null);c(this,"isImage",null);c(this,"mimeType",null);c(this,"cdnUrl",null);c(this,"s3Url",null);c(this,"originalFilename",null);c(this,"imageInfo",null);c(this,"videoInfo",null);c(this,"contentInfo",null);c(this,"metadata",null);c(this,"s3Bucket",null);let{uuid:r,s3Bucket:n}=i,o=lt(t,`${r}/`),a=n?lt(`https://${n}.s3.amazonaws.com/`,`${r}/${i.filename}`):null;this.uuid=r,this.name=e||i.filename,this.size=i.size,this.isStored=i.isStored,this.isImage=i.isImage,this.mimeType=i.mimeType,this.cdnUrl=o,this.originalFilename=i.originalFilename,this.imageInfo=i.imageInfo,this.videoInfo=i.videoInfo,this.contentInfo=i.contentInfo,this.metadata=i.metadata||null,this.s3Bucket=n||null,this.s3Url=a}},bn=(s,{publicKey:i,fileName:t,baseURL:e,secureSignature:r,secureExpire:n,store:o,contentType:a,signal:l,onProgress:h,source:u,integration:d,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:_,baseCDN:x,metadata:C})=>hn(s,{publicKey:i,fileName:t,contentType:a,baseURL:e,secureSignature:r,secureExpire:n,store:o,signal:l,onProgress:h,source:u,integration:d,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:_,metadata:C}).then(({file:A})=>Pi({file:A,publicKey:i,baseURL:e,source:u,integration:d,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:_,onProgress:h,signal:l})).then(A=>new mt(A,{baseCDN:x})),vn=(s,{publicKey:i,fileName:t,baseURL:e,signal:r,onProgress:n,source:o,integration:a,userAgent:l,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:u,baseCDN:d})=>gs(s,{publicKey:i,baseURL:e,signal:r,source:o,integration:a,userAgent:l,retryThrottledRequestMaxTimes:h,retryNetworkErrorMaxTimes:u}).then(p=>new mt(p,{baseCDN:d,fileName:t})).then(p=>(n&&n({isComputable:!0,value:1}),p)),yn=(s,{signal:i}={})=>{let t=null,e=null,r=s.map(()=>new AbortController),n=o=>()=>{e=o,r.forEach((a,l)=>l!==o&&a.abort())};return Ge(i,()=>{r.forEach(o=>o.abort())}),Promise.all(s.map((o,a)=>{let l=n(a);return Promise.resolve().then(()=>o({stopRace:l,signal:r[a].signal})).then(h=>(l(),h)).catch(h=>(t=h,null))})).then(o=>{if(e===null)throw t;return o[e]})},Cn=window.WebSocket,Si=class{constructor(){c(this,"events",Object.create({}))}emit(i,t){var e;(e=this.events[i])==null||e.forEach(r=>r(t))}on(i,t){this.events[i]=this.events[i]||[],this.events[i].push(t)}off(i,t){t?this.events[i]=this.events[i].filter(e=>e!==t):this.events[i]=[]}},xn=(s,i)=>s==="success"?{status:V.Success,...i}:s==="progress"?{status:V.Progress,...i}:{status:V.Error,...i},Ii=class{constructor(i,t=3e4){c(this,"key");c(this,"disconnectTime");c(this,"ws");c(this,"queue",[]);c(this,"isConnected",!1);c(this,"subscribers",0);c(this,"emmitter",new Si);c(this,"disconnectTimeoutId",null);this.key=i,this.disconnectTime=t}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){let i=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new Cn(i),this.ws.addEventListener("error",t=>{this.emmitter.emit("error",new Error(t.message))}),this.emmitter.on("connected",()=>{this.isConnected=!0,this.queue.forEach(t=>this.send(t.event,t.data)),this.queue=[]}),this.ws.addEventListener("message",t=>{let e=JSON.parse(t.data.toString());switch(e.event){case"pusher:connection_established":{this.emmitter.emit("connected",void 0);break}case"pusher:ping":{this.send("pusher:pong",{});break}case"progress":case"success":case"fail":this.emmitter.emit(e.channel,xn(e.event,JSON.parse(e.data)))}})}}disconnect(){let i=()=>{var t;(t=this.ws)==null||t.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout(()=>{i()},this.disconnectTime):i()}send(i,t){var r;let e=JSON.stringify({event:i,data:t});(r=this.ws)==null||r.send(e)}subscribe(i,t){this.subscribers+=1,this.connect();let e=`task-status-${i}`,r={event:"pusher:subscribe",data:{channel:e}};this.emmitter.on(e,t),this.isConnected?this.send(r.event,r.data):this.queue.push(r)}unsubscribe(i){this.subscribers-=1;let t=`task-status-${i}`,e={event:"pusher:unsubscribe",data:{channel:t}};this.emmitter.off(t),this.isConnected?this.send(e.event,e.data):this.queue=this.queue.filter(r=>r.data.channel!==t),this.subscribers===0&&this.disconnect()}onError(i){return this.emmitter.on("error",i),()=>this.emmitter.off("error",i)}},Ai=null,Di=s=>{if(!Ai){let i=typeof window=="undefined"?0:3e4;Ai=new Ii(s,i)}return Ai},wn=s=>{Di(s).connect()};function Tn({token:s,publicKey:i,baseURL:t,integration:e,userAgent:r,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o,onProgress:a,signal:l}){return us({check:h=>pn(s,{publicKey:i,baseURL:t,integration:e,userAgent:r,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o,signal:h}).then(u=>{switch(u.status){case V.Error:return new N(u.error,u.errorCode);case V.Waiting:return!1;case V.Unknown:return new N(`Token "${s}" was not found.`);case V.Progress:return a&&(u.total==="unknown"?a({isComputable:!1}):a({isComputable:!0,value:u.done/u.total})),!1;case V.Success:return a&&a({isComputable:!0,value:u.done/u.total}),u;default:throw new Error("Unknown status")}}),signal:l})}var En=({token:s,pusherKey:i,signal:t,onProgress:e})=>new Promise((r,n)=>{let o=Di(i),a=o.onError(n),l=()=>{a(),o.unsubscribe(s)};Ge(t,()=>{l(),n(new pt("pusher cancelled"))}),o.subscribe(s,h=>{switch(h.status){case V.Progress:{e&&(h.total==="unknown"?e({isComputable:!1}):e({isComputable:!0,value:h.done/h.total}));break}case V.Success:{l(),e&&e({isComputable:!0,value:h.done/h.total}),r(h);break}case V.Error:l(),n(new N(h.msg,h.error_code))}})}),An=(s,{publicKey:i,fileName:t,baseURL:e,baseCDN:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,store:h,signal:u,onProgress:d,source:p,integration:m,userAgent:_,retryThrottledRequestMaxTimes:x,pusherKey:C=T.pusherKey,metadata:A})=>Promise.resolve(wn(C)).then(()=>un(s,{publicKey:i,fileName:t,baseURL:e,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,store:h,signal:u,source:p,integration:m,userAgent:_,retryThrottledRequestMaxTimes:x,metadata:A})).catch(w=>{let v=Di(C);return v==null||v.disconnect(),Promise.reject(w)}).then(w=>w.type===ki.FileInfo?w:yn([({signal:v})=>Tn({token:w.token,publicKey:i,baseURL:e,integration:m,userAgent:_,retryThrottledRequestMaxTimes:x,onProgress:d,signal:v}),({signal:v})=>En({token:w.token,pusherKey:C,signal:v,onProgress:d})],{signal:u})).then(w=>{if(w instanceof N)throw w;return w}).then(w=>Pi({file:w.uuid,publicKey:i,baseURL:e,integration:m,userAgent:_,retryThrottledRequestMaxTimes:x,onProgress:d,signal:u})).then(w=>new mt(w,{baseCDN:r})),$i=new WeakMap,$n=async s=>{if($i.has(s))return $i.get(s);let i=await fetch(s.uri).then(t=>t.blob());return $i.set(s,i),i},_s=async s=>{if(Ye(s)||Ke(s))return s.size;if(Ze(s))return(await $n(s)).size;throw new Error("Unknown file type. Cannot determine file size.")},kn=(s,i=T.multipartMinFileSize)=>s>=i,bs=s=>{let i="[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}",t=new RegExp(i);return!le(s)&&t.test(s)},vs=s=>{let i="^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$",t=new RegExp(i);return!le(s)&&t.test(s)},Sn=(s,i)=>new Promise((t,e)=>{let r=[],n=!1,o=i.length,a=[...i],l=()=>{let h=i.length-a.length,u=a.shift();u&&u().then(d=>{n||(r[h]=d,o-=1,o?l():t(r))}).catch(d=>{n=!0,e(d)})};for(let h=0;h<s;h++)l()}),In=(s,i,t,e)=>{let r=e*i,n=Math.min(r+e,t);return s.slice(r,n)},Rn=async(s,i,t)=>e=>In(s,e,i,t),On=(s,i,{publicKey:t,contentType:e,onProgress:r,signal:n,integration:o,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})=>gn(s,i,{publicKey:t,contentType:e,onProgress:r,signal:n,integration:o,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l}),Un=async(s,{publicKey:i,fileName:t,fileSize:e,baseURL:r,secureSignature:n,secureExpire:o,store:a,signal:l,onProgress:h,source:u,integration:d,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:_,contentType:x,multipartChunkSize:C=T.multipartChunkSize,maxConcurrentRequests:A=T.maxConcurrentRequests,baseCDN:w,metadata:v})=>{let Y=e!=null?e:await _s(s),rt,wt=(I,X)=>{if(!h)return;rt||(rt=Array(I).fill(0));let nt=F=>F.reduce((ot,gi)=>ot+gi,0);return F=>{F.isComputable&&(rt[X]=F.value,h({isComputable:!0,value:nt(rt)/I}))}};return x||(x=ms(s)),fn(Y,{publicKey:i,contentType:x,fileName:t||fs(s),baseURL:r,secureSignature:n,secureExpire:o,store:a,signal:l,source:u,integration:d,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:_,metadata:v}).then(async({uuid:I,parts:X})=>{let nt=await Rn(s,Y,C);return Promise.all([I,Sn(A,X.map((F,ot)=>()=>On(nt(ot),F,{publicKey:i,contentType:x,onProgress:wt(X.length,ot),signal:l,integration:d,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:_})))])}).then(([I])=>_n(I,{publicKey:i,baseURL:r,source:u,integration:d,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:_})).then(I=>I.isReady?I:Pi({file:I.uuid,publicKey:i,baseURL:r,source:u,integration:d,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:_,onProgress:h,signal:l})).then(I=>new mt(I,{baseCDN:w}))};async function Ni(s,{publicKey:i,fileName:t,baseURL:e=T.baseURL,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:h,integration:u,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,contentType:_,multipartMinFileSize:x,multipartChunkSize:C,maxConcurrentRequests:A,baseCDN:w=T.baseCDN,checkForUrlDuplicates:v,saveUrlForRecurrentUploads:Y,pusherKey:rt,metadata:wt}){if(le(s)){let I=await _s(s);return kn(I,x)?Un(s,{publicKey:i,contentType:_,multipartChunkSize:C,fileSize:I,fileName:t,baseURL:e,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:h,integration:u,userAgent:d,maxConcurrentRequests:A,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,baseCDN:w,metadata:wt}):bn(s,{publicKey:i,fileName:t,contentType:_,baseURL:e,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:h,integration:u,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,baseCDN:w,metadata:wt})}if(vs(s))return An(s,{publicKey:i,fileName:t,baseURL:e,baseCDN:w,checkForUrlDuplicates:v,saveUrlForRecurrentUploads:Y,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:h,integration:u,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,pusherKey:rt,metadata:wt});if(bs(s))return vn(s,{publicKey:i,fileName:t,baseURL:e,signal:a,onProgress:l,source:h,integration:u,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,baseCDN:w});throw new TypeError(`File uploading from "${s}" is not supported`)}var Ri=class{constructor(i,t){c(this,"uuid");c(this,"filesCount");c(this,"totalSize");c(this,"isStored");c(this,"isImage");c(this,"cdnUrl");c(this,"files");c(this,"createdAt");c(this,"storedAt",null);this.uuid=i.id,this.filesCount=i.filesCount,this.totalSize=Object.values(i.files).reduce((e,r)=>e+r.size,0),this.isStored=!!i.datetimeStored,this.isImage=!!Object.values(i.files).filter(e=>e.isImage).length,this.cdnUrl=i.cdnUrl,this.files=t,this.createdAt=i.datetimeCreated,this.storedAt=i.datetimeStored}},Ln=s=>{for(let i of s)if(!le(i))return!1;return!0},Pn=s=>{for(let i of s)if(!bs(i))return!1;return!0},Dn=s=>{for(let i of s)if(!vs(i))return!1;return!0};function ys(s,{publicKey:i,fileName:t,baseURL:e=T.baseURL,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:h,integration:u,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,contentType:_,multipartChunkSize:x=T.multipartChunkSize,baseCDN:C=T.baseCDN,checkForUrlDuplicates:A,saveUrlForRecurrentUploads:w,jsonpCallback:v}){if(!Ln(s)&&!Dn(s)&&!Pn(s))throw new TypeError(`Group uploading from "${s}" is not supported`);let Y,rt=!0,wt=s.length,I=(X,nt)=>{if(!l)return;Y||(Y=Array(X).fill(0));let F=ot=>ot.reduce((gi,pr)=>gi+pr)/X;return ot=>{if(!ot.isComputable||!rt){rt=!1,l({isComputable:!1});return}Y[nt]=ot.value,l({isComputable:!0,value:F(Y)})}};return Promise.all(s.map((X,nt)=>Ni(X,{publicKey:i,fileName:t,baseURL:e,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:I(wt,nt),source:h,integration:u,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,contentType:_,multipartChunkSize:x,baseCDN:C,checkForUrlDuplicates:A,saveUrlForRecurrentUploads:w}))).then(X=>{let nt=X.map(F=>F.uuid);return mn(nt,{publicKey:i,baseURL:e,jsonpCallback:v,secureSignature:r,secureExpire:n,signal:a,source:h,integration:u,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m}).then(F=>new Ri(F,X)).then(F=>(l&&l({isComputable:!0,value:1}),F))})}var At,Bt,$t,Ft,Vt,zt,Xe,hs=class{constructor(i){Tt(this,zt);Tt(this,At,1);Tt(this,Bt,[]);Tt(this,$t,0);Tt(this,Ft,new WeakMap);Tt(this,Vt,new WeakMap);ie(this,At,i)}add(i){return new Promise((t,e)=>{L(this,Ft).set(i,t),L(this,Vt).set(i,e),L(this,Bt).push(i),Fe(this,zt,Xe).call(this)})}get pending(){return L(this,Bt).length}get running(){return L(this,$t)}set concurrency(i){ie(this,At,i),Fe(this,zt,Xe).call(this)}get concurrency(){return L(this,At)}};At=new WeakMap,Bt=new WeakMap,$t=new WeakMap,Ft=new WeakMap,Vt=new WeakMap,zt=new WeakSet,Xe=function(){let i=L(this,At)-L(this,$t);for(let t=0;t<i;t++){let e=L(this,Bt).shift();if(!e)return;let r=L(this,Ft).get(e),n=L(this,Vt).get(e);if(!r||!n)throw new Error("Unexpected behavior: resolver or rejector is undefined");ie(this,$t,L(this,$t)+1),e().finally(()=>{L(this,Ft).delete(e),L(this,Vt).delete(e),ie(this,$t,L(this,$t)-1),Fe(this,zt,Xe).call(this)}).then(o=>r(o)).catch(o=>n(o))}};var Cs=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null,nullable:!0},fileSize:{type:Number,value:null},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null},uploadError:{type:Error,value:null,nullable:!0},validationErrorMsg:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},cdnUrl:{type:String,value:null},cdnUrlModifiers:{type:String,value:null},fileInfo:{type:mt,value:null},isUploading:{type:Boolean,value:!1},abortController:{type:AbortController,value:null,nullable:!0},thumbUrl:{type:String,value:null,nullable:!0}});var Mi="blocks",Bi="0.21.7";function xs(s){return Oi({...s,libraryName:Mi,libraryVersion:Bi})}var ws="[Typed State] Wrong property name: ",Nn="[Typed State] Wrong property type: ",Je=class{constructor(i,t){this.__typedSchema=i,this.__ctxId=t||re.generate(),this.__schema=Object.keys(i).reduce((e,r)=>(e[r]=i[r].value,e),{}),this.__data=E.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(i,t){if(!this.__typedSchema.hasOwnProperty(i)){console.warn(ws+i);return}let e=this.__typedSchema[i];if((t==null?void 0:t.constructor)===e.type||t instanceof e.type||e.nullable&&t===null){this.__data.pub(i,t);return}console.warn(Nn+i)}setMultipleValues(i){for(let t in i)this.setValue(t,i[t])}getValue(i){if(!this.__typedSchema.hasOwnProperty(i)){console.warn(ws+i);return}return this.__data.read(i)}subscribe(i,t){return this.__data.sub(i,t)}remove(){E.deleteCtx(this.__ctxId)}};var Qe=class{constructor(i){this.__typedSchema=i.typedSchema,this.__ctxId=i.ctxName||re.generate(),this.__data=E.registerCtx({},this.__ctxId),this.__watchList=i.watchList||[],this.__handler=i.handler||null,this.__subsMap=Object.create(null),this.__observers=new Set,this.__items=new Set,this.__removed=new Set,this.__added=new Set;let t=Object.create(null);this.__notifyObservers=(e,r)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),t[e]||(t[e]=new Set),t[e].add(r),this.__observeTimeout=window.setTimeout(()=>{this.__observers.forEach(n=>{n({...t})}),t=Object.create(null)})}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{var e;let i=this.__added,t=this.__removed;this.__added.clear(),this.__removed.clear(),(e=this.__handler)==null||e.call(this,[...this.__items],i,t)})}add(i){let t=new Je(this.__typedSchema);for(let e in i)t.setValue(e,i[e]);return this.__data.add(t.uid,t),this.__added.add(t),this.__watchList.forEach(e=>{this.__subsMap[t.uid]||(this.__subsMap[t.uid]=[]),this.__subsMap[t.uid].push(t.subscribe(e,()=>{this.__notifyObservers(e,t.uid)}))}),this.__items.add(t.uid),this.notify(),t}read(i){return this.__data.read(i)}readProp(i,t){return this.read(i).getValue(t)}publishProp(i,t,e){this.read(i).setValue(t,e)}remove(i){this.__removed.add(this.__data.read(i)),this.__items.delete(i),this.notify(),this.__data.pub(i,null),delete this.__subsMap[i]}clearAll(){this.__items.forEach(i=>{this.remove(i)})}observe(i){this.__observers.add(i)}unobserve(i){this.__observers.delete(i)}findItems(i){let t=[];return this.__items.forEach(e=>{let r=this.read(e);i(r)&&t.push(e)}),t}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){E.deleteCtx(this.__data),this.__observers=null;for(let i in this.__subsMap)this.__subsMap[i].forEach(t=>{t.remove()}),delete this.__subsMap[i]}};var S={UPLOAD_START:"UPLOAD_START",REMOVE:"REMOVE",UPLOAD_PROGRESS:"UPLOAD_PROGRESS",UPLOAD_FINISH:"UPLOAD_FINISH",UPLOAD_ERROR:"UPLOAD_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",CDN_MODIFICATION:"CLOUD_MODIFICATION",DATA_OUTPUT:"DATA_OUTPUT",DONE_FLOW:"DONE_FLOW",INIT_FLOW:"INIT_FLOW"},D=class{constructor(i){this.ctx=i.ctx,this.type=i.type,this.data=i.data}},k=class{static eName(i){return"LR_"+i}static emit(i,t=window,e=!0){let r=()=>{t.dispatchEvent(new CustomEvent(this.eName(i.type),{detail:i}))};if(!e){r();return}let n=i.type+i.ctx;this._timeoutStore[n]&&window.clearTimeout(this._timeoutStore[n]),this._timeoutStore[n]=window.setTimeout(()=>{r(),delete this._timeoutStore[n]},20)}};c(k,"_timeoutStore",Object.create(null));var b=class extends g{constructor(){super(...arguments);c(this,"ctxInit",He(this));c(this,"__initialUploadMetadata",null);c(this,"_handleCollectionUpdate",t=>{let e=this.uploadCollection;if(t.uploadProgress){let r=0,n=e.findItems(a=>!a.getValue("uploadError"));n.forEach(a=>{r+=e.readProp(a,"uploadProgress")});let o=Math.round(r/n.length);this.$["*commonProgress"]=o,k.emit(new D({type:S.UPLOAD_PROGRESS,ctx:this.ctxName,data:o}),void 0,o===100)}if(t.uuid){let r=e.findItems(o=>!!o.getValue("uuid")),n=e.findItems(o=>!!o.getValue("uploadError")||!!o.getValue("validationErrorMsg"));if(e.size-n.length===r.length){let o=this.getOutputData(a=>!!a.getValue("uuid"));k.emit(new D({type:S.UPLOAD_FINISH,ctx:this.ctxName,data:o}))}}t.uploadError&&e.findItems(n=>!!n.getValue("uploadError")).forEach(n=>{k.emit(new D({type:S.UPLOAD_ERROR,ctx:this.ctxName,data:e.readProp(n,"uploadError")}),void 0,!1)}),t.validationErrorMsg&&e.findItems(n=>!!n.getValue("validationErrorMsg")).forEach(n=>{k.emit(new D({type:S.VALIDATION_ERROR,ctx:this.ctxName,data:e.readProp(n,"validationErrorMsg")}),void 0,!1)}),t.cdnUrlModifiers&&e.findItems(n=>!!n.getValue("cdnUrlModifiers")).forEach(n=>{k.emit(new D({type:S.CDN_MODIFICATION,ctx:this.ctxName,data:E.getCtx(n).store}),void 0,!1)})})}setUploadMetadata(t){this.connectedOnce?this.$["*uploadMetadata"]=t:this.__initialUploadMetadata=t}initCallback(){super.initCallback(),this.__initialUploadMetadata&&(this.$["*uploadMetadata"]=this.__initialUploadMetadata)}destroyCallback(){super.destroyCallback();let t=this.$["*blocksRegistry"];t.has(this)&&(this.uploadCollection.unobserve(this._handleCollectionUpdate),t.delete(this))}addFiles(t){t.forEach(e=>{this.uploadCollection.add({file:e,isImage:Mt(e),mimeType:e.type,fileName:e.name,fileSize:e.size})})}openSystemDialog(t={}){let e=We([this.getCssData("--cfg-accept"),...this.getCssData("--cfg-img-only")?Nt:[]]).join(",");this.getCssData("--cfg-accept")&&this.getCssData("--cfg-img-only")&&console.warn("There could be a mistake.\nBoth `--cfg-accept` and `--cfg-img-only` parameters are set.\nThe value of `--cfg-accept` will be concatenated with the internal image mime types list."),this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=!!this.getCssData("--cfg-multiple"),t.captureCamera?(this.fileInput.capture="",this.fileInput.accept=Nt.join(",")):this.fileInput.accept=e,this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{this.addFiles([...this.fileInput.files]),this.$["*currentActivity"]=g.activities.UPLOAD_LIST,this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!0),this.fileInput.value="",this.fileInput=null}}get sourceList(){let t=null;return this.getCssData("--cfg-source-list")&&(t=R(this.getCssData("--cfg-source-list"))),t}initFlow(t=!1){var e,r;if((e=this.$["*uploadList"])!=null&&e.length&&!t)this.set$({"*currentActivity":g.activities.UPLOAD_LIST}),this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!0);else if(((r=this.sourceList)==null?void 0:r.length)===1){let n=this.sourceList[0];n==="local"?(this.$["*currentActivity"]=g.activities.UPLOAD_LIST,this==null||this.openSystemDialog()):(Object.values(b.extSrcList).includes(n)?this.set$({"*currentActivityParams":{externalSourceType:n},"*currentActivity":g.activities.EXTERNAL}):this.$["*currentActivity"]=n,this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!0))}else this.set$({"*currentActivity":g.activities.START_FROM}),this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!0);k.emit(new D({type:S.INIT_FLOW,ctx:this.ctxName}),void 0,!1)}doneFlow(){this.set$({"*currentActivity":this.doneActivity,"*history":this.doneActivity?[this.doneActivity]:[]}),this.$["*currentActivity"]||this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!1),k.emit(new D({type:S.DONE_FLOW,ctx:this.ctxName}),void 0,!1)}get uploadCollection(){if(!this.has("*uploadCollection")){let t=new Qe({typedSchema:Cs,watchList:["uploadProgress","uuid","uploadError","validationErrorMsg","cdnUrlModifiers"],handler:(e,r,n)=>{var o;for(let a of n)(o=a==null?void 0:a.getValue("abortController"))==null||o.abort(),a==null||a.setValue("abortController",null),URL.revokeObjectURL(a==null?void 0:a.getValue("thumbUrl"));this.$["*uploadList"]=e.map(a=>({uid:a}))}});t.observe(this._handleCollectionUpdate),this.add("*uploadCollection",t)}return this.$["*uploadCollection"]}getUploadClientOptions(){let t=this.getCssData("--cfg-store",!0),e={store:t===null?void 0:!!t,publicKey:this.getCssData("--cfg-pubkey"),baseCDN:this.getCssData("--cfg-cdn-cname"),baseURL:this.getCssData("--cfg-base-url"),userAgent:xs,integration:this.getCssData("--cfg-user-agent-integration"),secureSignature:this.getCssData("--cfg-secure-signature"),secureExpire:this.getCssData("--cfg-secure-expire"),retryThrottledRequestMaxTimes:this.getCssData("--cfg-retry-throttled-request-max-times"),multipartMinFileSize:this.getCssData("--cfg-multipart-min-file-size"),multipartChunkSize:this.getCssData("--cfg-multipart-chunk-size"),maxConcurrentRequests:this.getCssData("--cfg-max-concurrent-requests"),multipartMaxAttempts:this.getCssData("--cfg-multipart-max-attempts"),checkForUrlDuplicates:!!this.getCssData("--cfg-check-for-url-duplicates"),saveUrlForRecurrentUploads:!!this.getCssData("--cfg-save-url-for-recurrent-uploads"),metadata:this.$["*uploadMetadata"]};return console.log("Upload client options:",e),e}getOutputData(t){let e=[];return this.uploadCollection.findItems(t).forEach(n=>{let o=E.getCtx(n).store,a=o.fileInfo||{name:o.fileName,fileSize:o.fileSize,isImage:o.isImage,mimeType:o.mimeType},l={...a,cdnUrlModifiers:o.cdnUrlModifiers,cdnUrl:o.cdnUrl||a.cdnUrl};e.push(l)}),e}};b.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"});b.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...b.extSrcList});Object.values(S).forEach(s=>{let i=k.eName(s);window.addEventListener(i,t=>{if([S.UPLOAD_FINISH,S.REMOVE,S.CDN_MODIFICATION].includes(t.detail.type)){let r=E.getCtx(t.detail.ctx),n=r.read("uploadCollection"),o=[];n.items().forEach(a=>{let l=E.getCtx(a).store,h=l.fileInfo;if(h){let u={...h,cdnUrlModifiers:l.cdnUrlModifiers,cdnUrl:l.cdnUrl||h.cdnUrl};o.push(u)}}),k.emit(new D({type:S.DATA_OUTPUT,ctx:t.detail.ctx,data:o})),r.pub("outputData",o)}})});var jt=class extends f{constructor(){super(...arguments);c(this,"init$",{...this.ctxInit,name:"",path:"",size:"24",viewBox:""})}initCallback(){super.initCallback(),this.sub("name",t=>{if(!t)return;let e=this.getCssData(`--icon-${t}`);e&&(this.$.path=e)}),this.sub("path",t=>{if(!t)return;t.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=t):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path fill-rule="evenodd" d="${t}"></path>`)}),this.sub("size",t=>{this.$.viewBox=`0 0 ${t} ${t}`})}};jt.template=`<svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>`;jt.bindAttributes({name:"name",size:"size"});var Ts=s=>{if(typeof s!="string"||!s)return"";let i=s.trim();return i.startsWith("-/")?i=i.slice(2):i.startsWith("/")&&(i=i.slice(1)),i.endsWith("/")&&(i=i.slice(0,i.length-1)),i},ti=(...s)=>s.filter(i=>typeof i=="string"&&i).map(i=>Ts(i)).join("/-/"),O=(...s)=>{let i=ti(...s);return i?`-/${i}/`:""};function Es(s){let i=new URL(s),t=i.pathname+i.search+i.hash,e=t.lastIndexOf("http"),r=t.lastIndexOf("/"),n="";return e>=0?n=t.slice(e):r>=0&&(n=t.slice(r+1)),n}function As(s){let i=new URL(s),{pathname:t}=i,e=t.indexOf("/"),r=t.indexOf("/",e+1);return t.substring(e+1,r)}function $s(s){let i=ks(s),t=new URL(i),e=t.pathname.indexOf("/-/");return e===-1?[]:t.pathname.substring(e).split("/-/").filter(Boolean).map(n=>Ts(n))}function ks(s){let i=new URL(s),t=Es(s),e=Ss(t)?Is(t).pathname:t;return i.pathname=i.pathname.replace(e,""),i.search="",i.hash="",i.toString()}function Ss(s){return s.startsWith("http")}function Is(s){let i=new URL(s);return{pathname:i.origin+i.pathname||"",search:i.search||"",hash:i.hash||""}}var $=(s,i,t)=>{let e=new URL(ks(s));if(t=t||Es(s),e.pathname.startsWith("//")&&(e.pathname=e.pathname.replace("//","/")),Ss(t)){let r=Is(t);e.pathname=e.pathname+(i||"")+(r.pathname||""),e.search=r.search,e.hash=r.hash}else e.pathname=e.pathname+(i||"")+(t||"");return e.toString()},_t=(s,i)=>{let t=new URL(s);return t.pathname=i+"/",t.toString()};var Mn="https://ucarecdn.com",St=Object.freeze({"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{default:Mn},"proxy-cname":{},"secure-delivery-proxy":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{default:"auto"},"cdn-operations":{},progressive:{},quality:{default:"smart"},"is-background-for":{}});var Rs=s=>[...new Set(s)];var ce="--lr-img-",Os="unresolved",Wt=2,Xt=3,Us=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost"),Ps=Object.create(null),Ls;for(let s in St)Ps[ce+s]=((Ls=St[s])==null?void 0:Ls.default)||"";var ei=class extends Et{constructor(){super(...arguments);c(this,"cssInit$",Ps)}$$(t){return this.$[ce+t]}set$$(t){for(let e in t)this.$[ce+e]=t[e]}sub$$(t,e){this.sub(ce+t,r=>{r===null||r===""||e(r)})}_fmtAbs(t){return!t.includes("//")&&!Us&&(t=new URL(t,document.baseURI).href),t}_getCdnModifiers(t=""){return O(t&&`resize/${t}`,this.$$("cdn-operations")||"",`format/${this.$$("format")||St.format.default}`,`quality/${this.$$("quality")||St.quality.default}`)}_getUrlBase(t=""){if(this.$$("src").startsWith("data:")||this.$$("src").startsWith("blob:"))return this.$$("src");if(Us&&this.$$("src")&&!this.$$("src").includes("//"))return this._proxyUrl(this.$$("src"));let e=this._getCdnModifiers(t);if(this.$$("src").startsWith(this.$$("cdn-cname")))return $(this.$$("src"),e);if(this.$$("cdn-cname")&&this.$$("uuid"))return this._proxyUrl($(_t(this.$$("cdn-cname"),this.$$("uuid")),e));if(this.$$("uuid"))return this._proxyUrl($(_t(this.$$("cdn-cname"),this.$$("uuid")),e));if(this.$$("proxy-cname"))return this._proxyUrl($(this.$$("proxy-cname"),e,this._fmtAbs(this.$$("src"))));if(this.$$("pubkey"))return this._proxyUrl($(`https://${this.$$("pubkey")}.ucr.io/`,e,this._fmtAbs(this.$$("src"))))}_proxyUrl(t){return this.$$("secure-delivery-proxy")?oe(this.$$("secure-delivery-proxy"),{previewUrl:t},{transform:r=>window.encodeURIComponent(r)}):t}_getElSize(t,e=1,r=!0){let n=t.getBoundingClientRect(),o=e*Math.round(n.width),a=r?"":e*Math.round(n.height);return o||a?`${o||""}x${a||""}`:null}_setupEventProxy(t){let e=n=>{n.stopPropagation();let o=new Event(n.type,n);this.dispatchEvent(o)},r=["load","error"];for(let n of r)t.addEventListener(n,e)}get img(){return this._img||(this._img=new Image,this._setupEventProxy(this.img),this._img.setAttribute(Os,""),this.img.onload=()=>{this.img.removeAttribute(Os)},this.initAttributes(),this.appendChild(this._img)),this._img}get bgSelector(){return this.$$("is-background-for")}initAttributes(){[...this.attributes].forEach(t=>{St[t.name]||this.img.setAttribute(t.name,t.value)})}get breakpoints(){return this.$$("breakpoints")?Rs(R(this.$$("breakpoints")).map(t=>Number(t))):null}renderBg(t){let e=new Set;this.breakpoints?this.breakpoints.forEach(n=>{e.add(`url("${this._getUrlBase(n+"x")}") ${n}w`),this.$$("hi-res-support")&&e.add(`url("${this._getUrlBase(n*Wt+"x")}") ${n*Wt}w`),this.$$("ultra-res-support")&&e.add(`url("${this._getUrlBase(n*Xt+"x")}") ${n*Xt}w`)}):(e.add(`url("${this._getUrlBase(this._getElSize(t))}") 1x`),this.$$("hi-res-support")&&e.add(`url("${this._getUrlBase(this._getElSize(t,Wt))}") ${Wt}x`),this.$$("ultra-res-support")&&e.add(`url("${this._getUrlBase(this._getElSize(t,Xt))}") ${Xt}x`));let r=`image-set(${[...e].join(", ")})`;t.style.setProperty("background-image",r),t.style.setProperty("background-image","-webkit-"+r)}getSrcset(){let t=new Set;return this.breakpoints?this.breakpoints.forEach(e=>{t.add(this._getUrlBase(e+"x")+` ${e}w`),this.$$("hi-res-support")&&t.add(this._getUrlBase(e*Wt+"x")+` ${e*Wt}w`),this.$$("ultra-res-support")&&t.add(this._getUrlBase(e*Xt+"x")+` ${e*Xt}w`)}):(t.add(this._getUrlBase(this._getElSize(this.img))+" 1x"),this.$$("hi-res-support")&&t.add(this._getUrlBase(this._getElSize(this.img,2))+" 2x"),this.$$("ultra-res-support")&&t.add(this._getUrlBase(this._getElSize(this.img,3))+" 3x")),[...t].join()}getSrc(){return this._getUrlBase()}init(){this.bgSelector?[...document.querySelectorAll(this.bgSelector)].forEach(t=>{this.$$("intersection")?this.initIntersection(t,()=>{this.renderBg(t)}):this.renderBg(t)}):this.$$("intersection")?this.initIntersection(this.img,()=>{this.img.srcset=this.getSrcset(),this.img.src=this.getSrc()}):(this.img.srcset=this.getSrcset(),this.img.src=this.getSrc())}initIntersection(t,e){let r={root:null,rootMargin:"0px"};this._isnObserver=new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting&&(e(),this._isnObserver.unobserve(t))})},r),this._isnObserver.observe(t),this._observed||(this._observed=new Set),this._observed.add(t)}destroyCallback(){super.destroyCallback(),this._isnObserver&&(this._observed.forEach(t=>{this._isnObserver.unobserve(t)}),this._isnObserver=null)}static get observedAttributes(){return Object.keys(St)}attributeChangedCallback(t,e,r){window.setTimeout(()=>{this.$[ce+t]=r})}};var ii=class extends ei{initCallback(){super.initCallback(),this.sub$$("src",()=>{this.init()}),this.sub$$("uuid",()=>{this.init()}),this.sub$$("lazy",i=>{this.$$("is-background-for")||(this.img.loading=i?"lazy":"eager")})}};var he=class extends b{constructor(){super(...arguments);c(this,"init$",{...this.ctxInit,"*simpleButtonText":"",onClick:()=>{this.initFlow()}})}initCallback(){super.initCallback(),this.bindCssData("--cfg-multiple"),this.sub("--cfg-multiple",t=>{this.$["*simpleButtonText"]=t?this.l10n("upload-files"):this.l10n("upload-file")})}};he.template=`<lr-drop-area><button type="button" set="onclick: onClick"><lr-icon name="upload"></lr-icon><span>{{*simpleButtonText}}</span><slot></slot><div class="visual-drop-area"></div></button></lr-drop-area>`;var si=class extends g{constructor(){super(...arguments);c(this,"historyTracked",!0);c(this,"activityType","start-from")}initCallback(){super.initCallback(),this.registerActivity(this.activityType)}};function Bn(s){return new Promise(i=>{typeof window.FileReader!="function"&&i(!1);try{let t=new FileReader;t.onerror=()=>{i(!0)};let e=r=>{r.type!=="loadend"&&t.abort(),i(!1)};t.onloadend=e,t.onprogress=e,t.readAsDataURL(s)}catch{i(!1)}})}function Fn(s){return new Promise(i=>{let t=0,e=[],r=o=>{o||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),i(null)),o.isFile?(t++,o.file(a=>{t--,e.push(a),t===0&&i(e)})):o.isDirectory&&n(o.createReader())},n=o=>{t++,o.readEntries(a=>{t--;for(let l of a)r(l);t===0&&i(e)})};r(s)})}function Ds(s){let i=[],t=[];for(let e=0;e<s.items.length;e++){let r=s.items[e];if(r)if(r.kind==="file"){if(typeof r.webkitGetAsEntry=="function"||typeof r.getAsEntry=="function"){let o=typeof r.webkitGetAsEntry=="function"?r.webkitGetAsEntry():r.getAsEntry();t.push(Fn(o).then(a=>{i.push(...a)}));continue}let n=r.getAsFile();t.push(Bn(n).then(o=>{o||i.push(n)}))}else r.kind==="string"&&r.type.match("^text/uri-list")&&t.push(new Promise(n=>{r.getAsString(o=>{i.push(o),n()})}))}return Promise.all(t).then(()=>i)}var M={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3},Ns=["focus"],Vn=100,Fi=new Map;function zn(s,i){let t=Math.max(Math.min(s[0],i.x+i.width),i.x),e=Math.max(Math.min(s[1],i.y+i.height),i.y);return Math.sqrt((s[0]-t)*(s[0]-t)+(s[1]-e)*(s[1]-e))}function Vi(s){let i=0,t=document.body,e=new Set,r=m=>e.add(m),n=M.INACTIVE,o=m=>{s.shouldIgnore()&&m!==M.INACTIVE||(n!==m&&e.forEach(_=>_(m)),n=m)};r(m=>s.onChange(m));let a=()=>{i=0,o(M.INACTIVE)},l=()=>{i+=1,n===M.INACTIVE&&o(M.ACTIVE)},h=()=>{i-=1,i>0||o(M.INACTIVE)},u=m=>{m.preventDefault(),i=0,o(M.INACTIVE)},d=m=>{m.preventDefault();let _=[m.x,m.y],x=s.element.getBoundingClientRect(),C=Math.floor(zn(_,x)),A=C<Vn,w=m.composedPath().includes(s.element);Fi.set(s.element,C);let v=Math.min(...Fi.values())===C;o(w&&v?M.OVER:A&&v?M.NEAR:M.ACTIVE)},p=async m=>{if(s.shouldIgnore())return;m.preventDefault();let _=await Ds(m.dataTransfer);s.onItems(_),o(M.INACTIVE)};return t.addEventListener("drop",u),t.addEventListener("dragleave",h),t.addEventListener("dragenter",l),t.addEventListener("dragover",d),s.element.addEventListener("drop",p),Ns.forEach(m=>{window.addEventListener(m,a)}),()=>{Fi.delete(s.element),t.removeEventListener("drop",u),t.removeEventListener("dragleave",h),t.removeEventListener("dragenter",l),t.removeEventListener("dragover",d),s.element.removeEventListener("drop",p),Ns.forEach(m=>{window.removeEventListener(m,a)})}}var Gt=class extends b{constructor(){super(...arguments);c(this,"init$",{...this.ctxInit,state:M.INACTIVE,withIcon:!1,isClickable:!1,isFullscreen:!1,isDisabled:!1,isHidden:!1,text:this.l10n("drop-files-here"),"lr-drop-area/targets":null});c(this,"cssInit$",{"--cfg-source-list":""})}isActive(){if(!this.$.isDisabled)return!1;let t=this.getBoundingClientRect(),e=t.width>0&&t.height>0,r=t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth),n=window.getComputedStyle(this),o=n.visibility!=="hidden"&&n.display!=="none";return e&&o&&r}initCallback(){super.initCallback(),this.$["lr-drop-area/targets"]||(this.$["lr-drop-area/targets"]=new Set),this.$["lr-drop-area/targets"].add(this),this.defineAccessor("disabled",e=>{this.set$({isDisabled:typeof e=="string"})}),this.defineAccessor("clickable",e=>{this.set$({isClickable:typeof e=="string"})}),this.defineAccessor("with-icon",e=>{this.set$({withIcon:typeof e=="string"})}),this.defineAccessor("fullscreen",e=>{this.set$({isFullscreen:typeof e=="string"})}),this.defineAccessor("text",e=>{e?this.set$({text:this.l10n(e)||e}):this.set$({text:this.l10n("drop-files-here")})}),this._destroyDropzone=Vi({element:this,shouldIgnore:()=>this._shouldIgnore(),onChange:e=>{this.$.state=e},onItems:e=>{debugger;if(!e.length)return;let r=this.getCssData("--cfg-multiple"),n=this.getCssData("--cfg-multiple-max"),o=this.uploadCollection.size;r&&n?e=e.slice(0,n-o-1):r||(e=e.slice(0,o>0?0:1)),e.forEach(a=>{if(typeof a=="string"){this.uploadCollection.add({externalUrl:a});return}let l=Mt(a);this.uploadCollection.add({file:a,isImage:l,mimeType:a.type,fileName:a.name,fileSize:a.size})}),this.uploadCollection.size&&(this.set$({"*currentActivity":g.activities.UPLOAD_LIST}),this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!0))}});let t=this.ref["content-wrapper"];t&&(this._destroyContentWrapperDropzone=Vi({element:t,onChange:e=>{var n;let r=(n=Object.entries(M).find(([,o])=>o===e))==null?void 0:n[0].toLowerCase();r&&t.setAttribute("drag-state",r)},onItems:()=>{},shouldIgnore:()=>this._shouldIgnore()})),this.sub("state",e=>{var n;let r=(n=Object.entries(M).find(([,o])=>o===e))==null?void 0:n[0].toLowerCase();r&&this.setAttribute("drag-state",r)}),this.sub("--cfg-source-list",e=>{let r=R(e);this.$.isDisabled=!r.includes(b.sourceTypes.LOCAL),this.$.isHidden=this.$.isDisabled&&!!this.querySelector("[data-default-slot]")}),this.sub("isHidden",e=>{this.toggleAttribute("hidden",e)}),this.$.isClickable&&(this._onAreaClicked=()=>{this.openSystemDialog()},this.addEventListener("click",this._onAreaClicked))}_shouldIgnore(){return this.$.isDisabled||!this._couldHandleFiles()?!0:this.$.isFullscreen?[...this.$["lr-drop-area/targets"]].filter(r=>r!==this).filter(r=>r.isActive()).length>0:!1}_couldHandleFiles(){let t=this.getCssData("--cfg-multiple"),e=this.getCssData("--cfg-multiple-max"),r=this.uploadCollection.size;return!(t&&e&&r>=e||!t&&r>0)}destroyCallback(){var t,e,r,n;super.destroyCallback(),(e=(t=this.$["lr-drop-area/targets"])==null?void 0:t.remove)==null||e.call(t,this),(r=this._destroyDropzone)==null||r.call(this),(n=this._destroyContentWrapperDropzone)==null||n.call(this),this._onAreaClicked&&this.removeEventListener("click",this._onAreaClicked)}};Gt.template=`<slot><div data-default-slot hidden></div><div ref="content-wrapper" class="content-wrapper" set="@hidden: isHidden"><div class="icon-container" set="@hidden: !withIcon"><lr-icon name="default"></lr-icon><lr-icon name="arrow-down"></lr-icon></div><span class="text">{{text}}</span></div></slot>`;Gt.bindAttributes({"with-icon":null,clickable:null,text:null,fullscreen:null,disabled:null});var Hn="src-type-",qt=class extends b{constructor(){super(...arguments);c(this,"_registeredTypes",{});c(this,"init$",{...this.ctxInit,iconName:"default"})}initTypes(){this.registerType({type:b.sourceTypes.LOCAL,onClick:()=>{this.openSystemDialog()}}),this.registerType({type:b.sourceTypes.URL,activity:g.activities.URL,textKey:"from-url"}),this.registerType({type:b.sourceTypes.CAMERA,activity:g.activities.CAMERA,onClick:()=>{var e=document.createElement("input").capture!==void 0;return e&&this.openSystemDialog({captureCamera:!0}),!e}}),this.registerType({type:"draw",activity:g.activities.DRAW,icon:"edit-draw"});for(let t of Object.values(b.extSrcList))this.registerType({type:t,activity:g.activities.EXTERNAL,activityParams:{externalSourceType:t}})}initCallback(){super.initCallback(),this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",t=>{t&&this.applyType(t)})}registerType(t){this._registeredTypes[t.type]=t}getType(t){return this._registeredTypes[t]}applyType(t){let e=this._registeredTypes[t];if(!e){console.warn("Unsupported source type: "+t);return}let{textKey:r=t,icon:n=t,activity:o,onClick:a,activityParams:l={}}=e;this.applyL10nKey("src-type",`${Hn}${r}`),this.$.iconName=n,this.onclick=h=>{(a?a(h):!!o)&&this.set$({"*currentActivityParams":l,"*currentActivity":o})}}};qt.template=`<lr-icon set="@name: iconName"></lr-icon><div class="txt" l10n="src-type"></div>`;qt.bindAttributes({type:null});var ri=class extends f{constructor(){super(...arguments);c(this,"cssInit$",{"--cfg-source-list":""})}initCallback(){super.initCallback(),this.sub("--cfg-source-list",t=>{let e=R(t),r="";e.forEach(n=>{r+=`<lr-source-btn type="${n}"></lr-source-btn>`}),this.getCssData("--cfg-source-list-wrap")?this.innerHTML=r:this.outerHTML=r})}};function Ms(s,i=40){if(s.type==="image/svg+xml")return URL.createObjectURL(s);let t=document.createElement("canvas"),e=t.getContext("2d"),r=new Image,n=new Promise((o,a)=>{r.onload=()=>{let l=r.height/r.width;l>1?(t.width=i,t.height=i*l):(t.height=i,t.width=i/l),e.fillStyle="rgb(240, 240, 240)",e.fillRect(0,0,t.width,t.height),e.drawImage(r,0,0,t.width,t.height),t.toBlob(h=>{if(!h){a();return}let u=URL.createObjectURL(h);o(u)})},r.onerror=l=>{a(l)}});return r.src=URL.createObjectURL(s),n}var Kt=class{constructor(){c(this,"caption","");c(this,"text","");c(this,"iconName","");c(this,"isError",!1)}},ue=class extends f{constructor(){super(...arguments);c(this,"init$",{...this.ctxInit,iconName:"info",captionTxt:"Message caption",msgTxt:"Message...","*message":null,onClose:()=>{this.$["*message"]=null}})}initCallback(){super.initCallback(),this.sub("*message",t=>{t?(this.setAttribute("active",""),this.set$({captionTxt:t.caption||"",msgTxt:t.text||"",iconName:t.isError?"error":"info"}),t.isError?this.setAttribute("error",""):this.removeAttribute("error")):this.removeAttribute("active")})}};ue.template=`<div class="heading"><lr-icon set="@name: iconName"></lr-icon><div class="caption">{{captionTxt}}</div><button type="button" set="onclick: onClose"><lr-icon name="close"></lr-icon></button></div><div class="msg">{{msgTxt}}</div>`;function Bs(s){let i=new Blob([s],{type:"image/svg+xml"});return URL.createObjectURL(i)}function Fs(s="#fff",i="rgba(0, 0, 0, .1)"){return Bs(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><rect x="0" y="0" width="20" height="20" fill="${s}" /><rect x="0" y="0" width="10" height="10" fill="${i}" /><rect x="10" y="10" width="10" height="10" fill="${i}" /></svg>`)}function de(s="hsl(209, 21%, 65%)",i=32,t=32){return Bs(`<svg width="${i}" height="${t}" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" fill="${s}" d="M9.68848 8.70068C9.68848 8.42454 9.91233 8.20068 10.1885 8.20068H15.0885C15.2211 8.20068 15.3483 8.25336 15.442 8.34713L20.342 13.2471C20.4358 13.3409 20.4885 13.4681 20.4885 13.6007V21.3007C20.4885 21.5768 20.2646 21.8007 19.9885 21.8007H10.1885C9.91233 21.8007 9.68848 21.5768 9.68848 21.3007V8.70068ZM10.6885 9.20068V20.8007H19.4885V14.1007L15.0885 14.1007C14.8123 14.1007 14.5885 13.8768 14.5885 13.6007L14.5885 9.20068H10.6885ZM15.5885 9.90779L18.7814 13.1007L15.5885 13.1007L15.5885 9.90779Z"/></svg>`)}var H=Object.freeze({FINISHED:Symbol(0),FAILED:Symbol(1),UPLOADING:Symbol(2),IDLE:Symbol(3)}),tt=class extends b{constructor(){super(...arguments);c(this,"pauseRender",!0);c(this,"_entrySubs",new Set);c(this,"_entry",null);c(this,"_isIntersecting",!1);c(this,"_debouncedGenerateThumb",Z(this._generateThumbnail.bind(this),100));c(this,"_debouncedCalculateState",Z(this._calculateState.bind(this),100));c(this,"_renderedOnce",!1);c(this,"cssInit$",{"--cfg-use-cloud-image-editor":0});c(this,"init$",{...this.ctxInit,uid:"",itemName:"",errorText:"",thumbUrl:"",progressValue:0,progressVisible:!1,progressUnknown:!1,badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,isEditable:!1,state:H.IDLE,"*uploadTrigger":null,onEdit:()=>{this.set$({"*focusedEntry":this._entry}),this.findBlockInCtx(t=>t.activityType===g.activities.DETAILS)?this.$["*currentActivity"]=g.activities.DETAILS:this.$["*currentActivity"]=g.activities.CLOUD_IMG_EDIT},onRemove:()=>{let t=this._entry.getValue("uuid");if(t){let e=this.getOutputData(r=>r.getValue("uuid")===t);k.emit(new D({type:S.REMOVE,ctx:this.ctxName,data:e}))}this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}})}_reset(){for(let t of this._entrySubs)t.remove();this._debouncedGenerateThumb.cancel(),this._entrySubs=new Set,this._entry=null,this._isIntersecting=!1}_observerCallback(t){let[e]=t;this._isIntersecting=e.isIntersecting,e.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0),e.intersectionRatio===0?this._debouncedGenerateThumb.cancel():this._debouncedGenerateThumb()}_calculateState(){if(!this._entry)return;let t=this._entry,e=H.IDLE;t.getValue("uploadError")||t.getValue("validationErrorMsg")?e=H.FAILED:t.getValue("isUploading")?e=H.UPLOADING:t.getValue("uuid")&&(e=H.FINISHED),this.$.state!==e&&(this.$.state=e)}async _generateThumbnail(){var e;if(!this._entry)return;let t=this._entry;if(t.getValue("uuid")&&t.getValue("isImage")){let r=this.getCssData("--cfg-thumb-size")||76,n=this.proxyUrl($(_t(this.getCssData("--cfg-cdn-cname"),this._entry.getValue("uuid")),O(t.getValue("cdnUrlModifiers"),`scale_crop/${r}x${r}/center`))),o=t.getValue("thumbUrl");o!==n&&(t.setValue("thumbUrl",n),o.startsWith("blob:")&&URL.revokeObjectURL(o));return}if(!t.getValue("thumbUrl"))if((e=t.getValue("file"))!=null&&e.type.includes("image"))try{let r=await Ms(t.getValue("file"),this.getCssData("--cfg-thumb-size")||76);t.setValue("thumbUrl",r)}catch{let n=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",de(n))}else{let r=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",de(r))}}_showMessage(t,e,r){let n=new Kt;n.caption=e,n.text=r,n.isError=t==="error",this.set$({badgeIcon:`badge-${t}`,"*message":n})}_subEntry(t,e){let r=this._entry.subscribe(t,n=>{this.isConnected&&e(n)});this._entrySubs.add(r)}_handleEntryId(t){var r;this._reset();let e=(r=this.uploadCollection)==null?void 0:r.read(t);this._entry=e,e&&(this._subEntry("validationErrorMsg",n=>{this._debouncedCalculateState(),this.$.errorText=n}),this._subEntry("uploadError",n=>{this._debouncedCalculateState(),this.$.errorText=n==null?void 0:n.message}),this._subEntry("isUploading",()=>{this._debouncedCalculateState()}),this._subEntry("uploadProgress",n=>{this.$.progressValue=n}),this._subEntry("fileName",n=>{this.$.itemName=n||e.getValue("externalUrl")||this.l10n("file-no-name")}),this._subEntry("fileSize",n=>{let o=this.getCssData("--cfg-max-local-file-size-bytes");o&&n&&n>o&&e.setValue("validationErrorMsg",this.l10n("files-max-size-limit-error",{maxFileSize:o}))}),this._subEntry("mimeType",n=>{if(!n)return;let o=this.getCssData("--cfg-img-only"),a=this.getCssData("--cfg-accept"),l=We([...o?Nt:[],a]);l.length>0&&!Ei(n,l)&&e.setValue("validationErrorMsg",this.l10n("file-type-not-allowed"))}),this._subEntry("isImage",n=>{let o=this.getCssData("--cfg-img-only");e.getValue("externalUrl")&&!e.getValue("uuid")&&o&&!n||o&&!n&&e.setValue("validationErrorMsg",this.l10n("images-only-accepted"))}),this._subEntry("externalUrl",n=>{this.$.itemName=e.getValue("fileName")||n||this.l10n("file-no-name")}),this._subEntry("uuid",n=>{this._debouncedCalculateState(),n&&this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("cdnUrlModifiers",()=>{this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("thumbUrl",n=>{this.$.thumbUrl=n?`url(${n})`:""}),this.getCssData("--cfg-confirm-upload")||this.upload(),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.sub("uid",t=>{this._handleEntryId(t)}),this.sub("state",t=>{this._handleState(t)}),this.sub("--cfg-use-cloud-image-editor",()=>{this._handleState(this.$.state)}),this.onclick=()=>{tt.activeInstances.forEach(t=>{t===this?t.setAttribute("focused",""):t.removeAttribute("focused")})},this.$["*uploadTrigger"]=null,this.sub("*uploadTrigger",t=>{!t||!this.isConnected||this.upload()}),tt.activeInstances.add(this)}_handleState(t){var e;this.set$({isFailed:t===H.FAILED,isUploading:t===H.UPLOADING,isFinished:t===H.FINISHED,progressVisible:t===H.UPLOADING,isEditable:this.$["--cfg-use-cloud-image-editor"]&&t===H.FINISHED&&((e=this._entry)==null?void 0:e.getValue("isImage"))}),t===H.FAILED?this.$.badgeIcon="badge-error":t===H.FINISHED&&(this.$.badgeIcon="badge-success"),t===H.UPLOADING?this.$.isFocused=!1:this.$.progressValue=0}destroyCallback(){super.destroyCallback(),tt.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){var t;super.disconnectedCallback(),this._debouncedGenerateThumb.cancel(),(t=this._observer)==null||t.disconnect()}async upload(){let t=this._entry;if(t.getValue("uuid")||t.getValue("isUploading")||t.getValue("validationErrorMsg"))return;let e=this.getOutputData(r=>!r.getValue("uuid"));k.emit(new D({type:S.UPLOAD_START,ctx:this.ctxName,data:e})),this._debouncedCalculateState(),t.setValue("isUploading",!0),t.setValue("uploadError",null),t.setValue("validationErrorMsg",null),!t.getValue("file")&&t.getValue("externalUrl")&&(this.$.progressUnknown=!0);try{let r=new AbortController;t.setValue("abortController",r);let n=await Ni(t.getValue("file")||t.getValue("externalUrl"),{...this.getUploadClientOptions(),fileName:t.getValue("fileName"),onProgress:o=>{if(o.isComputable){let a=o.value*100;t.setValue("uploadProgress",a)}this.$.progressUnknown=!o.isComputable},signal:r.signal});t.setMultipleValues({fileInfo:n,isUploading:!1,fileName:n.name,fileSize:n.size,isImage:n.isImage,mimeType:n.mimeType,uuid:n.uuid,cdnUrl:n.cdnUrl}),t===this._entry&&this._debouncedCalculateState()}catch(r){t.setMultipleValues({abortController:null,isUploading:!1,uploadProgress:0}),t===this._entry&&this._debouncedCalculateState(),r!=null&&r.isCancel||t.setValue("uploadError",r)}}};tt.template=`<div class="inner" set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @focused: isFocused"><div class="thumb" set="style.backgroundImage: thumbUrl"><div class="badge"><lr-icon set="@name: badgeIcon"></lr-icon></div></div><div class="file-name-wrapper"><span class="file-name" set="@title: itemName">{{itemName}}</span><span class="file-error" set="@hidden: !errorText">{{errorText}}</span></div><div class="file-actions"><button type="button" class="edit-btn mini-btn" set="onclick: onEdit; @hidden: !isEditable"><lr-icon name="edit-file"></lr-icon></button><button type="button" class="remove-btn mini-btn" set="onclick: onRemove;"><lr-icon name="remove-file"></lr-icon></button><button type="button" class="upload-btn mini-btn" set="onclick: onUpload;"><lr-icon name="upload"></lr-icon></button></div><lr-progress-bar class="progress-bar" set="value: progressValue; visible: progressVisible; unknown: progressUnknown" ></lr-progress-bar></div>`;tt.activeInstances=new Set;var pe=class extends b{constructor(){super(...arguments);c(this,"historyTracked",!0);c(this,"activityType",g.activities.UPLOAD_LIST);c(this,"init$",{...this.ctxInit,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,headerText:"",hasFiles:!1,onAdd:()=>{this.initFlow(!0)},onUpload:()=>{this.$["*uploadTrigger"]={},this._updateUploadsState()},onDone:()=>{this.doneFlow()},onCancel:()=>{let t=this.getOutputData(e=>!!e.getValue("uuid"));k.emit(new D({type:S.REMOVE,ctx:this.ctxName,data:t})),this.uploadCollection.clearAll()}});c(this,"cssInit$",{"--cfg-multiple":1,"--cfg-multiple-min":0,"--cfg-multiple-max":0});c(this,"_debouncedHandleCollectionUpdate",Z(()=>{this.isConnected&&(this._updateUploadsState(),this._updateCountLimitMessage())},0))}_validateFilesCount(){var u,d;let t=!!this.getCssData("--cfg-multiple"),e=t?(u=this.getCssData("--cfg-multiple-min"))!=null?u:0:1,r=t?(d=this.getCssData("--cfg-multiple-max"))!=null?d:0:1,n=this.uploadCollection.size,o=e?n<e:!1,a=r?n>r:!1;return{passed:!o&&!a,tooFew:o,tooMany:a,min:e,max:r,exact:r===n}}_updateCountLimitMessage(){let t=this.uploadCollection.size,e=this._validateFilesCount();if(t&&!e.passed){let r=new Kt,n=e.tooFew?"files-count-limit-error-too-few":"files-count-limit-error-too-many";r.caption=this.l10n("files-count-limit-error-title"),r.text=this.l10n(n,{min:e.min,max:e.max,total:t}),r.isError=!0,this.set$({"*message":r})}}_updateUploadsState(){let t=this.uploadCollection.items(),r={total:t.length,succeed:0,uploading:0,failed:0};for(let p of t){let m=this.uploadCollection.read(p);m.getValue("uuid")&&!m.getValue("validationErrorMsg")&&(r.succeed+=1),m.getValue("isUploading")&&(r.uploading+=1),(m.getValue("validationErrorMsg")||m.getValue("uploadError"))&&(r.failed+=1)}let n=r.total===r.succeed+r.failed,{passed:o,tooMany:a,exact:l}=this._validateFilesCount(),h=r.failed===0,u=r.total>0&&o&&h,d=!n&&r.total-r.succeed-r.uploading-r.failed>0&&o;this.set$({doneBtnVisible:n,doneBtnEnabled:u,uploadBtnVisible:d,addMoreBtnEnabled:r.total===0||!a&&!l,addMoreBtnVisible:!l||this.getCssData("--cfg-multiple"),headerText:this._getHeaderText(r)})}_getHeaderText(t){let e=r=>{let n=t[r];return this.l10n(`header-${r}`,{count:n})};return t.uploading>0?e("uploading"):t.failed>0?e("failed"):t.succeed>0?e("succeed"):e("total")}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.sub("--cfg-multiple",this._debouncedHandleCollectionUpdate),this.sub("--cfg-multiple-min",this._debouncedHandleCollectionUpdate),this.sub("--cfg-multiple-max",this._debouncedHandleCollectionUpdate),this.sub("*currentActivity",t=>{var e;((e=this.uploadCollection)==null?void 0:e.size)===0&&!this.getCssData("--cfg-show-empty-list")&&t===this.activityType&&(this.$["*currentActivity"]=this.initActivity)}),this.uploadCollection.observe(this._debouncedHandleCollectionUpdate),this.sub("*uploadList",t=>{this._debouncedHandleCollectionUpdate(),this.set$({hasFiles:t.length>0}),(t==null?void 0:t.length)===0&&!this.getCssData("--cfg-show-empty-list")&&this.historyBack()})}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserve(this._debouncedHandleCollectionUpdate)}};pe.template=`<lr-activity-header><span class="header-text">{{headerText}}</span><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="no-files" set="@hidden: hasFiles"><slot name="empty"><span l10n="no-files"></span></slot></div><div class="files" repeat="*uploadList" repeat-item-tag="lr-file-item"></div><div class="toolbar"><button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel;" l10n="clear"></button><div class="toolbar-spacer"></div><button type="button" class="add-more-btn secondary-btn" set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible" ><lr-icon name="add"></lr-icon><span l10n="add-more"></span></button><button type="button" class="upload-btn primary-btn" set="@hidden: !uploadBtnVisible; onclick: onUpload;" l10n="upload" ></button><button type="button" class="done-btn primary-btn" set="@hidden: !doneBtnVisible; onclick: onDone; @disabled: !doneBtnEnabled" l10n="done" ></button></div><lr-drop-area ghost></lr-drop-area>`;var me=class extends b{constructor(){super(...arguments);c(this,"activityType",g.activities.URL);c(this,"init$",{...this.ctxInit,importDisabled:!0,onUpload:()=>{let t=this.ref.input.value;this.uploadCollection.add({externalUrl:t}),this.$["*currentActivity"]=g.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()},onInput:t=>{let e=t.target.value;this.set$({importDisabled:!e})}})}initCallback(){super.initCallback(),this.registerActivity(this.activityType)}};me.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><div><lr-icon name="url"></lr-icon><span l10n="caption-from-url"></span></div><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="content"><input placeholder="https://" class="url-input" type="text" ref="input" set="oninput: onInput" /><button type="button" class="url-upload-btn primary-btn" set="onclick: onUpload; @disabled: importDisabled" ></button></div>`;var zi=()=>typeof navigator.permissions!="undefined";var fe=class extends b{constructor(){super(...arguments);c(this,"activityType",g.activities.CAMERA);c(this,"_unsubPermissions",null);c(this,"init$",{...this.ctxInit,video:null,videoTransformCss:null,shotBtnDisabled:!0,videoHidden:!0,messageHidden:!0,requestBtnHidden:zi(),l10nMessage:null,originalErrorMessage:null,cameraSelectOptions:null,cameraSelectHidden:!0,onCameraSelectChange:t=>{this._selectedCameraId=t.target.value,this._capture()},onCancel:()=>{this.historyBack()},onShot:()=>{this._shot()},onRequestPermissions:()=>{this._capture()}});c(this,"cssInit$",{"--cfg-camera-mirror":1});c(this,"_onActivate",()=>{zi()&&this._subscribePermissions(),this._capture()});c(this,"_onDeactivate",()=>{this._unsubPermissions&&this._unsubPermissions(),this._stopCapture()});c(this,"_handlePermissionsChange",()=>{this._capture()});c(this,"_setPermissionsState",Z(t=>{this.$.originalErrorMessage=null,this.classList.toggle("initialized",t==="granted"),t==="granted"?this.set$({videoHidden:!1,shotBtnDisabled:!1,messageHidden:!0}):t==="prompt"?(this.$.l10nMessage=this.l10n("camera-permissions-prompt"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage=this.l10n("camera-permissions-denied"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture())},300))}async _subscribePermissions(){try{(await navigator.permissions.query({name:"camera"})).addEventListener("change",this._handlePermissionsChange)}catch(t){console.log("Failed to use permissions API. Fallback to manual request mode.",t),this._capture()}}async _capture(){let t={video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1};this._selectedCameraId&&(t.video.deviceId={exact:this._selectedCameraId}),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d");try{this._setPermissionsState("prompt");let e=await navigator.mediaDevices.getUserMedia(t);e.addEventListener("inactive",()=>{this._setPermissionsState("denied")}),this.$.video=e,this._capturing=!0,this._setPermissionsState("granted")}catch(e){this._setPermissionsState("denied"),this.$.originalErrorMessage=e.message}}_stopCapture(){var t;this._capturing&&((t=this.$.video)==null||t.getTracks()[0].stop(),this.$.video=null,this._capturing=!1)}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let t=Date.now(),e=`camera-${t}.png`;this._canvas.toBlob(r=>{let n=new File([r],e,{lastModified:t,type:"image/png"});this.uploadCollection.add({file:n,fileName:e,fileSize:n.size,isImage:!0,mimeType:n.type}),this.set$({"*currentActivity":g.activities.UPLOAD_LIST})})}async initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:this._onActivate,onDeactivate:this._onDeactivate}),this.sub("--cfg-camera-mirror",t=>{this.$.videoTransformCss=t?"scaleX(-1)":null});try{let e=(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="videoinput").map((r,n)=>({text:r.label.trim()||`${this.l10n("caption-camera")} ${n+1}`,value:r.deviceId}));e.length>1&&(this.$.cameraSelectOptions=e,this.$.cameraSelectHidden=!1)}catch{}}};fe.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><div set="@hidden: !cameraSelectHidden"><lr-icon name="camera"></lr-icon><span l10n="caption-camera"></span></div><lr-select class="camera-select" set="$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange" ></lr-select><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="content"><video autoplay playsinline set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden" ref="video" ></video><div class="message-box" set="@hidden: messageHidden"><span>{{l10nMessage}}</span><span>{{originalErrorMessage}}</span><button type="button" set="onclick: onRequestPermissions; @hidden: requestBtnHidden" l10n="camera-permissions-request" ></button></div><button type="button" class="shot-btn" set="onclick: onShot; @disabled: shotBtnDisabled"><lr-icon name="camera"></lr-icon></button></div>`;var ni=class extends b{};var ge=class extends b{constructor(){super(...arguments);c(this,"activityType",g.activities.DETAILS);c(this,"pauseRender",!0);c(this,"init$",{...this.ctxInit,checkerboard:!1,fileSize:null,fileName:"",cdnUrl:"",errorTxt:"",cloudEditBtnHidden:!0,onNameInput:null,onBack:()=>{this.historyBack()},onRemove:()=>{this.uploadCollection.remove(this.entry.uid),this.historyBack()},onCloudEdit:()=>{this.entry.getValue("uuid")&&(this.$["*currentActivity"]=g.activities.CLOUD_IMG_EDIT)}});c(this,"cssInit$",{"--cfg-use-cloud-image-editor":0,"--cfg-use-local-image-editor":0})}showNonImageThumb(){let t=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon"),e=de(t,108,108);this.ref.filePreview.setImageUrl(e),this.set$({checkerboard:!1})}initCallback(){super.initCallback(),this.render(),this.$.fileSize=this.l10n("file-size-unknown"),this.registerActivity(this.activityType,{onDeactivate:()=>{this.ref.filePreview.clear()}}),this.sub("*focusedEntry",t=>{if(!t)return;this._entrySubs?this._entrySubs.forEach(n=>{this._entrySubs.delete(n),n.remove()}):this._entrySubs=new Set,this.entry=t;let e=t.getValue("file");if(e){this._file=e;let n=Mt(this._file);n&&!t.getValue("cdnUrl")&&(this.ref.filePreview.setImageFile(this._file),this.set$({checkerboard:!0})),n||this.showNonImageThumb()}let r=(n,o)=>{this._entrySubs.add(this.entry.subscribe(n,o))};r("fileName",n=>{this.$.fileName=n,this.$.onNameInput=()=>{let o=this.ref.file_name_input.value;Object.defineProperty(this._file,"name",{writable:!0,value:o}),this.entry.setValue("fileName",o)}}),r("fileSize",n=>{this.$.fileSize=Number.isFinite(n)?this.fileSizeFmt(n):this.l10n("file-size-unknown")}),r("uploadError",n=>{this.$.errorTxt=n==null?void 0:n.message}),r("externalUrl",n=>{n&&(this.entry.getValue("uuid")||this.showNonImageThumb())}),r("cdnUrl",n=>{let o=this.$["--cfg-use-cloud-image-editor"]&&n&&this.entry.getValue("isImage");if(n&&this.ref.filePreview.clear(),this.set$({cdnUrl:n,cloudEditBtnHidden:!o}),n&&this.entry.getValue("isImage")){let a=$(n,O("format/auto","preview"));this.ref.filePreview.setImageUrl(this.proxyUrl(a))}})})}};ge.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><span l10n="caption-edit-file"></span><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="content"><lr-tabs tab-list="tab-view, tab-details"><div tab-ctx="tab-details" class="details"><div class="info-block"><div class="info-block_name" l10n="file-name"></div><input name="name-input" ref="file_name_input" set="value: fileName; oninput: onNameInput; @disabled: !!cdnUrl" type="text" /></div><div class="info-block"><div class="info-block_name" l10n="file-size"></div><div>{{fileSize}}</div></div><div class="info-block"><div class="info-block_name" l10n="cdn-url"></div><a class="cdn-link" target="_blank" set="@href: cdnUrl; @disabled: !cdnUrl">{{cdnUrl}}</a></div><div>{{errorTxt}}</div></div><lr-file-preview tab-ctx="tab-view" set="@checkerboard: checkerboard;" ref="filePreview"></lr-file-preview></lr-tabs><div class="toolbar" set="@edit-disabled: cloudEditBtnHidden"><button type="button" class="edit-btn secondary-btn" set="onclick: onCloudEdit; @hidden: cloudEditBtnHidden;"><lr-icon name="edit"></lr-icon><span l10n="edit-image"></span></button><button type="button" class="remove-btn secondary-btn" set="onclick: onRemove"><lr-icon name="remove"></lr-icon><span l10n="remove-from-list"></span></button><div></div><button type="button" class="back-btn primary-btn" set="onclick: onBack"><span l10n="ok"></span></button></div></div>`;var Hi=class{constructor(){c(this,"captionL10nStr","confirm-your-action");c(this,"messageL10Str","are-you-sure");c(this,"confirmL10nStr","yes");c(this,"denyL10nStr","no")}confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}},_e=class extends g{constructor(){super(...arguments);c(this,"activityType",g.activities.CONFIRMATION);c(this,"_defaults",new Hi);c(this,"init$",{...this.ctxInit,activityCaption:"",messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)})}initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",t=>{t&&this.set$({"*currentActivity":g.activities.CONFIRMATION,activityCaption:this.l10n(t.captionL10nStr),messageTxt:this.l10n(t.messageL10Str),confirmBtnTxt:this.l10n(t.confirmL10nStr),denyBtnTxt:this.l10n(t.denyL10nStr),onDeny:()=>{t.denyAction()},onConfirm:()=>{t.confirmAction()}})})}};_e.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><span>{{activityCaption}}</span><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="message">{{messageTxt}}</div><div class="toolbar"><button type="button" class="deny-btn secondary-btn" set="onclick: onDeny">{{denyBtnTxt}}</button><button type="button" class="confirm-btn primary-btn" set="onclick: onConfirm">{{confirmBtnTxt}}</button></div>`;var be=class extends b{constructor(){super(...arguments);c(this,"init$",{...this.ctxInit,visible:!1,unknown:!1,value:0,"*commonProgress":0})}initCallback(){super.initCallback(),this.uploadCollection.observe(()=>{let t=this.uploadCollection.items().some(e=>this.uploadCollection.read(e).getValue("isUploading"));this.$.visible=t}),this.sub("visible",t=>{t?this.setAttribute("active",""):this.removeAttribute("active")}),this.sub("*commonProgress",t=>{this.$.value=t})}};be.template=`<lr-progress-bar set="visible: visible; unknown: unknown; value: value"></lr-progress-bar>`;var ve=class extends f{constructor(){super(...arguments);c(this,"_value",0);c(this,"_unknownMode",!1);c(this,"init$",{...this.ctxInit,width:0,opacity:0})}initCallback(){super.initCallback(),this.defineAccessor("value",t=>{t!==void 0&&(this._value=t,this._unknownMode||this.style.setProperty("--l-width",this._value.toString()))}),this.defineAccessor("visible",t=>{this.ref.line.classList.toggle("progress--hidden",!t)}),this.defineAccessor("unknown",t=>{this._unknownMode=t,this.ref.line.classList.toggle("progress--unknown",t)})}};ve.template='<div ref="line" class="progress"></div>';var j="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";var Yt=class extends f{constructor(){super();c(this,"init$",{...this.ctxInit,checkerboard:!1,src:j})}initCallback(){super.initCallback(),this.sub("checkerboard",()=>{this.style.backgroundImage=this.hasAttribute("checkerboard")?`url(${Fs()})`:"unset"})}destroyCallback(){super.destroyCallback(),URL.revokeObjectURL(this._lastObjectUrl)}setImage(t){this.$.src=t.src}setImageFile(t){let e=URL.createObjectURL(t);this.$.src=e,this._lastObjectUrl=e}setImageUrl(t){this.$.src=t}clear(){URL.revokeObjectURL(this._lastObjectUrl),this.$.src=j}};Yt.template='<lr-img class="img-view" ref="img" set="@src: src; style.aa: src;" />';Yt.bindAttributes({checkerboard:"checkerboard"});function Vs(...s){return s.reduce((i,t)=>{if(typeof t=="string")return i[t]=!0,i;for(let e of Object.keys(t))i[e]=t[e];return i},{})}function U(...s){let i=Vs(...s);return Object.keys(i).reduce((t,e)=>(i[e]&&t.push(e),t),[]).join(" ")}function zs(s,...i){let t=Vs(...i);for(let e of Object.keys(t))s.classList.toggle(e,t[e])}function et(s,i){let t,e=(...r)=>{clearTimeout(t),t=setTimeout(()=>s(...r),i)};return e.cancel=()=>{clearTimeout(t)},e}var W={brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0};function jn(s,i){if(typeof i=="number")return W[s]!==i?`${s}/${i}`:"";if(typeof i=="boolean")return i&&W[s]!==i?`${s}`:"";if(s==="filter"){if(!i||W[s]===i.amount)return"";let{name:t,amount:e}=i;return`${s}/${t}/${e}`}if(s==="crop"){if(!i)return"";let{dimensions:t,coords:e}=i;return`${s}/${t.join("x")}/${e.join(",")}`}return""}var js=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function bt(s){return ti(...js.filter(i=>typeof s[i]!="undefined"&&s[i]!==null).map(i=>{let t=s[i];return jn(i,t)}).filter(i=>!!i))}var oi=ti("format/auto","progressive/yes"),ht=([s])=>typeof s!="undefined"?Number(s):void 0,Hs=()=>!0,Wn=([s,i])=>({name:s,amount:typeof i!="undefined"?Number(i):100}),Xn=([s,i])=>({dimensions:R(s,"x").map(Number),coords:R(i).map(Number)}),Gn={enhance:ht,brightness:ht,exposure:ht,gamma:ht,contrast:ht,saturation:ht,vibrance:ht,warmth:ht,filter:Wn,mirror:Hs,flip:Hs,rotate:ht,crop:Xn};function Ws(s){let i={};for(let t of s){let[e,...r]=t.split("/");if(!js.includes(e))continue;let n=Gn[e],o=n(r);i[e]=o}return i}function Xs(s){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:j,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let i=s.querySelectorAll("img");for(let t of i){let e=t.src;t.src=j,t.src=e}s.$["*networkProblems"]=!1},"*on.apply":i=>{if(!i)return;let t=s.$["*originalUrl"],e=O(bt(i)),r=$(t,O(e,"preview")),n={originalUrl:t,cdnUrlModifiers:e,cdnUrl:r,transformations:i};s.dispatchEvent(new CustomEvent("apply",{detail:n,bubbles:!0,composed:!0})),s.remove()},"*on.cancel":()=>{s.remove(),s.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}var Gs=`<div class="wrapper wrapper_desktop"><lr-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;"><div class="network_problems_content"><div class="network_problems_icon"><lr-icon size="20" name="sad"></lr-icon></div><div class="network_problems_text">Network error</div></div><div class="network_problems_footer"><lr-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></lr-btn-ui></div></lr-presence-toggle><div class="viewport"><div class="file_type_outer"><div class="file_type">{{fileType}}</div></div><div class="image_container" ref="img-container-el"><img src="${j}" class="image image_visible_from_editor" ref="img-el" /><lr-editor-image-cropper ref="cropper-el"></lr-editor-image-cropper><lr-editor-image-fader ref="fader-el"></lr-editor-image-fader></div><div class="info_pan">{{msg}}</div></div><div class="toolbar"><lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="toolbar_content toolbar_content__editor"><lr-editor-toolbar></lr-editor-toolbar></div></div></div>`;var B={CROP:"crop",SLIDERS:"sliders",FILTERS:"filters"},ai=[B.CROP,B.SLIDERS,B.FILTERS],qs=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],Ks=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],Ys=["rotate","mirror","flip"],it={brightness:{zero:W.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:W.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:W.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:W.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:W.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:W.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:W.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:W.enhance,range:[0,100],keypointsNumber:1},filter:{zero:W.filter,range:[0,100],keypointsNumber:1}};var vt=class extends f{constructor(){super(...arguments);c(this,"pauseRender",!0);c(this,"init$",{...this.ctxInit,...Xs(this)});c(this,"_debouncedShowLoader",et(this._showLoader.bind(this),300));c(this,"cssInit$",{"--cfg-cdn-cname":"https://ucarecdn.com"})}get ctxName(){return this.autoCtxName}_showLoader(t){this.$.showLoader=t}_waitForSize(){return new Promise((e,r)=>{let n=setTimeout(()=>{r(new Error("[cloud-image-editor] timout waiting for non-zero container size"))},3e3),o=new ResizeObserver(([a])=>{a.contentRect.width>0&&a.contentRect.height>0&&(e(),clearTimeout(n),o.disconnect())});o.observe(this)})}async connectedCallback(){super.connectedCallback();try{await this._waitForSize()}catch(t){this.isConnected&&console.error(t.message);return}this.render(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.ref["img-el"].addEventListener("load",t=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==j&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",t=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",t=>{let e=this.ref["img-el"];e.src!==t&&(this._imgLoading=!0,e.src=t||j)}),this.sub("*tabId",t=>{this.ref["img-el"].className=U("image",{image_hidden_to_cropper:t===B.CROP,image_hidden_effects:t!==B.CROP})})}initCallback(){if(super.initCallback(),this.$.cdnUrl){let t=As(this.$.cdnUrl);this.$["*originalUrl"]=_t(this.$.cdnUrl,t);let e=$s(this.$.cdnUrl),r=Ws(e);this.$["*editorTransformations"]=r}else if(this.$.uuid)this.$["*originalUrl"]=_t(this.localCtx.read("--cfg-cdn-cname"),this.$.uuid);else throw new Error("No UUID nor CDN URL provided");this.classList.add("editor_ON"),this.sub("*networkProblems",t=>{this.$["presence.networkProblems"]=t,this.$["presence.modalCaption"]=!t}),this.sub("*editorTransformations",t=>{let e=this.$["*originalUrl"],r=O(bt(t)),n=$(e,O(r,"preview")),o={originalUrl:e,cdnUrlModifiers:r,cdnUrl:n,transformations:t};this.dispatchEvent(new CustomEvent("change",{detail:o,bubbles:!0,composed:!0}))},!1);try{fetch($(this.$["*originalUrl"],O("json"))).then(t=>t.json()).then(({width:t,height:e})=>{this.$["*imageSize"]={width:t,height:e}})}catch(t){t&&console.error("Failed to load image info",t)}}};vt.template=Gs;vt.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl"});var ye=33.333333333333336,G=24*2+34;function It(s,i){for(let t in i)s.setAttributeNS(null,t,i[t].toString())}function q(s,i={}){let t=document.createElementNS("http://www.w3.org/2000/svg",s);return It(t,i),t}function Zs(s,i){let{x:t,y:e,width:r,height:n}=s,o=i.includes("w")?0:1,a=i.includes("n")?0:1,l=[-1,1][o],h=[-1,1][a],u=[t+o*r+1.5*l,e+a*n+1.5*h-24*h],d=[t+o*r+1.5*l,e+a*n+1.5*h],p=[t+o*r-24*l+1.5*l,e+a*n+1.5*h];return{d:`M ${u[0]} ${u[1]} L ${d[0]} ${d[1]} L ${p[0]} ${p[1]}`,center:d}}function Js(s,i){let{x:t,y:e,width:r,height:n}=s,o=["n","s"].includes(i)?.5:{w:0,e:1}[i],a=["w","e"].includes(i)?.5:{n:0,s:1}[i],l=[-1,1][o],h=[-1,1][a],u,d;["n","s"].includes(i)?(u=[t+o*r-34/2,e+a*n+1.5*h],d=[t+o*r+34/2,e+a*n+1.5*h]):(u=[t+o*r+1.5*l,e+a*n-34/2],d=[t+o*r+1.5*l,e+a*n+34/2]);let p=`M ${u[0]} ${u[1]} L ${d[0]} ${d[1]}`,m=[d[0]-(d[0]-u[0])/2,d[1]-(d[1]-u[1])/2];return{d:p,center:m}}function Qs(s){return s===""?"move":["e","w"].includes(s)?"ew-resize":["n","s"].includes(s)?"ns-resize":["nw","se"].includes(s)?"nwse-resize":"nesw-resize"}function tr(s,[i,t]){return{...s,x:s.x+i,y:s.y+t}}function li(s,i){let{x:t}=s,{y:e}=s;return s.x<i.x?t=i.x:s.x+s.width>i.x+i.width&&(t=i.x+i.width-s.width),s.y<i.y?e=i.y:s.y+s.height>i.y+i.height&&(e=i.y+i.height-s.height),{...s,x:t,y:e}}function er(s,[i,t],e){let{x:r,y:n,width:o,height:a}=s;return e.includes("n")&&(n+=t,a-=t),e.includes("s")&&(a+=t),e.includes("w")&&(r+=i,o-=i),e.includes("e")&&(o+=i),{x:r,y:n,width:o,height:a}}function ir(s,i){let t=Math.max(s.x,i.x),e=Math.min(s.x+s.width,i.x+i.width),r=Math.max(s.y,i.y),n=Math.min(s.y+s.height,i.y+i.height);return{x:t,y:r,width:e-t,height:n-r}}function ci(s,[i,t],e){let{x:r,y:n,width:o,height:a}=s;if(e.includes("n")){let l=a;a=Math.max(t,a),n=n+l-a}if(e.includes("s")&&(a=Math.max(t,a)),e.includes("w")){let l=o;o=Math.max(i,o),r=r+l-o}return e.includes("e")&&(o=Math.max(i,o)),{x:r,y:n,width:o,height:a}}function sr(s,[i,t]){return s.x<=i&&i<=s.x+s.width&&s.y<=t&&t<=s.y+s.height}var Ce=class extends f{constructor(){super();c(this,"init$",{...this.ctxInit,dragging:!1});this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(t){let e=this.$["*imageBox"];if(!e)return;if(t===""&&e.height<=G&&e.width<=G)return!0;let r=e.height<=G&&(t.includes("n")||t.includes("s")),n=e.width<=G&&(t.includes("e")||t.includes("w"));return r||n}_createBackdrop(){let t=this.$["*cropBox"];if(!t)return;let{x:e,y:r,width:n,height:o}=t,a=this.ref["svg-el"],l=q("mask",{id:"backdrop-mask"}),h=q("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),u=q("rect",{x:e,y:r,width:n,height:o,fill:"black"});l.appendChild(h),l.appendChild(u);let d=q("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});a.appendChild(d),a.appendChild(l),this._backdropMask=l,this._backdropMaskInner=u}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask.style.display="block"}))}_updateBackdrop(){let t=this.$["*cropBox"];if(!t)return;let{x:e,y:r,width:n,height:o}=t;It(this._backdropMaskInner,{x:e,y:r,width:n,height:o})}_updateFrame(){let t=this.$["*cropBox"];if(!t)return;for(let r of Object.values(this._frameThumbs)){let{direction:n,pathNode:o,interactionNode:a,groupNode:l}=r,h=n==="",u=n.length===2;if(h){let{x:p,y:m,width:_,height:x}=t,C=[p+_/2,m+x/2];It(a,{r:Math.min(_,x)/3,cx:C[0],cy:C[1]})}else{let{d:p,center:m}=u?Zs(t,n):Js(t,n);It(a,{cx:m[0],cy:m[1]}),It(o,{d:p})}let d=this._shouldThumbBeDisabled(n);l.setAttribute("class",U("thumb",{"thumb--hidden":d,"thumb--visible":!d}))}let e=this._frameGuides;It(e,{x:t.x-1*.5,y:t.y-1*.5,width:t.width+1,height:t.height+1})}_createThumbs(){let t={};for(let e=0;e<3;e++)for(let r=0;r<3;r++){let n=`${["n","","s"][e]}${["w","","e"][r]}`,o=q("g");o.classList.add("thumb"),o.setAttribute("with-effects","");let a=q("circle",{r:24+1.5,fill:"transparent"}),l=q("path",{stroke:"currentColor",fill:"none","stroke-width":3});o.appendChild(l),o.appendChild(a),t[n]={direction:n,pathNode:l,interactionNode:a,groupNode:o},a.addEventListener("pointerdown",this._handlePointerDown.bind(this,n))}return t}_createGuides(){let t=q("svg"),e=q("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});t.appendChild(e);for(let r=1;r<=2;r++){let n=q("line",{x1:`${ye*r}%`,y1:"0%",x2:`${ye*r}%`,y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});t.appendChild(n)}for(let r=1;r<=2;r++){let n=q("line",{x1:"0%",y1:`${ye*r}%`,x2:"100%",y2:`${ye*r}%`,stroke:"#000000","stroke-width":1,"stroke-opacity":.3});t.appendChild(n)}return t.classList.add("guides","guides--semi-hidden"),t}_createFrame(){let t=this.ref["svg-el"],e=document.createDocumentFragment(),r=this._createGuides();e.appendChild(r);let n=this._createThumbs();for(let{groupNode:o}of Object.values(n))e.appendChild(o);t.appendChild(e),this._frameThumbs=n,this._frameGuides=r}_handlePointerDown(t,e){let r=this._frameThumbs[t];if(this._shouldThumbBeDisabled(t))return;let n=this.$["*cropBox"],{x:o,y:a}=this.ref["svg-el"].getBoundingClientRect(),l=e.x-o,h=e.y-a;this.$.dragging=!0,this._draggingThumb=r,this._dragStartPoint=[l,h],this._dragStartCrop={...n}}_handlePointerUp_(t){this._updateCursor(),this.$.dragging&&(t.stopPropagation(),t.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(t){if(!this.$.dragging)return;t.stopPropagation(),t.preventDefault();let e=this.ref["svg-el"],{x:r,y:n}=e.getBoundingClientRect(),o=t.x-r,a=t.y-n,l=o-this._dragStartPoint[0],h=a-this._dragStartPoint[1],{direction:u}=this._draggingThumb,d=this.$["*imageBox"],p=this._dragStartCrop;u===""?(p=tr(p,[l,h]),p=li(p,d)):(p=er(p,[l,h],u),p=ir(p,d));let m=[Math.min(d.width,G),Math.min(d.height,G)];if(p=ci(p,m,u),!Object.values(p).every(_=>Number.isFinite(_)&&_>=0)){console.error("CropFrame is trying to create invalid rectangle",{payload:p});return}this.$["*cropBox"]=p}_handleSvgPointerMove_(t){let e=Object.values(this._frameThumbs).find(r=>{if(this._shouldThumbBeDisabled(r.direction))return!1;let o=r.groupNode.getBoundingClientRect(),a={x:o.x,y:o.y,width:o.width,height:o.height};return sr(a,[t.x,t.y])});this._hoverThumb=e,this._updateCursor()}_updateCursor(){let t=this._hoverThumb;this.ref["svg-el"].style.cursor=t?Qs(t.direction):"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(t){Object.values(this._frameThumbs).map(({groupNode:e})=>e).forEach(e=>{e.setAttribute("class",U("thumb",{"thumb--hidden":!t,"thumb--visible":t}))})}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",t=>{t&&(this._guidesHidden=t.height<=G||t.width<=G,window.requestAnimationFrame(()=>{this._render()}))}),this.sub("dragging",t=>{this._frameGuides.setAttribute("class",U({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&t,"guides--semi-hidden":!this._guidesHidden&&!t}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}};Ce.template='<svg class="svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg>';var ut=class extends f{constructor(){super(...arguments);c(this,"init$",{...this.ctxInit,active:!1,title:"",icon:"","on.click":null})}initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.sub("title",t=>{this._titleEl&&(this._titleEl.style.display=t?"block":"none")}),this.sub("active",t=>{this.className=U({active:t,not_active:!t})}),this.sub("on.click",t=>{this.onclick=t})}};ut.template=`<div class="before"></div><lr-icon size="20" set="@name: icon;"></lr-icon><div class="title" ref="title-el">{{title}}</div>`;function Kn(s){let i=s+90;return i=i>=360?0:i,i}function Yn(s,i){return s==="rotate"?Kn(i):["mirror","flip"].includes(s)?!i:null}var Ot=class extends ut{initCallback(){super.initCallback(),this.defineAccessor("operation",i=>{i&&(this._operation=i,this.$.icon=i)}),this.$["on.click"]=i=>{let t=this.$["*cropperEl"].getValue(this._operation),e=Yn(this._operation,t);this.$["*cropperEl"].setValue(this._operation,e)}}};var xe={FILTER:"filter",COLOR_OPERATION:"color_operation"},st="original",we=class extends f{constructor(){super(...arguments);c(this,"init$",{...this.ctxInit,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":t=>{this.$["*faderEl"].set(t),this.$.value=t}})}setOperation(t,e){this._controlType=t==="filter"?xe.FILTER:xe.COLOR_OPERATION,this._operation=t,this._iconName=t,this._title=t.toUpperCase(),this._filter=e,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===st?void 0:this.$.value,filter:this._filter===st?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:t,zero:e}=it[this._operation],[r,n]=t;this.$.min=r,this.$.max=n,this.$.zero=e;let o=this.$["*editorTransformations"][this._operation];if(this._controlType===xe.FILTER){let a=n;if(o){let{name:l,amount:h}=o;a=l===this._filter?h:n}this.$.value=a,this.$.defaultValue=a}if(this._controlType===xe.COLOR_OPERATION){let a=typeof o!="undefined"?o:e;this.$.value=a,this.$.defaultValue=a}}apply(){let t;this._controlType===xe.FILTER?this._filter===st?t=null:t={name:this._filter,amount:this.$.value}:t=this.$.value;let e={...this.$["*editorTransformations"],[this._operation]:t};this.$["*editorTransformations"]=e}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",t=>{this._originalUrl=t}),this.sub("value",t=>{let e=`${this._filter||this._operation} ${t}`;this.$["*operationTooltip"]=e})}};we.template=`<lr-slider-ui ref="slider-el" set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;" ></lr-slider-ui>`;function Te(s){let i=new Image;return{promise:new Promise((r,n)=>{i.src=s,i.onload=r,i.onerror=n}),image:i,cancel:()=>{i.naturalWidth===0&&(i.src=j)}}}function Ee(s){let i=[];for(let n of s){let o=Te(n);i.push(o)}let t=i.map(n=>n.image);return{promise:Promise.allSettled(i.map(n=>n.promise)),images:t,cancel:()=>{i.forEach(n=>{n.cancel()})}}}var yt=class extends ut{constructor(){super(...arguments);c(this,"init$",{...this.ctxInit,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null})}_previewSrc(){let t=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),e=window.devicePixelRatio,r=Math.ceil(e*t),n=e>=2?"lightest":"normal",o=100,a={...this.$["*editorTransformations"]};return a[this._operation]=this._filter!==st?{name:this._filter,amount:o}:void 0,$(this._originalUrl,O(oi,bt(a),`quality/${n}`,`scale_crop/${r}x${r}/center`))}_observerCallback(t,e){if(t[0].isIntersecting){let n=this.proxyUrl(this._previewSrc()),o=this.ref["preview-el"],{promise:a,cancel:l}=Te(n);this._cancelPreload=l,a.catch(h=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:h})}).finally(()=>{o.style.backgroundImage=`url(${n})`,o.setAttribute("loaded",""),e.unobserve(this)})}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",e=>{this._operation="filter",this._filter=e,this.$.isOriginal=e===st,this.$.icon=this.$.isOriginal?"original":"slider"}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let t=this.$["*originalUrl"];this._originalUrl=t,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",e=>{this.$.active=e&&e===this._filter}),this.sub("isOriginal",e=>{this.$.iconSize=e?40:20}),this.sub("active",e=>{if(this.$.isOriginal)return;let r=this.ref["icon-el"];r.style.opacity=e?"1":"0";let n=this.ref["preview-el"];e?n.style.opacity="0":n.style.backgroundImage&&(n.style.opacity="1")}),this.sub("*networkProblems",e=>{if(!e){let r=this.proxyUrl(this._previewSrc()),n=this.ref["preview-el"];n.style.backgroundImage&&(n.style.backgroundImage="none",n.style.backgroundImage=`url(${r})`)}})}destroyCallback(){var t;super.destroyCallback(),(t=this._observer)==null||t.disconnect(),this._cancelPreload&&this._cancelPreload()}};yt.template=`<div class="before"></div><div class="preview" ref="preview-el"></div><lr-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></lr-icon>`;var Ut=class extends ut{constructor(){super(...arguments);c(this,"_operation","")}initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",t=>{t&&(this._operation=t,this.$.icon=t,this.$.title=this.l10n(t))}),this.sub("*editorTransformations",t=>{if(!this._operation)return;let{zero:e}=it[this._operation],r=t[this._operation],n=typeof r!="undefined"?r!==e:!1;this.$.active=n})}};function rr(s,i){let t={};for(let e of i){let r=s[e];(s.hasOwnProperty(e)||r!==void 0)&&(t[e]=r)}return t}function Zt(s,i,t){let r=window.devicePixelRatio,n=Math.min(Math.ceil(i*r),3e3),o=r>=2?"lightest":"normal";return $(s,O(oi,bt(t),`quality/${o}`,`stretch/off/-/resize/${n}x`))}function hi(s,i,t){return Math.min(Math.max(s,i),t)}function Ae({width:s,height:i},t){let e=t/90%2!==0;return{width:e?i:s,height:e?s:i}}function Jn(s){return s?[({dimensions:t,coords:e})=>[...t,...e].every(r=>Number.isInteger(r)&&Number.isFinite(r)),({dimensions:t,coords:e})=>t.every(r=>r>0)&&e.every(r=>r>=0)].every(t=>t(s)):!0}var $e=class extends f{constructor(){super();c(this,"init$",{...this.ctxInit,image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}});this._commitDebounced=et(this._commit.bind(this),300),this._handleResizeDebounced=et(this._handleResize.bind(this),10)}_handleResize(){this.isConnected&&(this.deactivate(),this.activate(this._imageSize,{fromViewer:!1}))}_syncTransformations(){let t=this.$["*editorTransformations"],e=rr(t,Object.keys(this.$["*operations"])),r={...this.$["*operations"],...e};this.$["*operations"]=r}_initCanvas(){let t=this.ref["canvas-el"],e=t.getContext("2d"),r=this.offsetWidth,n=this.offsetHeight,o=window.devicePixelRatio;t.style.width=`${r}px`,t.style.height=`${n}px`,t.width=r*o,t.height=n*o,e.scale(o,o),this._canvas=t,this._ctx=e}_alignImage(){if(!this._isActive||!this.$.image)return;let t=this.$.image,e=this.$["*padding"],r=this.$["*operations"],{rotate:n}=r,o={width:this.offsetWidth,height:this.offsetHeight},a=Ae({width:t.naturalWidth,height:t.naturalHeight},n);if(a.width>o.width-e*2||a.height>o.height-e*2){let l=a.width/a.height,h=o.width/o.height;if(l>h){let u=o.width-e*2,d=u/l,p=0+e,m=e+(o.height-e*2)/2-d/2;this.$["*imageBox"]={x:p,y:m,width:u,height:d}}else{let u=o.height-e*2,d=u*l,p=e+(o.width-e*2)/2-d/2,m=0+e;this.$["*imageBox"]={x:p,y:m,width:d,height:u}}}else{let{width:l,height:h}=a,u=e+(o.width-e*2)/2-l/2,d=e+(o.height-e*2)/2-h/2;this.$["*imageBox"]={x:u,y:d,width:l,height:h}}}_alignCrop(){let t=this.$["*cropBox"],e=this.$["*imageBox"],r=this.$["*operations"],{rotate:n}=r,o=this.$["*editorTransformations"].crop;if(o){let{dimensions:[l,h],coords:[u,d]}=o,{width:p,x:m,y:_}=this.$["*imageBox"],{width:x}=Ae(this._imageSize,n),C=p/x;t={x:m+u*C,y:_+d*C,width:l*C,height:h*C}}else t={x:e.x,y:e.y,width:e.width,height:e.height};let a=[Math.min(e.width,G),Math.min(e.height,G)];t=ci(t,a,"se"),t=li(t,e),this.$["*cropBox"]=t}_drawImage(){let t=this.$.image,e=this.$["*imageBox"],r=this.$["*operations"],{mirror:n,flip:o,rotate:a}=r,l=this._ctx,h=Ae({width:e.width,height:e.height},a);l.save(),l.translate(e.x+e.width/2,e.y+e.height/2),l.rotate(a*Math.PI*-1/180),l.scale(n?-1:1,o?-1:1),l.drawImage(t,-h.width/2,-h.height/2,h.width,h.height),l.restore()}_draw(){if(!this._isActive||!this.$.image)return;let t=this._canvas;this._ctx.clearRect(0,0,t.width,t.height),this._drawImage()}_animateIn({fromViewer:t}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout(()=>{this.className=U({active_from_viewer:t,active_from_editor:!t,inactive_to_editor:!1})}))}_calculateDimensions(){let t=this.$["*cropBox"],e=this.$["*imageBox"],r=this.$["*operations"],{rotate:n}=r,{width:o,height:a}=e,{width:l,height:h}=Ae(this._imageSize,n),{width:u,height:d}=t,p=o/l,m=a/h;return[hi(Math.round(u/p),1,l),hi(Math.round(d/m),1,h)]}_calculateCrop(){let t=this.$["*cropBox"],e=this.$["*imageBox"],r=this.$["*operations"],{rotate:n}=r,{width:o,height:a,x:l,y:h}=e,{width:u,height:d}=Ae(this._imageSize,n),{x:p,y:m}=t,_=o/u,x=a/d,C=this._calculateDimensions(),A={dimensions:C,coords:[hi(Math.round((p-l)/_),0,u-C[0]),hi(Math.round((m-h)/x),0,d-C[1])]};if(!Jn(A)){console.error("Cropper is trying to create invalid crop object",{payload:A});return}if(!(C[0]===u&&C[1]===d))return A}_commit(){if(!this.isConnected)return;let t=this.$["*operations"],{rotate:e,mirror:r,flip:n}=t,o=this._calculateCrop(),l={...this.$["*editorTransformations"],crop:o,rotate:e,mirror:r,flip:n};this.$["*editorTransformations"]=l}setValue(t,e){console.log(`Apply cropper operation [${t}=${e}]`),this.$["*operations"]={...this.$["*operations"],[t]:e},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(t){return this.$["*operations"][t]}async activate(t,{fromViewer:e}){if(!this._isActive){this._isActive=!0,this._imageSize=t,this.removeEventListener("transitionend",this._reset),this._initCanvas();try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw(),this._animateIn({fromViewer:e})}catch(r){console.error("Failed to activate cropper",{error:r})}}}deactivate(){this._isActive&&(this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=U({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}))}_transitionToCrop(){let t=this._calculateDimensions(),e=Math.min(this.offsetWidth,t[0])/this.$["*cropBox"].width,r=Math.min(this.offsetHeight,t[1])/this.$["*cropBox"].height,n=Math.min(e,r),o=this.$["*cropBox"].x+this.$["*cropBox"].width/2,a=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${n}) translate(${(this.offsetWidth/2-o)/n}px, ${(this.offsetHeight/2-a)/n}px)`,this.style.transformOrigin=`${o}px ${a}px`}_transitionToImage(){let t=this.$["*cropBox"].x+this.$["*cropBox"].width/2,e=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${t}px ${e}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(t,e){let r=this.offsetWidth;e={...e,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let n=this.proxyUrl(Zt(t,r,e)),{promise:o,cancel:a,image:l}=Te(n),h=this._handleImageLoading(n);return l.addEventListener("load",h,{once:!0}),l.addEventListener("error",h,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=a,o.then(()=>l).catch(u=>(console.error("Failed to load image",{error:u}),this.$["*networkProblems"]=!0,Promise.resolve(l)))}_handleImageLoading(t){let e="crop",r=this.$["*loadingOperations"];return r.get(e)||r.set(e,new Map),r.get(e).get(t)||(r.set(e,r.get(e).set(t,!0)),this.$["*loadingOperations"]=r),()=>{var n;(n=r==null?void 0:r.get(e))!=null&&n.has(t)&&(r.get(e).delete(t),this.$["*loadingOperations"]=r)}}initCallback(){super.initCallback(),this._observer=new ResizeObserver(([t])=>{t.contentRect.width>0&&t.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeDebounced()}),this._observer.observe(this),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",t=>{this.$.image&&this._commitDebounced()}),setTimeout(()=>{this.sub("*networkProblems",t=>{t||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}destroyCallback(){var t;super.destroyCallback(),(t=this._observer)==null||t.disconnect()}};$e.template=`<canvas class="canvas" ref="canvas-el"></canvas><lr-crop-frame ref="frame-el"></lr-crop-frame>`;function Xi(s,i,t){let e=Array(t);t--;for(let r=t;r>=0;r--)e[r]=Math.ceil((r*i+(t-r)*s)/t);return e}function Qn(s){return s.reduce((i,t,e)=>e<s.length-1?[...i,[t,s[e+1]]]:i,[])}function to(s,i,t){let e=Qn(s).find(([r,n])=>r<=i&&i<=n);return s.map(r=>{let n=Math.abs(e[0]-e[1]),o=Math.abs(i-e[0])/n;return e[0]===r?i>t?1:1-o:e[1]===r?i>=t?o:1:0})}function eo(s,i){return s.map((t,e)=>t<i?s.length-e:e)}function nr(s,i){let t=it[s].keypointsNumber,{range:e,zero:r}=it[s];return[...new Set([...Xi(e[0],r,t+1),...Xi(r,e[1],t+1),r,i])].sort((n,o)=>n-o)}var ui=class extends f{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=et(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(i){let t=this._operation,e=this.$["*loadingOperations"];return e.get(t)||e.set(t,new Map),e.get(t).get(i)||(e.set(t,e.get(t).set(i,!0)),this.$["*loadingOperations"]=e),()=>{var r;(r=e==null?void 0:e.get(t))!=null&&r.has(i)&&(e.get(t).delete(i),this.$["*loadingOperations"]=e)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let i of this._keypoints){let{image:t}=i;t&&(t.style.opacity=i.opacity.toString(),t.style.zIndex=i.zIndex.toString())}})}_imageSrc({url:i=this._url,filter:t=this._filter,operation:e,value:r}={}){let n={...this._transformations};e&&(n[e]=t?{name:t,amount:r}:r);let o=this.offsetWidth;return this.proxyUrl(Zt(i,o,n))}_constructKeypoint(i,t){return{src:this._imageSrc({operation:i,value:t}),image:null,opacity:0,zIndex:0,value:t}}_isSame(i,t){return this._operation===i&&this._filter===t}_addKeypoint(i,t,e){let r=()=>!this._isSame(i,t)||this._value!==e||!!this._keypoints.find(l=>l.value===e);if(r())return;let n=this._constructKeypoint(i,e),o=new Image;o.src=n.src;let a=this._handleImageLoading(n.src);o.addEventListener("load",a,{once:!0}),o.addEventListener("error",a,{once:!0}),n.image=o,o.classList.add("fader-image"),o.addEventListener("load",()=>{if(r())return;let l=this._keypoints,h=l.findIndex(d=>d.value>e),u=h<l.length?l[h].image:null;!this._container||u&&!this._container.contains(u)||(l.splice(h,0,n),this._container.insertBefore(o,u),this._update(i,e))},{once:!0}),o.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(i){i=typeof i=="string"?parseInt(i,10):i,this._update(this._operation,i),this._addKeypointDebounced(this._operation,this._filter,i)}_update(i,t){this._operation=i,this._value=t;let{zero:e}=it[i],r=this._keypoints.map(a=>a.value),n=to(r,t,e),o=eo(r,e);for(let[a,l]of Object.entries(this._keypoints))l.opacity=n[a],l.zIndex=o[a];this._flush()}_createPreviewImage(){let i=new Image;return i.classList.add("fader-image","fader-image--preview"),i.style.opacity="0",i}async _initNodes(){let i=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&i.appendChild(this._previewImage);let t=document.createElement("div");i.appendChild(t);let e=this._keypoints.map(h=>h.src),{images:r,promise:n,cancel:o}=Ee(e);r.forEach(h=>{let u=this._handleImageLoading(h.src);h.addEventListener("load",u),h.addEventListener("error",u)}),this._cancelLastImages=()=>{o(),this._cancelLastImages=void 0};let a=this._operation,l=this._filter;await n,this._isActive&&this._isSame(a,l)&&(this._container&&this._container.remove(),this._container=t,this._keypoints.forEach((h,u)=>{let d=r[u];d.classList.add("fader-image"),h.image=d,this._container.appendChild(d)}),this.appendChild(i),this._flush())}setTransformations(i){if(this._transformations=i,this._previewImage){let t=this._imageSrc(),e=this._handleImageLoading(t);this._previewImage.src=t,this._previewImage.addEventListener("load",e,{once:!0}),this._previewImage.addEventListener("error",e,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}preload({url:i,filter:t,operation:e,value:r}){this._cancelBatchPreload&&this._cancelBatchPreload();let o=nr(e,r).map(l=>this._imageSrc({url:i,filter:t,operation:e,value:l})),{cancel:a}=Ee(o);this._cancelBatchPreload=a}_setOriginalSrc(i){let t=this._previewImage||this._createPreviewImage();if(!this.contains(t)&&this.appendChild(t),this._previewImage=t,t.src===i){t.style.opacity="1",t.style.transform="scale(1)",this.className=U({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1});return}t.style.opacity="0";let e=this._handleImageLoading(i);t.addEventListener("error",e,{once:!0}),t.src=i,t.addEventListener("load",()=>{e(),t&&(t.style.opacity="1",t.style.transform="scale(1)",this.className=U({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}))},{once:!0}),t.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}activate({url:i,operation:t,value:e,filter:r,fromViewer:n}){if(this._isActive=!0,this._hidden=!1,this._url=i,this._operation=t||"initial",this._value=e,this._filter=r,this._fromViewer=n,typeof e!="number"&&!r){let a=this._imageSrc({operation:t,value:e});this._setOriginalSrc(a),this._container&&this._container.remove();return}this._keypoints=nr(t,e).map(a=>this._constructKeypoint(t,a)),this._update(t,e),this._initNodes()}deactivate({hide:i=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),i&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=U({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:!0}),this.addEventListener("transitionend",()=>{this._container&&this._container.remove()},{once:!0})):this._container&&this._container.remove()}};var io=1,ke=class extends f{initCallback(){super.initCallback(),this.addEventListener("wheel",i=>{i.preventDefault();let{deltaY:t,deltaX:e}=i;Math.abs(e)>io?this.scrollLeft+=e:this.scrollLeft+=t})}};ke.template=" <slot></slot> ";function so(s){return`<lr-btn-ui theme="boring" ref="tab-toggle-${s}" data-id="${s}" icon="${s}" tabindex="0" set="onclick: on.clickTab;" ></lr-btn-ui>`}function ro(s){return`<lr-presence-toggle class="tab-content" set="visible: presence.tabContent.${s}; styles: presence.tabContentStyles"><lr-editor-scroller hidden-scrollbar><div class="controls-list_align"><div class="controls-list_inner" ref="controls-list-${s}"></div></div></lr-editor-scroller></lr-presence-toggle>`}var Se=class extends f{constructor(){super();c(this,"_updateInfoTooltip",et(()=>{var n,o;let t=this.$["*editorTransformations"],e="",r=!1;if(this.$["*tabId"]===B.FILTERS)if(r=!0,this.$["*currentFilter"]&&((n=t==null?void 0:t.filter)==null?void 0:n.name)===this.$["*currentFilter"]){let a=((o=t==null?void 0:t.filter)==null?void 0:o.amount)||100;e=this.l10n(this.$["*currentFilter"])+" "+a}else e=this.l10n(st);else if(this.$["*tabId"]===B.SLIDERS&&this.$["*currentOperation"]){r=!0;let a=(t==null?void 0:t[this.$["*currentOperation"]])||it[this.$["*currentOperation"]].zero;e=this.$["*currentOperation"]+" "+a}r&&(this.$["*operationTooltip"]=e),this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",r)},0));this.init$={...this.ctxInit,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*currentFilter":st,"*currentOperation":null,"*tabId":B.CROP,showLoader:!1,filters:Ks,colorOperations:qs,cropOperations:Ys,"*operationTooltip":null,"l10n.cancel":this.l10n("cancel"),"l10n.apply":this.l10n("apply"),"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabContent.crop":!1,"presence.tabContent.sliders":!1,"presence.tabContent.filters":!1,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"on.cancel":t=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":t=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":t=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":t=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":t=>{let e=t.currentTarget.getAttribute("data-id");this._activateTab(e,{fromViewer:!1})}},this._debouncedShowLoader=et(this._showLoader.bind(this),500)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===B.SLIDERS&&this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",!1)}_createOperationControl(t){let e=Ut.is&&new Ut;return e.operation=t,e}_createFilterControl(t){let e=yt.is&&new yt;return e.filter=t,e}_createToggleControl(t){let e=Ot.is&&new Ot;return e.operation=t,e}_renderControlsList(t){let e=this.ref[`controls-list-${t}`],r=document.createDocumentFragment();t===B.CROP?this.$.cropOperations.forEach(n=>{let o=this._createToggleControl(n);r.appendChild(o)}):t===B.FILTERS?[st,...this.$.filters].forEach(n=>{let o=this._createFilterControl(n);r.appendChild(o)}):t===B.SLIDERS&&this.$.colorOperations.forEach(n=>{let o=this._createOperationControl(n);r.appendChild(o)}),r.childNodes.forEach((n,o)=>{o===r.childNodes.length-1&&n.classList.add("controls-list_last-item")}),e.innerHTML="",e.appendChild(r)}_activateTab(t,{fromViewer:e}){this.$["*tabId"]=t,t===B.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:e})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:e}),this.$["*cropperEl"].deactivate());for(let r of ai){let n=r===t,o=this.ref[`tab-toggle-${r}`];o.active=n,n?(this._renderControlsList(t),this._syncTabIndicator()):this._unmountTabControls(r),this.$[`presence.tabContent.${r}`]=n}}_unmountTabControls(t){let e=this.ref[`controls-list-${t}`];e&&(e.innerHTML="")}_syncTabIndicator(){let t=this.ref[`tab-toggle-${this.$["*tabId"]}`],e=this.ref["tabs-indicator"];e.style.transform=`translateX(${t.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let t=this.$["*imgContainerEl"].offsetWidth,e=this.proxyUrl(Zt(this.$["*originalUrl"],t,this.$["*editorTransformations"]));this._cancelPreload&&this._cancelPreload();let{cancel:r}=Ee([e]);this._cancelPreload=()=>{r(),this._cancelPreload=void 0}}}_showLoader(t){this.$.showLoader=t}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",t=>{t&&setTimeout(()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})},0)}),this.sub("*editorTransformations",t=>{var r;let e=(r=t==null?void 0:t.filter)==null?void 0:r.name;this.$["*currentFilter"]!==e&&(this.$["*currentFilter"]=e)}),this.sub("*currentFilter",()=>{this._updateInfoTooltip()}),this.sub("*currentOperation",()=>{this._updateInfoTooltip()}),this.sub("*tabId",()=>{this._updateInfoTooltip()}),this.sub("*originalUrl",t=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()}),this.sub("*editorTransformations",t=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(t)}),this.sub("*loadingOperations",t=>{let e=!1;for(let[,r]of t.entries()){if(e)break;for(let[,n]of r.entries())if(n){e=!0;break}}this._debouncedShowLoader(e)}),this.sub("*showSlider",t=>{this.$["presence.subToolbar"]=t,this.$["presence.mainToolbar"]=!t}),this._updateInfoTooltip()}};Se.template=`<lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="info-tooltip_container"><div class="info-tooltip_wrapper"><div ref="tooltip-el" class="info-tooltip info-tooltip_hidden">{{*operationTooltip}}</div></div></div><div class="toolbar-container"><lr-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles"><div class="tab-content-row">${ai.map(ro).join("")}</div><div class="controls-row"><lr-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"></lr-btn-ui><div class="tab-toggles"><div ref="tabs-indicator" class="tab-toggles_indicator"></div> ${ai.map(so).join("")} </div><lr-btn-ui theme="primary" icon="done" set="onclick: on.apply"></lr-btn-ui></div></lr-presence-toggle><lr-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles"><div class="slider"><lr-editor-slider ref="slider-el"></lr-editor-slider></div><div class="controls-row"><lr-btn-ui theme="boring" set="@text: l10n.cancel; onclick: on.cancelSlider;"></lr-btn-ui><lr-btn-ui theme="primary" set="@text: l10n.apply; onclick: on.applySlider;"></lr-btn-ui></div></lr-presence-toggle></div>`;var Jt=class extends f{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.ctxInit,text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",i=>{i?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return U("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",i=>{this._iconSingle=!this.$.text,this._iconHidden=!i,this.$.iconCss=this._iconCss()}),this.sub("theme",i=>{i!=="custom"&&(this.className=i)}),this.sub("text",i=>{this._iconSingle=!1}),this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(i){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}};Jt.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"});Jt.template=`<lr-icon size="20" set="className: iconCss; @name: icon;"></lr-icon><div class="text">{{text}}</div>`;var Ie=class extends f{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let i=this.ref["line-el"];i.style.transition="initial",i.style.opacity="0",i.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",i=>{typeof i=="boolean"&&(i?this._start():this._stop())})}_start(){this._active=!0;let{width:i}=this.getBoundingClientRect(),t=this.ref["line-el"];t.style.transition="transform 1s",t.style.opacity="1",t.style.transform=`translateX(${i}px)`,t.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}};Ie.template=`<div class="inner"><div class="line" ref="line-el"></div></div>`;var di={transition:"transition",visible:"visible",hidden:"hidden"},Re=class extends f{constructor(){super(),this._visible=!1,this._visibleStyle=di.visible,this._hiddenStyle=di.hidden,this._externalTransitions=!1,this.defineAccessor("styles",i=>{i&&(this._externalTransitions=!0,this._visibleStyle=i.visible,this._hiddenStyle=i.hidden)}),this.defineAccessor("visible",i=>{typeof i=="boolean"&&(this._visible=i,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",zs(this,{[di.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(di.transition),this._handleVisible(),setTimeout(()=>this.removeAttribute("hidden"),0)}};Re.template=" <slot></slot> ";var Oe=class extends f{constructor(){super();c(this,"init$",{...this.ctxInit,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t),this.$.onInput&&this.$.onInput(t)},"on.sliderChange":()=>{let t=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(t)}});this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",e=>{this.$.disabled=e}),this.defineAccessor("min",e=>{this.$.min=e}),this.defineAccessor("max",e=>{this.$.max=e}),this.defineAccessor("defaultValue",e=>{this.$.defaultValue=e,this.ref["input-el"].value=e,this._updateValue(e)}),this.defineAccessor("zero",e=>{this._zero=e}),this.defineAccessor("onInput",e=>{e&&(this.$.onInput=e)}),this.defineAccessor("onChange",e=>{e&&(this.$.onChange=e)}),this._updateSteps(),this._observer=new ResizeObserver(()=>{this._updateSteps();let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e)}),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e)},0),this.sub("disabled",e=>{let r=this.ref["input-el"];e?r.setAttribute("disabled","disabled"):r.removeAttribute("disabled")});let t=this.ref["input-el"];t.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),t.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}_updateValue(t){this._updateZeroDot(t);let{width:e}=this.getBoundingClientRect(),o=100/(this.$.max-this.$.min)*(t-this.$.min)*(e-this._thumbSize)/100;window.requestAnimationFrame(()=>{this.ref["thumb-el"].style.transform=`translateX(${o}px)`})}_updateZeroDot(t){if(!this._zeroDotEl)return;t===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:e}=this.getBoundingClientRect(),o=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(e-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl.style.transform=`translateX(${o}px)`})}_updateSteps(){let e=this.ref["steps-el"],{width:r}=e.getBoundingClientRect(),n=Math.ceil(r/2),o=Math.ceil(n/15)-2;if(this._stepsCount===o)return;let a=document.createDocumentFragment(),l=document.createElement("div"),h=document.createElement("div");l.className="minor-step",h.className="border-step",a.appendChild(h);for(let d=0;d<o;d++)a.appendChild(l.cloneNode());a.appendChild(h.cloneNode());for(let d=0;d<o;d++)a.appendChild(l.cloneNode());a.appendChild(h.cloneNode());let u=document.createElement("div");u.className="zero-dot",a.appendChild(u),this._zeroDotEl=u,e.innerHTML="",e.appendChild(a),this._stepsCount=o}destroyCallback(){var t;(t=this._observer)==null||t.disconnect()}};Oe.template=`<div class="steps" ref="steps-el"></div><div ref="thumb-el" class="thumb"></div><input class="input" type="range" ref="input-el" tabindex="0" set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;" />`;var pi=class extends b{constructor(){super(...arguments);c(this,"activityType",g.activities.CLOUD_IMG_EDIT);c(this,"init$",{...this.ctxInit,cdnUrl:null})}initCallback(){super.initCallback(),this.bindCssData("--cfg-pubkey"),this.registerActivity(this.activityType,{onActivate:()=>this.mountEditor(),onDeactivate:()=>this.unmountEditor()}),this.sub("*focusedEntry",t=>{t&&(this.entry=t,this.entry.subscribe("cdnUrl",e=>{e&&(this.$.cdnUrl=e)}))})}handleApply(t){let e=t.detail;this.entry.setMultipleValues({cdnUrl:e.cdnUrl,cdnUrlModifiers:e.cdnUrlModifiers}),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){let t=new vt;t.classList.add("lr-cldtr-common");let e=this.$.cdnUrl;t.setAttribute("cdn-url",e),t.addEventListener("apply",r=>this.handleApply(r)),t.addEventListener("cancel",()=>this.handleCancel()),this.innerHTML="",this.appendChild(t)}unmountEditor(){this.innerHTML=""}};var Ct={};window.addEventListener("message",s=>{let i;try{i=JSON.parse(s.data)}catch{return}if((i==null?void 0:i.type)in Ct){let t=Ct[i.type];for(let[e,r]of t)s.source===e&&r(i)}});var or=function(s,i,t){s in Ct||(Ct[s]=[]),Ct[s].push([i,t])},ar=function(s,i){s in Ct&&(Ct[s]=Ct[s].filter(t=>t[0]!==i))};var no=s=>Object.keys(s).reduce((t,e)=>{let r=s[e],n=Object.keys(r).reduce((o,a)=>{let l=r[a];return o+`${a}: ${l};`},"");return t+`${e}{${n}}`},"");function lr({textColor:s,backgroundColor:i,linkColor:t,linkColorHover:e,shadeColor:r}){let n=`solid 1px ${r}`;return no({body:{color:s,"background-color":i},".side-bar":{background:"inherit","border-right":n},".main-content":{background:"inherit"},".main-content-header":{background:"inherit"},".main-content-footer":{background:"inherit"},".list-table-row":{color:"inherit"},".list-table-row:hover":{background:r},".list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b":{"border-top":n},".list-table-body .list-items":{"border-bottom":n},".bread-crumbs a":{color:t},".bread-crumbs a:hover":{color:e},".main-content.loading":{background:`${i} url(/static/images/loading_spinner.gif) center no-repeat`,"background-size":"25px 25px"},".list-icons-item":{background:`center no-repeat ${r}`},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a":{color:t},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a:hover":{color:e},".side-bar-menu a":{color:t},".side-bar-menu a:hover":{color:e},".source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover":{color:e},".source-vk .side-bar-menu a":{color:t},".source-vk .side-bar-menu a:hover":{color:e,background:"none"}})}function cr(s){let i=[];for(let[t,e]of Object.entries(s))e==null||typeof e=="string"&&e.length===0||i.push(`${t}=${encodeURIComponent(e)}`);return i.join("&")}var oo=function(s){return s.replace(/[\\-\\[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},hr=function(s,i="i"){let t=s.split("*").map(oo);return new RegExp("^"+t.join(".+")+"$",i)};var Ue=class extends b{constructor(){super(...arguments);c(this,"activityType",g.activities.EXTERNAL);c(this,"init$",{...this.ctxInit,activityIcon:"",activityCaption:"",counter:0,onDone:()=>{this.$["*currentActivity"]=g.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()}});c(this,"_iframe",null);c(this,"_inheritedUpdateCssData",this.updateCssData);c(this,"updateCssData",()=>{this.isActivityActive&&(this._inheritedUpdateCssData(),this.applyStyles())})}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{let{externalSourceType:t}=this.activityParams;this.set$({activityCaption:`${t==null?void 0:t[0].toUpperCase()}${t==null?void 0:t.slice(1)}`,activityIcon:t}),this.$.counter=0,this.mountIframe()}}),this.sub("*currentActivity",t=>{t!==this.activityType&&this.unmountIframe()})}sendMessage(t){this._iframe.contentWindow.postMessage(JSON.stringify(t),"*")}async handleFileSelected(t){this.$.counter=this.$.counter+1;let e=(()=>{if(t.alternatives){let n=R(this.getCssData("--cfg-external-sources-preferred-types"));for(let o of n){let a=hr(o);for(let[l,h]of Object.entries(t.alternatives))if(a.test(l))return h}}return t.url})(),{filename:r}=t;this.uploadCollection.add({externalUrl:e,fileName:r!=null?r:null})}handleIframeLoad(){this.applyStyles()}getCssValue(t){return window.getComputedStyle(this).getPropertyValue(t).trim()}applyStyles(){let t={backgroundColor:this.getCssValue("--clr-background-light"),textColor:this.getCssValue("--clr-txt"),shadeColor:this.getCssValue("--clr-shade-lv1"),linkColor:"#157cfc",linkColorHover:"#3891ff"};this.sendMessage({type:"embed-css",style:lr(t)})}remoteUrl(){let t=this.getCssData("--cfg-pubkey"),e=(!1).toString(),{externalSourceType:r}=this.activityParams,n={lang:"en",widget_version:"3.11.3",public_key:t,images_only:e,pass_window_open:!1,session_key:this.getCssData("--cfg-remote-tab-session-key")};return`https://social.uploadcare.com/window3/${r}?${cr(n)}`}mountIframe(){let t=ne({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});t.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(t),or("file-selected",t.contentWindow,this.handleFileSelected.bind(this)),this._iframe=t}unmountIframe(){this._iframe&&ar("file-selected",this._iframe.contentWindow),this.ref.iframeWrapper.innerHTML="",this._iframe=void 0}};Ue.template=`<lr-activity-header><button type="button" class="mini-btn" set="onclick: *historyBack"><lr-icon name="back"></lr-icon></button><div><lr-icon set="@name: activityIcon"></lr-icon><span>{{activityCaption}}</span></div><button type="button" class="mini-btn close-btn" set="onclick: *historyBack"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="content"><div ref="iframeWrapper" class="iframe-wrapper"></div><div class="toolbar"><button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button><div></div><div class="selected-counter"><span l10n="selected-count"></span>{{counter}}</div><button type="button" class="done-btn primary-btn" set="onclick: onDone; @disabled: !counter"><lr-icon name="check"></lr-icon></button></div></div>`;var Qt=class extends f{setCurrentTab(i){if(!i)return;[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach(e=>{e.getAttribute("tab-ctx")===i?e.removeAttribute("hidden"):e.setAttribute("hidden","")});for(let e in this._tabMap)e===i?this._tabMap[e].setAttribute("current",""):this._tabMap[e].removeAttribute("current")}initCallback(){super.initCallback(),this._tabMap={},this.defineAccessor("tab-list",i=>{if(!i)return;R(i).forEach(e=>{let r=ne({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(e)}}});r.textContent=this.l10n(e),this.ref.row.appendChild(r),this._tabMap[e]=r})}),this.defineAccessor("default",i=>{this.setCurrentTab(i)}),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}};Qt.bindAttributes({"tab-list":null,default:null});Qt.template=`<div ref="row" class="tabs-row"></div><div ref="context" class="tabs-context"><slot></slot></div>`;var Lt=class extends b{constructor(){super(...arguments);c(this,"processInnerHtml",!0);c(this,"init$",{...this.ctxInit,output:null,filesData:null});c(this,"cssInit$",{"--cfg-group-output":0})}get dict(){return Lt.dict}get validationInput(){return this._validationInputElement}initCallback(){if(super.initCallback(),this.hasAttribute(this.dict.FORM_INPUT_ATTR)&&(this._dynamicInputsContainer=document.createElement("div"),this.appendChild(this._dynamicInputsContainer),this.hasAttribute(this.dict.INPUT_REQUIRED))){let t=document.createElement("input");t.type="text",t.name="__UPLOADCARE_VALIDATION_INPUT__",t.required=!0,this.appendChild(t),this._validationInputElement=t}this.sub("output",t=>{if(t){if(this.hasAttribute(this.dict.FIRE_EVENT_ATTR)&&this.dispatchEvent(new CustomEvent(this.dict.EVENT_NAME,{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),ctxName:this.ctxName,data:t}})),this.hasAttribute(this.dict.FORM_INPUT_ATTR)){this._dynamicInputsContainer.innerHTML="";let e=t.groupData?[t.groupData.cdnUrl]:t.map(r=>r.cdnUrl);for(let r of e){let n=document.createElement("input");n.type="hidden",n.name=this.getAttribute(this.dict.INPUT_NAME_ATTR)||this.ctxName,n.value=r,this._dynamicInputsContainer.appendChild(n)}this.hasAttribute(this.dict.INPUT_REQUIRED)&&(this._validationInputElement.value=e.length?"__VALUE__":"")}this.hasAttribute(this.dict.CONSOLE_ATTR)&&console.log(t)}},!1),this.sub(this.dict.SRC_CTX_KEY,async t=>{if(!t){this.$.output=null,this.$.filesData=null;return}if(this.$.filesData=t,this.getCssData("--cfg-group-output")||this.hasAttribute(this.dict.GROUP_ATTR)){let e=t.map(n=>n.uuid),r=await ys(e,{...this.getUploadClientOptions()});this.$.output={groupData:r,files:t}}else this.$.output=t},!1)}};Lt.dict={SRC_CTX_KEY:"*outputData",EVENT_NAME:"lr-data-output",FIRE_EVENT_ATTR:"use-event",CONSOLE_ATTR:"use-console",GROUP_ATTR:"use-group",FORM_INPUT_ATTR:"use-input",INPUT_NAME_ATTR:"input-name",INPUT_REQUIRED:"input-required"};var mi=class extends g{};var Le=class extends f{constructor(){super(...arguments);c(this,"init$",{...this.ctxInit,currentText:"",options:[],selectHtml:"",onSelect:t=>{var e;t.preventDefault(),t.stopPropagation(),this.value=this.ref.select.value,this.$.currentText=((e=this.$.options.find(r=>r.value==this.value))==null?void 0:e.text)||"",this.dispatchEvent(new Event("change"))}})}initCallback(){super.initCallback(),this.sub("options",t=>{var r;this.$.currentText=((r=t==null?void 0:t[0])==null?void 0:r.text)||"";let e="";t==null||t.forEach(n=>{e+=`<option value="${n.value}">${n.text}</option>`}),this.$.selectHtml=e})}};Le.template=`<button> {{currentText}} <lr-icon name="select"></lr-icon><select ref="select" set="innerHTML: selectHtml; onchange: onSelect"></select></button>`;var z={PLAY:"play",PAUSE:"pause",FS_ON:"fullscreen-on",FS_OFF:"fullscreen-off",VOL_ON:"unmute",VOL_OFF:"mute",CAP_ON:"captions",CAP_OFF:"captions-off"},ur={requestFullscreen:s=>{s.requestFullscreen?s.requestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen()},exitFullscreen:()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}},K=class extends f{constructor(){super(...arguments);c(this,"init$",{...this.ctxInit,src:"",ppIcon:z.PLAY,fsIcon:z.FS_ON,volIcon:z.VOL_ON,capIcon:z.CAP_OFF,totalTime:"00:00",currentTime:"00:00",progressCssWidth:"0",hasSubtitles:!1,volumeDisabled:!1,volumeValue:0,onPP:()=>{this.togglePlay()},onFs:()=>{this.toggleFullscreen()},onCap:()=>{this.toggleCaptions()},onMute:()=>{this.toggleSound()},onVolChange:t=>{let e=parseFloat(t.currentTarget.$.value);this.setVolume(e)},progressClicked:t=>{let e=this.progress.getBoundingClientRect();this._video.currentTime=this._video.duration*(t.offsetX/e.width)}})}togglePlay(){this._video.paused||this._video.ended?this._video.play():this._video.pause()}toggleFullscreen(){(document.fullscreenElement||document.webkitFullscreenElement)===this?ur.exitFullscreen():ur.requestFullscreen(this)}toggleCaptions(){this.$.capIcon===z.CAP_OFF?(this.$.capIcon=z.CAP_ON,this._video.textTracks[0].mode="showing",window.localStorage.setItem(K.is+":captions","1")):(this.$.capIcon=z.CAP_OFF,this._video.textTracks[0].mode="hidden",window.localStorage.removeItem(K.is+":captions"))}toggleSound(){this.$.volIcon===z.VOL_ON?(this.$.volIcon=z.VOL_OFF,this.$.volumeDisabled=!0,this._video.muted=!0):(this.$.volIcon=z.VOL_ON,this.$.volumeDisabled=!1,this._video.muted=!1)}setVolume(t){window.localStorage.setItem(K.is+":volume",t);let e=t?t/100:0;this._video.volume=e}get progress(){return this.ref.progress}_getUrl(t){return t.includes("/")?t:`https://ucarecdn.com/${t}/`}_desc2attrs(t){let e=[];for(let r in t){let n=r==="src"?this._getUrl(t[r]):t[r];e.push(`${r}="${n}"`)}return e.join(" ")}_timeFmt(t){let e=new Date(Math.round(t)*1e3);return[e.getMinutes(),e.getSeconds()].map(r=>r<10?"0"+r:r).join(":")}_initTracks(){[...this._video.textTracks].forEach(t=>{t.mode="hidden"}),window.localStorage.getItem(K.is+":captions")&&this.toggleCaptions()}_castAttributes(){let t=["autoplay","loop","muted"];[...this.attributes].forEach(e=>{t.includes(e.name)&&this._video.setAttribute(e.name,e.value)})}initCallback(){super.initCallback(),this._video=this.ref.video,this._castAttributes(),this._video.addEventListener("play",()=>{this.$.ppIcon=z.PAUSE,this.setAttribute("playback","")}),this._video.addEventListener("pause",()=>{this.$.ppIcon=z.PLAY,this.removeAttribute("playback")}),this.addEventListener("fullscreenchange",e=>{console.log(e),document.fullscreenElement===this?this.$.fsIcon=z.FS_OFF:this.$.fsIcon=z.FS_ON}),this.sub("src",e=>{if(!e)return;let r=this._getUrl(e);this._video.src=r}),this.sub("video",async e=>{if(!e)return;let r=await(await window.fetch(this._getUrl(e))).json();r.poster&&(this._video.poster=this._getUrl(r.poster));let n="";r==null||r.sources.forEach(o=>{n+=`<source ${this._desc2attrs(o)} />`}),r.tracks&&(r.tracks.forEach(o=>{n+=`<track ${this._desc2attrs(o)} />`}),this.$.hasSubtitles=!0),this._video.innerHTML+=n,this._initTracks(),console.log(r)}),this._video.addEventListener("loadedmetadata",e=>{this.$.currentTime=this._timeFmt(this._video.currentTime),this.$.totalTime=this._timeFmt(this._video.duration)}),this._video.addEventListener("timeupdate",e=>{let r=Math.round(100*(this._video.currentTime/this._video.duration));this.$.progressCssWidth=r+"%",this.$.currentTime=this._timeFmt(this._video.currentTime)});let t=window.localStorage.getItem(K.is+":volume");if(t){let e=parseFloat(t);this.setVolume(e),this.$.volumeValue=e}}};K.template=`<div class="video-wrapper"><video ref="video" preload="metadata" crossorigin="anonymous"></video></div><div class="toolbar"><div class="progress" ref="progress" set -onclick="progressClicked"><div class="bar" set -style.width="progressCssWidth"></div></div><div class="tb-block"><button set -onclick="onPP"><lr-icon set -@name="ppIcon"></lr-icon></button><div class="timer">{{currentTime}} / {{totalTime}}</div></div><div class="tb-block"><button set -onclick="onCap" -@hidden="!hasSubtitles"><lr-icon set -@name="capIcon"></lr-icon></button><button set -onclick="onMute"><lr-icon set -@name="volIcon"></lr-icon></button><lr-range type="range" set -onchange="onVolChange" -@disabled="volumeDisabled" -value="volumeValue"></lr-range><button set -onclick="onFs"><lr-icon set -@name="fsIcon"></lr-icon></button></div></div>`;K.bindAttributes({video:"video",src:"src"});var ao="css-src",te=class extends f{constructor(){super(...arguments);c(this,"pauseRender",!0)}shadowReadyCallback(){}initCallback(){super.initCallback(),this.setAttribute("hidden","");let t=this.getAttribute(ao);if(t){this.renderShadow=!0,this.attachShadow({mode:"open"});let e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t,e.onload=()=>{window.requestAnimationFrame(()=>{this.render(),window.setTimeout(()=>{this.removeAttribute("hidden"),this.shadowReadyCallback()})})},this.shadowRoot.prepend(e)}else this.render(),this.removeAttribute("hidden"),this.shadowReadyCallback()}};var Pe=class extends f{constructor(){super(...arguments);c(this,"cssInit$",{"--cfg-remove-copyright":0});c(this,"init$",{...this.ctxInit,removeCopyright:!1})}initCallback(){super.initCallback(),this.sub("--cfg-remove-copyright",t=>{this.$.removeCopyright=!!t})}};c(Pe,"template",`<a href="https://uploadcare.com/?utm_source=copyright&utm_medium=referral&utm_campaign=v4" target="_blank noopener" class="credits" set="@hidden: removeCopyright" >Powered by Uploadcare</a >`);var xt=class extends te{constructor(){super(...arguments);c(this,"ctxInit",He(this));c(this,"ctxOwner",!0);c(this,"_template",null)}static set template(t){this._template=t+"<slot></slot>"}static get template(){return this._template}};var De=class extends xt{};De.template=`<lr-simple-btn></lr-simple-btn><lr-modal strokes block-body-scrolling><lr-start-from><lr-drop-area with-icon clickable></lr-drop-area><lr-source-list wrap></lr-source-list><lr-copyright></lr-copyright></lr-start-from><lr-upload-list></lr-upload-list><lr-camera-source></lr-camera-source><lr-url-source></lr-url-source><lr-external-source></lr-external-source><lr-cloud-image-editor></lr-cloud-image-editor></lr-modal><lr-message-box></lr-message-box><lr-progress-bar-common></lr-progress-bar-common>`;var Ne=class extends xt{constructor(){super(...arguments);c(this,"pauseRender",!0);c(this,"init$",{...this.ctxInit,selectClicked:()=>{this.ref.uBlock.openSystemDialog()}})}shadowReadyCallback(){let t=this.ref.uBlock;this.sub("*currentActivity",e=>{e||(this.$["*currentActivity"]=t.initActivity||g.activities.START_FROM)}),this.sub("*uploadList",e=>{(e==null?void 0:e.length)===0&&(this.$["*currentActivity"]=t.initActivity||g.activities.START_FROM)})}};Ne.template=`<lr-start-from><lr-drop-area clickable l10n="choose-file"></lr-drop-area><lr-copyright></lr-copyright></lr-start-from><lr-upload-list ref="uBlock"></lr-upload-list><lr-message-box></lr-message-box>`;var Me=class extends xt{constructor(){super(...arguments);c(this,"init$",this.ctxInit)}shadowReadyCallback(){let t=this.ref.uBlock;this.sub("*currentActivity",e=>{e||(this.$["*currentActivity"]=t.initActivity||g.activities.START_FROM)})}};Me.template=`<lr-start-from><lr-drop-area with-icon clickable></lr-drop-area><lr-source-list wrap></lr-source-list><lr-copyright></lr-copyright></lr-start-from><lr-upload-list ref="uBlock"></lr-upload-list><lr-camera-source></lr-camera-source><lr-url-source></lr-url-source><lr-external-source></lr-external-source><lr-message-box></lr-message-box><lr-progress-bar></lr-progress-bar><lr-cloud-image-editor></lr-cloud-image-editor>`;function ee(s){for(let i in s){let t=[...i].reduce((e,r)=>(r.toUpperCase()===r&&(r="-"+r.toLowerCase()),e+=r),"");t.startsWith("-")&&(t=t.replace("-","")),t.startsWith("lr-")||(t="lr-"+t),s[i].reg&&s[i].reg(t)}}var Be="__lr-blocks__";async function dr(s,i=!1){return new Promise((t,e)=>{if(typeof document!="object"){t(null);return}if(typeof window=="object"&&window[Be]){t(window[Be]);return}let r=document.createElement("script");r.type="module",r.src=s,r.onerror=()=>{e()},r.onload=()=>{let n=window[Be];i&&ee(n),t(n)},document.head.appendChild(r)})}ee(fi);window[Be]=fi;