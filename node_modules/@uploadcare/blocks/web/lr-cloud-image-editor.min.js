/**
 * @license
 * MIT License
 * 
 * Copyright (c) 2022 Uploadcare (hello@uploadcare.com). All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
var gt=Object.defineProperty;var bt=(r,i,e)=>i in r?gt(r,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[i]=e;var f=(r,i,e)=>(bt(r,typeof i!="symbol"?i+"":i,e),e);var vt=Object.defineProperty,wt=(r,i,e)=>i in r?vt(r,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[i]=e,we=(r,i,e)=>(wt(r,typeof i!="symbol"?i+"":i,e),e);function xt(r){let i=e=>{var t;for(let s in e)((t=e[s])==null?void 0:t.constructor)===Object&&(e[s]=i(e[s]));return{...e}};return i(r)}var g=class{constructor(r){r.constructor===Object?this.store=xt(r):(this._storeIsProxy=!0,this.store=r),this.callbackMap=Object.create(null)}static warn(r,i){console.warn(`Symbiote Data: cannot ${r}. Prop name: `+i)}read(r){return!this._storeIsProxy&&!this.store.hasOwnProperty(r)?(g.warn("read",r),null):this.store[r]}has(r){return this._storeIsProxy?this.store[r]!==void 0:this.store.hasOwnProperty(r)}add(r,i,e=!1){!e&&Object.keys(this.store).includes(r)||(this.store[r]=i,this.notify(r))}pub(r,i){if(!this._storeIsProxy&&!this.store.hasOwnProperty(r)){g.warn("publish",r);return}this.store[r]=i,this.notify(r)}multiPub(r){for(let i in r)this.pub(i,r[i])}notify(r){this.callbackMap[r]&&this.callbackMap[r].forEach(i=>{i(this.store[r])})}sub(r,i,e=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(r)?(g.warn("subscribe",r),null):(this.callbackMap[r]||(this.callbackMap[r]=new Set),this.callbackMap[r].add(i),e&&i(this.store[r]),{remove:()=>{this.callbackMap[r].delete(i),this.callbackMap[r].size||delete this.callbackMap[r]},callback:i})}static registerCtx(r,i=Symbol()){let e=g.globalStore.get(i);return e?console.warn('State: context UID "'+i+'" already in use'):(e=new g(r),g.globalStore.set(i,e)),e}static deleteCtx(r){g.globalStore.delete(r)}static getCtx(r,i=!0){return g.globalStore.get(r)||(i&&console.warn('State: wrong context UID - "'+r+'"'),null)}};g.globalStore=new Map;var p=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),ke="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",yt=ke.length-1,Tt=class{static generate(r="XXXXXXXXX-XXX"){let i="";for(let e=0;e<r.length;e++)i+=r[e]==="-"?r[e]:ke.charAt(Math.random()*yt);return i}};function Le(r,i,e){let t=!0,s,o=i.split(".");return o.forEach((n,l)=>{l<o.length-1?r=r[n]:s=n}),r?r[s]=e:t=!1,t}function Ct(r){return r.split("-").map((i,e)=>i&&e?i[0].toUpperCase()+i.slice(1):i).join("").split("_").map((i,e)=>i&&e?i.toUpperCase():i).join("")}function Et(r,i){[...r.querySelectorAll(`[${p.REPEAT_ATTR}]`)].forEach(e=>{let t=e.getAttribute(p.REPEAT_ITEM_TAG_ATTR),s;if(t&&(s=window.customElements.get(t)),!s){s=class extends i.BaseComponent{constructor(){super(),t||(this.style.display="contents")}};let n=e.innerHTML;s.template=n,s.reg(t)}for(;e.firstChild;)e.firstChild.remove();let o=e.getAttribute(p.REPEAT_ATTR);i.sub(o,n=>{if(!n){for(;e.firstChild;)e.firstChild.remove();return}let l=[...e.children],a,c=h=>{h.forEach((u,_)=>{if(l[_])if(l[_].set$)setTimeout(()=>{l[_].set$(u)});else for(let b in u)l[_][b]=u[b];else{a||(a=new DocumentFragment);let b=new s;Object.assign(b.init$,u),a.appendChild(b)}}),a&&e.appendChild(a);let d=l.slice(h.length,l.length);for(let u of d)u.remove()};if(n.constructor===Array)c(n);else if(n.constructor===Object){let h=[];for(let d in n){let u=n[d];Object.defineProperty(u,"_KEY_",{value:d,enumerable:!0}),h.push(u)}c(h)}else console.warn("Symbiote repeat data type error:"),console.log(n)}),e.removeAttribute(p.REPEAT_ATTR),e.removeAttribute(p.REPEAT_ITEM_TAG_ATTR)})}var Oe="__default__";function $t(r,i){if(i.shadowRoot)return;let e=[...r.querySelectorAll("slot")];if(!e.length)return;let t={};e.forEach(s=>{let o=s.getAttribute("name")||Oe;t[o]={slot:s,fr:document.createDocumentFragment()}}),i.initChildren.forEach(s=>{var o;let n=Oe;s instanceof Element&&s.hasAttribute("slot")&&(n=s.getAttribute("slot"),s.removeAttribute("slot")),(o=t[n])==null||o.fr.appendChild(s)}),Object.values(t).forEach(s=>{if(s.fr.childNodes.length)s.slot.parentNode.replaceChild(s.fr,s.slot);else if(s.slot.childNodes.length){let o=document.createDocumentFragment();o.append(...s.slot.childNodes),s.slot.parentNode.replaceChild(o,s.slot)}else s.slot.remove()})}function St(r,i){[...r.querySelectorAll(`[${p.EL_REF_ATTR}]`)].forEach(e=>{let t=e.getAttribute(p.EL_REF_ATTR);i.ref[t]=e,e.removeAttribute(p.EL_REF_ATTR)})}function At(r,i){[...r.querySelectorAll(`[${p.BIND_ATTR}]`)].forEach(e=>{let s=e.getAttribute(p.BIND_ATTR).split(";");[...e.attributes].forEach(o=>{if(o.name.startsWith("-")&&o.value){let n=Ct(o.name.replace("-",""));s.push(n+":"+o.value),e.removeAttribute(o.name)}}),s.forEach(o=>{if(!o)return;let n=o.split(":").map(h=>h.trim()),l=n[0],a;l.indexOf(p.ATTR_BIND_PRFX)===0&&(a=!0,l=l.replace(p.ATTR_BIND_PRFX,""));let c=n[1].split(",").map(h=>h.trim());for(let h of c){let d;h.startsWith("!!")?(d="double",h=h.replace("!!","")):h.startsWith("!")&&(d="single",h=h.replace("!","")),i.sub(h,u=>{d==="double"?u=!!u:d==="single"&&(u=!u),a?(u==null?void 0:u.constructor)===Boolean?u?e.setAttribute(l,""):e.removeAttribute(l):e.setAttribute(l,u):Le(e,l,u)||(e[p.SET_LATER_KEY]||(e[p.SET_LATER_KEY]=Object.create(null)),e[p.SET_LATER_KEY][l]=u)})}}),e.removeAttribute(p.BIND_ATTR)})}var ee="{{",V="}}",Rt="skip-text";function It(r){let i,e=[],t=document.createTreeWalker(r,NodeFilter.SHOW_TEXT,{acceptNode:s=>{var o;return!((o=s.parentElement)!=null&&o.hasAttribute(Rt))&&s.textContent.includes(ee)&&s.textContent.includes(V)&&1}});for(;i=t.nextNode();)e.push(i);return e}var Ot=function(r,i){It(r).forEach(t=>{let s=[],o;for(;t.textContent.includes(V);)t.textContent.startsWith(ee)?(o=t.textContent.indexOf(V)+V.length,t.splitText(o),s.push(t)):(o=t.textContent.indexOf(ee),t.splitText(o)),t=t.nextSibling;s.forEach(n=>{let l=n.textContent.replace(ee,"").replace(V,"");n.textContent="",i.sub(l,a=>{n.textContent=a})})})},Pt=[Et,$t,St,At,Ot],te="'",H='"',kt=/\\([0-9a-fA-F]{1,6} ?)/g;function Lt(r){return(r[0]===H||r[0]===te)&&(r[r.length-1]===H||r[r.length-1]===te)}function Nt(r){return(r[0]===H||r[0]===te)&&(r=r.slice(1)),(r[r.length-1]===H||r[r.length-1]===te)&&(r=r.slice(0,-1)),r}function Dt(r){let i="",e="";for(var t=0;t<r.length;t++){let s=r[t+1];r[t]==="\\"&&s==='"'?(i+='\\"',t++):r[t]==='"'&&e!=="\\"?i+='\\"':i+=r[t],e=r[t]}return i}function Mt(r){let i=r;Lt(r)&&(i=Nt(i),i=i.replace(kt,(e,t)=>String.fromCodePoint(parseInt(t.trim(),16))),i=i.replaceAll(`\\
`,"\\n"),i=Dt(i),i=H+i+H);try{return JSON.parse(i)}catch{throw new Error(`Failed to parse CSS property value: ${i}. Original input: ${r}`)}}var Pe=0,z=null,O=null,N=class extends HTMLElement{constructor(){super(),we(this,"updateCssData",()=>{var r;this.dropCssDataCache(),(r=this.__boundCssProps)==null||r.forEach(i=>{let e=this.getCssData(this.__extractCssName(i),!0);e!==null&&this.$[i]!==e&&(this.$[i]=e)})}),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return N}initCallback(){}__initCallback(){var r;this.__initialized||(this.__initialized=!0,(r=this.initCallback)==null||r.call(this))}render(r,i=this.renderShadow){let e;if((i||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.allowCustomTemplate){let s=this.getAttribute(p.USE_TPL);if(s){let o=this.getRootNode(),n=(o==null?void 0:o.querySelector(s))||document.querySelector(s);n?r=n.content.cloneNode(!0):console.warn(`Symbiote template "${s}" is not found...`)}}if(this.processInnerHtml)for(let s of this.tplProcessors)s(this,this);if(r||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(r==null?void 0:r.constructor)===DocumentFragment)e=r;else if((r==null?void 0:r.constructor)===String){let s=document.createElement("template");s.innerHTML=r,e=s.content.cloneNode(!0)}else this.constructor.__tpl&&(e=this.constructor.__tpl.content.cloneNode(!0));for(let s of this.tplProcessors)s(e,this)}let t=()=>{e&&(i&&this.shadowRoot.appendChild(e)||this.appendChild(e)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){i=!0;let s=document.createElement("link");s.rel="stylesheet",s.href=this.constructor.__shadowStylesUrl,s.onload=t,this.shadowRoot.prepend(s)}else t()}addTemplateProcessor(r){this.tplProcessors.add(r)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=Tt.generate(),this.style.setProperty(p.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(p.CSS_CTX_PROP,!0)}get ctxName(){var r;let i=((r=this.getAttribute(p.CTX_NAME_ATTR))==null?void 0:r.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=i,i}get localCtx(){return this.__localCtx||(this.__localCtx=g.registerCtx({},this)),this.__localCtx}get nodeCtx(){return g.getCtx(this.ctxName,!1)||g.registerCtx({},this.ctxName)}static __parseProp(r,i){let e,t;if(r.startsWith(p.EXT_DATA_CTX_PRFX))e=i.nodeCtx,t=r.replace(p.EXT_DATA_CTX_PRFX,"");else if(r.includes(p.NAMED_DATA_CTX_SPLTR)){let s=r.split(p.NAMED_DATA_CTX_SPLTR);e=g.getCtx(s[0]),t=s[1]}else e=i.localCtx,t=r;return{ctx:e,name:t}}sub(r,i,e=!0){let t=o=>{this.isConnected&&i(o)},s=N.__parseProp(r,this);s.ctx.has(s.name)?this.allSubs.add(s.ctx.sub(s.name,t,e)):window.setTimeout(()=>{this.allSubs.add(s.ctx.sub(s.name,t,e))})}notify(r){let i=N.__parseProp(r,this);i.ctx.notify(i.name)}has(r){let i=N.__parseProp(r,this);return i.ctx.has(i.name)}add(r,i,e=!1){let t=N.__parseProp(r,this);t.ctx.add(t.name,i,e)}add$(r,i=!1){for(let e in r)this.add(e,r[e],i)}get $(){if(!this.__stateProxy){let r=Object.create(null);this.__stateProxy=new Proxy(r,{set:(i,e,t)=>{let s=N.__parseProp(e,this);return s.ctx.pub(s.name,t),!0},get:(i,e)=>{let t=N.__parseProp(e,this);return t.ctx.read(t.name)}})}return this.__stateProxy}set$(r,i=!1){for(let e in r){let t=r[e];i||![String,Number,Boolean].includes(t==null?void 0:t.constructor)?this.$[e]=t:this.$[e]!==t&&(this.$[e]=t)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(p.CTX_OWNER_ATTR)&&this.getAttribute(p.CTX_OWNER_ATTR)!=="false"}__initDataCtx(){let r=this.constructor.__attrDesc;if(r)for(let i of Object.values(r))Object.keys(this.init$).includes(i)||(this.init$[i]="");for(let i in this.init$)if(i.startsWith(p.EXT_DATA_CTX_PRFX))this.nodeCtx.add(i.replace(p.EXT_DATA_CTX_PRFX,""),this.init$[i],this.__ctxOwner);else if(i.includes(p.NAMED_DATA_CTX_SPLTR)){let e=i.split(p.NAMED_DATA_CTX_SPLTR),t=e[0].trim(),s=e[1].trim();if(t&&s){let o=g.getCtx(t,!1);o||(o=g.registerCtx({},t)),o.add(s,this.init$[i])}}else this.localCtx.add(i,this.init$[i]);for(let i in this.cssInit$)this.bindCssData(i,this.cssInit$[i]);this.__dataCtxInitialized=!0}connectedCallback(){var r;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let i=(r=this.getAttribute(p.CTX_NAME_ATTR))==null?void 0:r.trim();if(i&&this.style.setProperty(p.CSS_CTX_PROP,`'${i}'`),this.__initDataCtx(),this[p.SET_LATER_KEY]){for(let e in this[p.SET_LATER_KEY])Le(this,e,this[p.SET_LATER_KEY][e]);delete this[p.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let e of Pt)this.addTemplateProcessor(e);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let e=this.getRootNode();if(!e)return;if(e==null?void 0:e.querySelector(`link[${p.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`)){this.render();return}let s=this.constructor.__rootStylesLink.cloneNode(!0);s.setAttribute(p.ROOT_STYLE_ATTR_NAME,this.constructor.is),s.onload=()=>{this.render()},e.nodeType===Node.DOCUMENT_NODE?e.head.appendChild(s):e.prepend(s)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let r of this.allSubs)r.remove(),this.allSubs.delete(r);for(let r of this.tplProcessors)this.tplProcessors.delete(r);O==null||O.delete(this.updateCssData),O!=null&&O.size||(z==null||z.disconnect(),z=null,O=null)},100)))}static reg(r,i=!1){if(r||(Pe++,r=`${p.AUTO_TAG_PRFX}-${Pe}`),this.__tag=r,window.customElements.get(r)){console.warn(`${r} - is already in "customElements" registry`);return}window.customElements.define(r,i?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(r){this.observedAttributes=Object.keys(r),this.__attrDesc=r}attributeChangedCallback(r,i,e){var t;if(i===e)return;let s=(t=this.constructor.__attrDesc)==null?void 0:t[r];s?this.__dataCtxInitialized?this.$[s]=e:this.init$[s]=e:this[r]=e}getCssData(r,i=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(r)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let e=this.__computedStyle.getPropertyValue(r).trim();try{this.__cssDataCache[r]=Mt(e)}catch{!i&&console.warn(`CSS Data error: ${r}`),this.__cssDataCache[r]=null}}return this.__cssDataCache[r]}__extractCssName(r){return r.split("--").map((i,e)=>e===0?"":i).join("--")}__initStyleAttrObserver(){O||(O=new Set),O.add(this.updateCssData),z||(z=new MutationObserver(r=>{r[0].type==="attributes"&&O.forEach(i=>{i()})}),z.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}))}bindCssData(r,i=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(r);let e=this.getCssData(this.__extractCssName(r),!0);e===null&&(e=i),this.add(r,e),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(r,i,e){let t="__"+r;this[t]=this[r],Object.defineProperty(this,r,{set:s=>{this[t]=s,e?window.setTimeout(()=>{i==null||i(s)}):i==null||i(s)},get:()=>this[t]}),this[r]=this[t]}static set shadowStyles(r){let i=new Blob([r],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(i)}static set rootStyles(r){if(!this.__rootStylesLink){let i=new Blob([r],{type:"text/css"}),e=URL.createObjectURL(i),t=document.createElement("link");t.href=e,t.rel="stylesheet",this.__rootStylesLink=t}}},xe=N;we(xe,"template");var ve=class{static _print(r){console.warn(r)}static setDefaultTitle(r){this.defaultTitle=r}static setRoutingMap(r){Object.assign(this.appMap,r);for(let i in this.appMap)!this.defaultRoute&&this.appMap[i].default===!0?this.defaultRoute=i:!this.errorRoute&&this.appMap[i].error===!0&&(this.errorRoute=i)}static set routingEventName(r){this.__routingEventName=r}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let r={route:null,options:{}};return window.location.search.split(this.separator).forEach(e=>{if(e.includes("?"))r.route=e.replace("?","");else if(e.includes("=")){let t=e.split("=");r.options[t[0]]=decodeURI(t[1])}else r.options[e]=!0}),r}static notify(){let r=this.readAddressBar(),i=this.appMap[r.route];if(i&&i.title&&(document.title=i.title),r.route===null&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!i&&this.errorRoute){this.applyRoute(this.errorRoute);return}else if(!i&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!i){this._print(`Route "${r.route}" not found...`);return}let e=new CustomEvent(ve.routingEventName,{detail:{route:r.route,options:Object.assign(i||{},r.options)}});window.dispatchEvent(e)}static reflect(r,i={}){let e=this.appMap[r];if(!e){this._print("Wrong route: "+r);return}let t="?"+r;for(let o in i)i[o]===!0?t+=this.separator+o:t+=this.separator+o+`=${i[o]}`;let s=e.title||this.defaultTitle||"";window.history.pushState(null,s,t),document.title=s}static applyRoute(r,i={}){this.reflect(r,i),this.notify()}static setSeparator(r){this._separator=r}static get separator(){return this._separator||"&"}static createRouterData(r,i){this.setRoutingMap(i);let e=g.registerCtx({route:null,options:null,title:null},r);return window.addEventListener(this.routingEventName,t=>{var s;e.multiPub({route:t.detail.route,options:t.detail.options,title:((s=t.detail.options)==null?void 0:s.title)||this.defaultTitle||""})}),ve.notify(),this.initPopstateListener(),e}static initPopstateListener(){this.__onPopstate||(this.__onPopstate=()=>{this.notify()},window.addEventListener("popstate",this.__onPopstate))}static removePopstateListener(){window.removeEventListener("popstate",this.__onPopstate),this.__onPopstate=null}};ve.appMap=Object.create(null);var Ne="idb-store-ready",Bt="symbiote-db",Ut="symbiote-idb-update_",Ft=class{_notifyWhenReady(r=null){window.dispatchEvent(new CustomEvent(Ne,{detail:{dbName:this.name,storeName:this.storeName,event:r}}))}get _updEventName(){return Ut+this.name}_getUpdateEvent(r){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:r}})}_notifySubscribers(r){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,r),window.dispatchEvent(this._getUpdateEvent(r))}constructor(r,i){this.name=r,this.storeName=i,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=e=>{this.db=e.target.result,this.objStore=this.db.createObjectStore(i,{keyPath:"_key"}),this.objStore.transaction.oncomplete=t=>{this._notifyWhenReady(t)}},this.request.onsuccess=e=>{this.db=e.target.result,this._notifyWhenReady(e)},this.request.onerror=e=>{console.error(e)},this._subscriptionsMap={},this._updateHandler=e=>{e.key===this.name&&this._subscriptionsMap[e.newValue]&&this._subscriptionsMap[e.newValue].forEach(async s=>{s(await this.read(e.newValue))})},this._localUpdateHandler=e=>{this._updateHandler(e.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(r){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(r);return new Promise((t,s)=>{e.onsuccess=o=>{var n;(n=o.target.result)!=null&&n._value?t(o.target.result._value):(t(null),console.warn(`IDB: cannot read "${r}"`))},e.onerror=o=>{s(o)}})}write(r,i,e=!1){let t={_key:r,_value:i},o=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(t);return new Promise((n,l)=>{o.onsuccess=a=>{e||this._notifySubscribers(r),n(a.target.result)},o.onerror=a=>{l(a)}})}delete(r,i=!1){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(r);return new Promise((s,o)=>{t.onsuccess=n=>{i||this._notifySubscribers(r),s(n)},t.onerror=n=>{o(n)}})}getAll(){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((e,t)=>{i.onsuccess=s=>{let o=s.target.result;e(o.map(n=>n._value))},i.onerror=s=>{t(s)}})}subscribe(r,i){this._subscriptionsMap[r]||(this._subscriptionsMap[r]=new Set);let e=this._subscriptionsMap[r];return e.add(i),{remove:()=>{e.delete(i),e.size||delete this._subscriptionsMap[r]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,De.clear(this.name)}},De=class{static get readyEventName(){return Ne}static open(r=Bt,i="store"){let e=r+"/"+i;return this._reg[e]||(this._reg[e]=new Ft(r,i)),this._reg[e]}static clear(r){window.indexedDB.deleteDatabase(r);for(let i in this._reg)i.split("/")[0]===r&&delete this._reg[i]}};we(De,"_reg",Object.create(null));var zt=r=>r,ye="{{",Be="}}",Me="plural:";function Te(r,i,e={}){var n;let{openToken:t=ye,closeToken:s=Be,transform:o=zt}=e;for(let l in i){let a=(n=i[l])==null?void 0:n.toString();r=r.replaceAll(t+l+s,typeof a=="string"?o(a):a)}return r}function Ue(r){let i=[],e=r.indexOf(ye);for(;e!==-1;){let t=r.indexOf(Be,e),s=r.substring(e+2,t);if(s.startsWith(Me)){let o=r.substring(e+2,t).replace(Me,""),n=o.substring(0,o.indexOf("(")),l=o.substring(o.indexOf("(")+1,o.indexOf(")"));i.push({variable:s,pluralKey:n,countVariable:l})}e=r.indexOf(ye,t)}return i}function Fe(r,i){[...r.querySelectorAll("[l10n]")].forEach(e=>{let t=e.getAttribute("l10n"),s="textContent";if(t.includes(":")){let n=t.split(":");s=n[0],t=n[1]}let o="l10n:"+t;i.__l10nKeys.push(o),i.add(o,t),i.sub(o,n=>{e[s]=i.l10n(n)}),e.removeAttribute("l10n")})}var ze=()=>({"*blocksRegistry":new Set});function He(r,i){let e,t=(...s)=>{clearTimeout(e),e=setTimeout(()=>r(...s),i)};return t.cancel=()=>{clearTimeout(e)},t}var Ht="--uploadcare-blocks-window-height",ie="__UPLOADCARE_BLOCKS_WINDOW_HEIGHT_TRACKER_ENABLED__";function Ce(){return typeof window[ie]=="undefined"?!1:!!window[ie]}function Xe(){if(Ce())return;let r=()=>{document.documentElement.style.setProperty(Ht,`${window.innerHeight}px`),window[ie]=!0},i=He(r,100);return window.addEventListener("resize",i,{passive:!0}),r(),()=>{window[ie]=!1,window.removeEventListener("resize",i)}}var We="lr-",m=class extends xe{constructor(){super();f(this,"allowCustomTemplate",!0);f(this,"ctxInit",ze());f(this,"init$",this.ctxInit);f(this,"updateCtxCssData",()=>{let e=this.$["*blocksRegistry"];for(let t of e)t.isConnected&&t.updateCssData()});this.activityType=null,this.addTemplateProcessor(Fe),this.__l10nKeys=[]}l10n(e,t={}){if(!e)return"";let s=this.getCssData("--l10n-"+e,!0)||e,o=Ue(s);for(let l of o)t[l.variable]=this.pluralize(l.pluralKey,Number(t[l.countVariable]));return Te(s,t)}pluralize(e,t){let s=this.l10n("locale-name")||"en-US",o=new Intl.PluralRules(s).select(t);return this.l10n(`${e}__${o}`)}applyL10nKey(e,t){let s="l10n:"+e;this.$[s]=t,this.__l10nKeys.push(e)}findBlockInCtx(e){let t=this.$["*blocksRegistry"];for(let s of t)if(e(s))return!0;return!1}setForCtxTarget(e,t,s){this.findBlockInCtx(o=>o.constructor.StateConsumerScope===e)&&(this.$[t]=s)}setActivity(e){if(this.findBlockInCtx(t=>t.activityType===e)){this.$["*currentActivity"]=e;return}console.warn(`Activity type "${e}" not found in the context`)}connectedCallback(){if(Ce()||(this._destroyInnerHeightTracker=Xe()),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.isConnected&&this.__ctxOwner){let e=g.getCtx(this.ctxName,!1);e&&(e.store={...this.ctxInit})}super.connectedCallback()}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._destroyInnerHeightTracker)==null||e.call(this)}initCallback(){this.$["*blocksRegistry"].add(this)}destroyCallback(){this.$["*blocksRegistry"].delete(this)}fileSizeFmt(e,t=2){let s=["B","KB","MB","GB","TB"],o=c=>this.getCssData("--l10n-unit-"+c.toLowerCase(),!0)||c;if(e===0)return`0 ${o(s[0])}`;let n=1024,l=t<0?0:t,a=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/n**a).toFixed(l))+" "+o(s[a])}proxyUrl(e){let t=this.getCssData("--cfg-secure-delivery-proxy",!0);return t?Te(t,{previewUrl:e},{transform:s=>window.encodeURIComponent(s)}):e}static reg(e){if(!e){super.reg();return}super.reg(e.startsWith(We)?e:We+e)}};f(m,"StateConsumerScope",null);var je=r=>{if(typeof r!="string"||!r)return"";let i=r.trim();return i.startsWith("-/")?i=i.slice(2):i.startsWith("/")&&(i=i.slice(1)),i.endsWith("/")&&(i=i.slice(0,i.length-1)),i},re=(...r)=>r.filter(i=>typeof i=="string"&&i).map(i=>je(i)).join("/-/"),E=(...r)=>{let i=re(...r);return i?`-/${i}/`:""};function Ve(r){let i=new URL(r),e=i.pathname+i.search+i.hash,t=e.lastIndexOf("http"),s=e.lastIndexOf("/"),o="";return t>=0?o=e.slice(t):s>=0&&(o=e.slice(s+1)),o}function Ke(r){let i=new URL(r),{pathname:e}=i,t=e.indexOf("/"),s=e.indexOf("/",t+1);return e.substring(t+1,s)}function Ge(r){let i=Ye(r),e=new URL(i),t=e.pathname.indexOf("/-/");return t===-1?[]:e.pathname.substring(t).split("/-/").filter(Boolean).map(o=>je(o))}function Ye(r){let i=new URL(r),e=Ve(r),t=qe(e)?Ze(e).pathname:e;return i.pathname=i.pathname.replace(t,""),i.search="",i.hash="",i.toString()}function qe(r){return r.startsWith("http")}function Ze(r){let i=new URL(r);return{pathname:i.origin+i.pathname||"",search:i.search||"",hash:i.hash||""}}var P=(r,i,e)=>{let t=new URL(Ye(r));if(e=e||Ve(r),t.pathname.startsWith("//")&&(t.pathname=t.pathname.replace("//","/")),qe(e)){let s=Ze(e);t.pathname=t.pathname+(i||"")+(s.pathname||""),t.search=s.search,t.hash=s.hash}else t.pathname=t.pathname+(i||"")+(e||"");return t.toString()},Ee=(r,i)=>{let e=new URL(r);return e.pathname=i+"/",e.toString()};var S="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";function Qe(...r){return r.reduce((i,e)=>{if(typeof e=="string")return i[e]=!0,i;for(let t of Object.keys(e))i[t]=e[t];return i},{})}function v(...r){let i=Qe(...r);return Object.keys(i).reduce((e,t)=>(i[t]&&e.push(t),e),[]).join(" ")}function Je(r,...i){let e=Qe(...i);for(let t of Object.keys(e))r.classList.toggle(t,e[t])}function A(r,i){let e,t=(...s)=>{clearTimeout(e),e=setTimeout(()=>r(...s),i)};return t.cancel=()=>{clearTimeout(e)},t}var $e=(r,i=",")=>r.trim().split(i).map(e=>e.trim()).filter(e=>e.length>0);var y={brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0};function Xt(r,i){if(typeof i=="number")return y[r]!==i?`${r}/${i}`:"";if(typeof i=="boolean")return i&&y[r]!==i?`${r}`:"";if(r==="filter"){if(!i||y[r]===i.amount)return"";let{name:e,amount:t}=i;return`${r}/${e}/${t}`}if(r==="crop"){if(!i)return"";let{dimensions:e,coords:t}=i;return`${r}/${e.join("x")}/${t.join(",")}`}return""}var tt=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function D(r){return re(...tt.filter(i=>typeof r[i]!="undefined"&&r[i]!==null).map(i=>{let e=r[i];return Xt(i,e)}).filter(i=>!!i))}var se=re("format/auto","progressive/yes"),k=([r])=>typeof r!="undefined"?Number(r):void 0,et=()=>!0,Wt=([r,i])=>({name:r,amount:typeof i!="undefined"?Number(i):100}),jt=([r,i])=>({dimensions:$e(r,"x").map(Number),coords:$e(i).map(Number)}),Vt={enhance:k,brightness:k,exposure:k,gamma:k,contrast:k,saturation:k,vibrance:k,warmth:k,filter:Wt,mirror:et,flip:et,rotate:k,crop:jt};function it(r){let i={};for(let e of r){let[t,...s]=e.split("/");if(!tt.includes(t))continue;let o=Vt[t],n=o(s);i[t]=n}return i}function rt(r){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:S,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let i=r.querySelectorAll("img");for(let e of i){let t=e.src;e.src=S,e.src=t}r.$["*networkProblems"]=!1},"*on.apply":i=>{if(!i)return;let e=r.$["*originalUrl"],t=E(D(i)),s=P(e,E(t,"preview")),o={originalUrl:e,cdnUrlModifiers:t,cdnUrl:s,transformations:i};r.dispatchEvent(new CustomEvent("apply",{detail:o,bubbles:!0,composed:!0})),r.remove()},"*on.cancel":()=>{r.remove(),r.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}var st=`<div class="wrapper wrapper_desktop"><lr-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;"><div class="network_problems_content"><div class="network_problems_icon"><lr-icon size="20" name="sad"></lr-icon></div><div class="network_problems_text">Network error</div></div><div class="network_problems_footer"><lr-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></lr-btn-ui></div></lr-presence-toggle><div class="viewport"><div class="file_type_outer"><div class="file_type">{{fileType}}</div></div><div class="image_container" ref="img-container-el"><img src="${S}" class="image image_visible_from_editor" ref="img-el" /><lr-editor-image-cropper ref="cropper-el"></lr-editor-image-cropper><lr-editor-image-fader ref="fader-el"></lr-editor-image-fader></div><div class="info_pan">{{msg}}</div></div><div class="toolbar"><lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="toolbar_content toolbar_content__editor"><lr-editor-toolbar></lr-editor-toolbar></div></div></div>`;var w={CROP:"crop",SLIDERS:"sliders",FILTERS:"filters"},oe=[w.CROP,w.SLIDERS,w.FILTERS],ot=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],nt=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],lt=["rotate","mirror","flip"],R={brightness:{zero:y.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:y.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:y.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:y.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:y.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:y.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:y.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:y.enhance,range:[0,100],keypointsNumber:1},filter:{zero:y.filter,range:[0,100],keypointsNumber:1}};var K=class extends m{constructor(){super(...arguments);f(this,"pauseRender",!0);f(this,"init$",{...this.ctxInit,...rt(this)});f(this,"_debouncedShowLoader",A(this._showLoader.bind(this),300));f(this,"cssInit$",{"--cfg-cdn-cname":"https://ucarecdn.com"})}get ctxName(){return this.autoCtxName}_showLoader(e){this.$.showLoader=e}_waitForSize(){return new Promise((t,s)=>{let o=setTimeout(()=>{s(new Error("[cloud-image-editor] timout waiting for non-zero container size"))},3e3),n=new ResizeObserver(([l])=>{l.contentRect.width>0&&l.contentRect.height>0&&(t(),clearTimeout(o),n.disconnect())});n.observe(this)})}async connectedCallback(){super.connectedCallback();try{await this._waitForSize()}catch(e){this.isConnected&&console.error(e.message);return}this.render(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.ref["img-el"].addEventListener("load",e=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==S&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",e=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",e=>{let t=this.ref["img-el"];t.src!==e&&(this._imgLoading=!0,t.src=e||S)}),this.sub("*tabId",e=>{this.ref["img-el"].className=v("image",{image_hidden_to_cropper:e===w.CROP,image_hidden_effects:e!==w.CROP})})}initCallback(){if(super.initCallback(),this.$.cdnUrl){let e=Ke(this.$.cdnUrl);this.$["*originalUrl"]=Ee(this.$.cdnUrl,e);let t=Ge(this.$.cdnUrl),s=it(t);this.$["*editorTransformations"]=s}else if(this.$.uuid)this.$["*originalUrl"]=Ee(this.localCtx.read("--cfg-cdn-cname"),this.$.uuid);else throw new Error("No UUID nor CDN URL provided");this.classList.add("editor_ON"),this.sub("*networkProblems",e=>{this.$["presence.networkProblems"]=e,this.$["presence.modalCaption"]=!e}),this.sub("*editorTransformations",e=>{let t=this.$["*originalUrl"],s=E(D(e)),o=P(t,E(s,"preview")),n={originalUrl:t,cdnUrlModifiers:s,cdnUrl:o,transformations:e};this.dispatchEvent(new CustomEvent("change",{detail:n,bubbles:!0,composed:!0}))},!1);try{fetch(P(this.$["*originalUrl"],E("json"))).then(e=>e.json()).then(({width:e,height:t})=>{this.$["*imageSize"]={width:e,height:t}})}catch(e){e&&console.error("Failed to load image info",e)}}};K.template=st;K.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl"});var G=33.333333333333336,T=24*2+34;function M(r,i){for(let e in i)r.setAttributeNS(null,e,i[e].toString())}function C(r,i={}){let e=document.createElementNS("http://www.w3.org/2000/svg",r);return M(e,i),e}function at(r,i){let{x:e,y:t,width:s,height:o}=r,n=i.includes("w")?0:1,l=i.includes("n")?0:1,a=[-1,1][n],c=[-1,1][l],h=[e+n*s+1.5*a,t+l*o+1.5*c-24*c],d=[e+n*s+1.5*a,t+l*o+1.5*c],u=[e+n*s-24*a+1.5*a,t+l*o+1.5*c];return{d:`M ${h[0]} ${h[1]} L ${d[0]} ${d[1]} L ${u[0]} ${u[1]}`,center:d}}function ht(r,i){let{x:e,y:t,width:s,height:o}=r,n=["n","s"].includes(i)?.5:{w:0,e:1}[i],l=["w","e"].includes(i)?.5:{n:0,s:1}[i],a=[-1,1][n],c=[-1,1][l],h,d;["n","s"].includes(i)?(h=[e+n*s-34/2,t+l*o+1.5*c],d=[e+n*s+34/2,t+l*o+1.5*c]):(h=[e+n*s+1.5*a,t+l*o-34/2],d=[e+n*s+1.5*a,t+l*o+34/2]);let u=`M ${h[0]} ${h[1]} L ${d[0]} ${d[1]}`,_=[d[0]-(d[0]-h[0])/2,d[1]-(d[1]-h[1])/2];return{d:u,center:_}}function ct(r){return r===""?"move":["e","w"].includes(r)?"ew-resize":["n","s"].includes(r)?"ns-resize":["nw","se"].includes(r)?"nwse-resize":"nesw-resize"}function dt(r,[i,e]){return{...r,x:r.x+i,y:r.y+e}}function ne(r,i){let{x:e}=r,{y:t}=r;return r.x<i.x?e=i.x:r.x+r.width>i.x+i.width&&(e=i.x+i.width-r.width),r.y<i.y?t=i.y:r.y+r.height>i.y+i.height&&(t=i.y+i.height-r.height),{...r,x:e,y:t}}function ut(r,[i,e],t){let{x:s,y:o,width:n,height:l}=r;return t.includes("n")&&(o+=e,l-=e),t.includes("s")&&(l+=e),t.includes("w")&&(s+=i,n-=i),t.includes("e")&&(n+=i),{x:s,y:o,width:n,height:l}}function pt(r,i){let e=Math.max(r.x,i.x),t=Math.min(r.x+r.width,i.x+i.width),s=Math.max(r.y,i.y),o=Math.min(r.y+r.height,i.y+i.height);return{x:e,y:s,width:t-e,height:o-s}}function le(r,[i,e],t){let{x:s,y:o,width:n,height:l}=r;if(t.includes("n")){let a=l;l=Math.max(e,l),o=o+a-l}if(t.includes("s")&&(l=Math.max(e,l)),t.includes("w")){let a=n;n=Math.max(i,n),s=s+a-n}return t.includes("e")&&(n=Math.max(i,n)),{x:s,y:o,width:n,height:l}}function ft(r,[i,e]){return r.x<=i&&i<=r.x+r.width&&r.y<=e&&e<=r.y+r.height}var ae=class extends m{constructor(){super();f(this,"init$",{...this.ctxInit,dragging:!1});this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(e){let t=this.$["*imageBox"];if(!t)return;if(e===""&&t.height<=T&&t.width<=T)return!0;let s=t.height<=T&&(e.includes("n")||e.includes("s")),o=t.width<=T&&(e.includes("e")||e.includes("w"));return s||o}_createBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:s,width:o,height:n}=e,l=this.ref["svg-el"],a=C("mask",{id:"backdrop-mask"}),c=C("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),h=C("rect",{x:t,y:s,width:o,height:n,fill:"black"});a.appendChild(c),a.appendChild(h);let d=C("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});l.appendChild(d),l.appendChild(a),this._backdropMask=a,this._backdropMaskInner=h}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask.style.display="block"}))}_updateBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:s,width:o,height:n}=e;M(this._backdropMaskInner,{x:t,y:s,width:o,height:n})}_updateFrame(){let e=this.$["*cropBox"];if(!e)return;for(let s of Object.values(this._frameThumbs)){let{direction:o,pathNode:n,interactionNode:l,groupNode:a}=s,c=o==="",h=o.length===2;if(c){let{x:u,y:_,width:b,height:F}=e,x=[u+b/2,_+F/2];M(l,{r:Math.min(b,F)/3,cx:x[0],cy:x[1]})}else{let{d:u,center:_}=h?at(e,o):ht(e,o);M(l,{cx:_[0],cy:_[1]}),M(n,{d:u})}let d=this._shouldThumbBeDisabled(o);a.setAttribute("class",v("thumb",{"thumb--hidden":d,"thumb--visible":!d}))}let t=this._frameGuides;M(t,{x:e.x-1*.5,y:e.y-1*.5,width:e.width+1,height:e.height+1})}_createThumbs(){let e={};for(let t=0;t<3;t++)for(let s=0;s<3;s++){let o=`${["n","","s"][t]}${["w","","e"][s]}`,n=C("g");n.classList.add("thumb"),n.setAttribute("with-effects","");let l=C("circle",{r:24+1.5,fill:"transparent"}),a=C("path",{stroke:"currentColor",fill:"none","stroke-width":3});n.appendChild(a),n.appendChild(l),e[o]={direction:o,pathNode:a,interactionNode:l,groupNode:n},l.addEventListener("pointerdown",this._handlePointerDown.bind(this,o))}return e}_createGuides(){let e=C("svg"),t=C("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":1,"stroke-opacity":.5});e.appendChild(t);for(let s=1;s<=2;s++){let o=C("line",{x1:`${G*s}%`,y1:"0%",x2:`${G*s}%`,y2:"100%",stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(o)}for(let s=1;s<=2;s++){let o=C("line",{x1:"0%",y1:`${G*s}%`,x2:"100%",y2:`${G*s}%`,stroke:"#000000","stroke-width":1,"stroke-opacity":.3});e.appendChild(o)}return e.classList.add("guides","guides--semi-hidden"),e}_createFrame(){let e=this.ref["svg-el"],t=document.createDocumentFragment(),s=this._createGuides();t.appendChild(s);let o=this._createThumbs();for(let{groupNode:n}of Object.values(o))t.appendChild(n);e.appendChild(t),this._frameThumbs=o,this._frameGuides=s}_handlePointerDown(e,t){let s=this._frameThumbs[e];if(this._shouldThumbBeDisabled(e))return;let o=this.$["*cropBox"],{x:n,y:l}=this.ref["svg-el"].getBoundingClientRect(),a=t.x-n,c=t.y-l;this.$.dragging=!0,this._draggingThumb=s,this._dragStartPoint=[a,c],this._dragStartCrop={...o}}_handlePointerUp_(e){this._updateCursor(),this.$.dragging&&(e.stopPropagation(),e.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(e){if(!this.$.dragging)return;e.stopPropagation(),e.preventDefault();let t=this.ref["svg-el"],{x:s,y:o}=t.getBoundingClientRect(),n=e.x-s,l=e.y-o,a=n-this._dragStartPoint[0],c=l-this._dragStartPoint[1],{direction:h}=this._draggingThumb,d=this.$["*imageBox"],u=this._dragStartCrop;h===""?(u=dt(u,[a,c]),u=ne(u,d)):(u=ut(u,[a,c],h),u=pt(u,d));let _=[Math.min(d.width,T),Math.min(d.height,T)];if(u=le(u,_,h),!Object.values(u).every(b=>Number.isFinite(b)&&b>=0)){console.error("CropFrame is trying to create invalid rectangle",{payload:u});return}this.$["*cropBox"]=u}_handleSvgPointerMove_(e){let t=Object.values(this._frameThumbs).find(s=>{if(this._shouldThumbBeDisabled(s.direction))return!1;let n=s.groupNode.getBoundingClientRect(),l={x:n.x,y:n.y,width:n.width,height:n.height};return ft(l,[e.x,e.y])});this._hoverThumb=t,this._updateCursor()}_updateCursor(){let e=this._hoverThumb;this.ref["svg-el"].style.cursor=e?ct(e.direction):"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(e){Object.values(this._frameThumbs).map(({groupNode:t})=>t).forEach(t=>{t.setAttribute("class",v("thumb",{"thumb--hidden":!e,"thumb--visible":e}))})}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",e=>{e&&(this._guidesHidden=e.height<=T||e.width<=T,window.requestAnimationFrame(()=>{this._render()}))}),this.sub("dragging",e=>{this._frameGuides.setAttribute("class",v({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&e,"guides--semi-hidden":!this._guidesHidden&&!e}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}};ae.template='<svg class="svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg>';var L=class extends m{constructor(){super(...arguments);f(this,"init$",{...this.ctxInit,active:!1,title:"",icon:"","on.click":null})}initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.sub("title",e=>{this._titleEl&&(this._titleEl.style.display=e?"block":"none")}),this.sub("active",e=>{this.className=v({active:e,not_active:!e})}),this.sub("on.click",e=>{this.onclick=e})}};L.template=`<div class="before"></div><lr-icon size="20" set="@name: icon;"></lr-icon><div class="title" ref="title-el">{{title}}</div>`;function Gt(r){let i=r+90;return i=i>=360?0:i,i}function Yt(r,i){return r==="rotate"?Gt(i):["mirror","flip"].includes(r)?!i:null}var X=class extends L{initCallback(){super.initCallback(),this.defineAccessor("operation",i=>{i&&(this._operation=i,this.$.icon=i)}),this.$["on.click"]=i=>{let e=this.$["*cropperEl"].getValue(this._operation),t=Yt(this._operation,e);this.$["*cropperEl"].setValue(this._operation,t)}}};var Y={FILTER:"filter",COLOR_OPERATION:"color_operation"},I="original",he=class extends m{constructor(){super(...arguments);f(this,"init$",{...this.ctxInit,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":e=>{this.$["*faderEl"].set(e),this.$.value=e}})}setOperation(e,t){this._controlType=e==="filter"?Y.FILTER:Y.COLOR_OPERATION,this._operation=e,this._iconName=e,this._title=e.toUpperCase(),this._filter=t,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===I?void 0:this.$.value,filter:this._filter===I?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:e,zero:t}=R[this._operation],[s,o]=e;this.$.min=s,this.$.max=o,this.$.zero=t;let n=this.$["*editorTransformations"][this._operation];if(this._controlType===Y.FILTER){let l=o;if(n){let{name:a,amount:c}=n;l=a===this._filter?c:o}this.$.value=l,this.$.defaultValue=l}if(this._controlType===Y.COLOR_OPERATION){let l=typeof n!="undefined"?n:t;this.$.value=l,this.$.defaultValue=l}}apply(){let e;this._controlType===Y.FILTER?this._filter===I?e=null:e={name:this._filter,amount:this.$.value}:e=this.$.value;let t={...this.$["*editorTransformations"],[this._operation]:e};this.$["*editorTransformations"]=t}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",e=>{this._originalUrl=e}),this.sub("value",e=>{let t=`${this._filter||this._operation} ${e}`;this.$["*operationTooltip"]=t})}};he.template=`<lr-slider-ui ref="slider-el" set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;" ></lr-slider-ui>`;function q(r){let i=new Image;return{promise:new Promise((s,o)=>{i.src=r,i.onload=s,i.onerror=o}),image:i,cancel:()=>{i.naturalWidth===0&&(i.src=S)}}}function Z(r){let i=[];for(let o of r){let n=q(o);i.push(n)}let e=i.map(o=>o.image);return{promise:Promise.allSettled(i.map(o=>o.promise)),images:e,cancel:()=>{i.forEach(o=>{o.cancel()})}}}var U=class extends L{constructor(){super(...arguments);f(this,"init$",{...this.ctxInit,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null})}_previewSrc(){let e=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),t=window.devicePixelRatio,s=Math.ceil(t*e),o=t>=2?"lightest":"normal",n=100,l={...this.$["*editorTransformations"]};return l[this._operation]=this._filter!==I?{name:this._filter,amount:n}:void 0,P(this._originalUrl,E(se,D(l),`quality/${o}`,`scale_crop/${s}x${s}/center`))}_observerCallback(e,t){if(e[0].isIntersecting){let o=this.proxyUrl(this._previewSrc()),n=this.ref["preview-el"],{promise:l,cancel:a}=q(o);this._cancelPreload=a,l.catch(c=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:c})}).finally(()=>{n.style.backgroundImage=`url(${o})`,n.setAttribute("loaded",""),t.unobserve(this)})}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",t=>{this._operation="filter",this._filter=t,this.$.isOriginal=t===I,this.$.icon=this.$.isOriginal?"original":"slider"}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let e=this.$["*originalUrl"];this._originalUrl=e,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",t=>{this.$.active=t&&t===this._filter}),this.sub("isOriginal",t=>{this.$.iconSize=t?40:20}),this.sub("active",t=>{if(this.$.isOriginal)return;let s=this.ref["icon-el"];s.style.opacity=t?"1":"0";let o=this.ref["preview-el"];t?o.style.opacity="0":o.style.backgroundImage&&(o.style.opacity="1")}),this.sub("*networkProblems",t=>{if(!t){let s=this.proxyUrl(this._previewSrc()),o=this.ref["preview-el"];o.style.backgroundImage&&(o.style.backgroundImage="none",o.style.backgroundImage=`url(${s})`)}})}destroyCallback(){var e;super.destroyCallback(),(e=this._observer)==null||e.disconnect(),this._cancelPreload&&this._cancelPreload()}};U.template=`<div class="before"></div><div class="preview" ref="preview-el"></div><lr-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></lr-icon>`;var W=class extends L{constructor(){super(...arguments);f(this,"_operation","")}initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",e=>{e&&(this._operation=e,this.$.icon=e,this.$.title=this.l10n(e))}),this.sub("*editorTransformations",e=>{if(!this._operation)return;let{zero:t}=R[this._operation],s=e[this._operation],o=typeof s!="undefined"?s!==t:!1;this.$.active=o})}};function mt(r,i){let e={};for(let t of i){let s=r[t];(r.hasOwnProperty(t)||s!==void 0)&&(e[t]=s)}return e}function j(r,i,e){let s=window.devicePixelRatio,o=Math.min(Math.ceil(i*s),3e3),n=s>=2?"lightest":"normal";return P(r,E(se,D(e),`quality/${n}`,`stretch/off/-/resize/${o}x`))}function ce(r,i,e){return Math.min(Math.max(r,i),e)}function Q({width:r,height:i},e){let t=e/90%2!==0;return{width:t?i:r,height:t?r:i}}function Zt(r){return r?[({dimensions:e,coords:t})=>[...e,...t].every(s=>Number.isInteger(s)&&Number.isFinite(s)),({dimensions:e,coords:t})=>e.every(s=>s>0)&&t.every(s=>s>=0)].every(e=>e(r)):!0}var de=class extends m{constructor(){super();f(this,"init$",{...this.ctxInit,image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}});this._commitDebounced=A(this._commit.bind(this),300),this._handleResizeDebounced=A(this._handleResize.bind(this),10)}_handleResize(){this.isConnected&&(this.deactivate(),this.activate(this._imageSize,{fromViewer:!1}))}_syncTransformations(){let e=this.$["*editorTransformations"],t=mt(e,Object.keys(this.$["*operations"])),s={...this.$["*operations"],...t};this.$["*operations"]=s}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),s=this.offsetWidth,o=this.offsetHeight,n=window.devicePixelRatio;e.style.width=`${s}px`,e.style.height=`${o}px`,e.width=s*n,e.height=o*n,t.scale(n,n),this._canvas=e,this._ctx=t}_alignImage(){if(!this._isActive||!this.$.image)return;let e=this.$.image,t=this.$["*padding"],s=this.$["*operations"],{rotate:o}=s,n={width:this.offsetWidth,height:this.offsetHeight},l=Q({width:e.naturalWidth,height:e.naturalHeight},o);if(l.width>n.width-t*2||l.height>n.height-t*2){let a=l.width/l.height,c=n.width/n.height;if(a>c){let h=n.width-t*2,d=h/a,u=0+t,_=t+(n.height-t*2)/2-d/2;this.$["*imageBox"]={x:u,y:_,width:h,height:d}}else{let h=n.height-t*2,d=h*a,u=t+(n.width-t*2)/2-d/2,_=0+t;this.$["*imageBox"]={x:u,y:_,width:d,height:h}}}else{let{width:a,height:c}=l,h=t+(n.width-t*2)/2-a/2,d=t+(n.height-t*2)/2-c/2;this.$["*imageBox"]={x:h,y:d,width:a,height:c}}}_alignCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],s=this.$["*operations"],{rotate:o}=s,n=this.$["*editorTransformations"].crop;if(n){let{dimensions:[a,c],coords:[h,d]}=n,{width:u,x:_,y:b}=this.$["*imageBox"],{width:F}=Q(this._imageSize,o),x=u/F;e={x:_+h*x,y:b+d*x,width:a*x,height:c*x}}else e={x:t.x,y:t.y,width:t.width,height:t.height};let l=[Math.min(t.width,T),Math.min(t.height,T)];e=le(e,l,"se"),e=ne(e,t),this.$["*cropBox"]=e}_drawImage(){let e=this.$.image,t=this.$["*imageBox"],s=this.$["*operations"],{mirror:o,flip:n,rotate:l}=s,a=this._ctx,c=Q({width:t.width,height:t.height},l);a.save(),a.translate(t.x+t.width/2,t.y+t.height/2),a.rotate(l*Math.PI*-1/180),a.scale(o?-1:1,n?-1:1),a.drawImage(e,-c.width/2,-c.height/2,c.width,c.height),a.restore()}_draw(){if(!this._isActive||!this.$.image)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout(()=>{this.className=v({active_from_viewer:e,active_from_editor:!e,inactive_to_editor:!1})}))}_calculateDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],s=this.$["*operations"],{rotate:o}=s,{width:n,height:l}=t,{width:a,height:c}=Q(this._imageSize,o),{width:h,height:d}=e,u=n/a,_=l/c;return[ce(Math.round(h/u),1,a),ce(Math.round(d/_),1,c)]}_calculateCrop(){let e=this.$["*cropBox"],t=this.$["*imageBox"],s=this.$["*operations"],{rotate:o}=s,{width:n,height:l,x:a,y:c}=t,{width:h,height:d}=Q(this._imageSize,o),{x:u,y:_}=e,b=n/h,F=l/d,x=this._calculateDimensions(),be={dimensions:x,coords:[ce(Math.round((u-a)/b),0,h-x[0]),ce(Math.round((_-c)/F),0,d-x[1])]};if(!Zt(be)){console.error("Cropper is trying to create invalid crop object",{payload:be});return}if(!(x[0]===h&&x[1]===d))return be}_commit(){if(!this.isConnected)return;let e=this.$["*operations"],{rotate:t,mirror:s,flip:o}=e,n=this._calculateCrop(),a={...this.$["*editorTransformations"],crop:n,rotate:t,mirror:s,flip:o};this.$["*editorTransformations"]=a}setValue(e,t){console.log(`Apply cropper operation [${e}=${t}]`),this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset),this._initCanvas();try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw(),this._animateIn({fromViewer:t})}catch(s){console.error("Failed to activate cropper",{error:s})}}}deactivate(){this._isActive&&(this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=v({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}))}_transitionToCrop(){let e=this._calculateDimensions(),t=Math.min(this.offsetWidth,e[0])/this.$["*cropBox"].width,s=Math.min(this.offsetHeight,e[1])/this.$["*cropBox"].height,o=Math.min(t,s),n=this.$["*cropBox"].x+this.$["*cropBox"].width/2,l=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${o}) translate(${(this.offsetWidth/2-n)/o}px, ${(this.offsetHeight/2-l)/o}px)`,this.style.transformOrigin=`${n}px ${l}px`}_transitionToImage(){let e=this.$["*cropBox"].x+this.$["*cropBox"].width/2,t=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${e}px ${t}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(e,t){let s=this.offsetWidth;t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let o=this.proxyUrl(j(e,s,t)),{promise:n,cancel:l,image:a}=q(o),c=this._handleImageLoading(o);return a.addEventListener("load",c,{once:!0}),a.addEventListener("error",c,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=l,n.then(()=>a).catch(h=>(console.error("Failed to load image",{error:h}),this.$["*networkProblems"]=!0,Promise.resolve(a)))}_handleImageLoading(e){let t="crop",s=this.$["*loadingOperations"];return s.get(t)||s.set(t,new Map),s.get(t).get(e)||(s.set(t,s.get(t).set(e,!0)),this.$["*loadingOperations"]=s),()=>{var o;(o=s==null?void 0:s.get(t))!=null&&o.has(e)&&(s.get(t).delete(e),this.$["*loadingOperations"]=s)}}initCallback(){super.initCallback(),this._observer=new ResizeObserver(([e])=>{e.contentRect.width>0&&e.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeDebounced()}),this._observer.observe(this),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",e=>{this.$.image&&this._commitDebounced()}),setTimeout(()=>{this.sub("*networkProblems",e=>{e||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}destroyCallback(){var e;super.destroyCallback(),(e=this._observer)==null||e.disconnect()}};de.template=`<canvas class="canvas" ref="canvas-el"></canvas><lr-crop-frame ref="frame-el"></lr-crop-frame>`;function Re(r,i,e){let t=Array(e);e--;for(let s=e;s>=0;s--)t[s]=Math.ceil((s*i+(e-s)*r)/e);return t}function Qt(r){return r.reduce((i,e,t)=>t<r.length-1?[...i,[e,r[t+1]]]:i,[])}function Jt(r,i,e){let t=Qt(r).find(([s,o])=>s<=i&&i<=o);return r.map(s=>{let o=Math.abs(t[0]-t[1]),n=Math.abs(i-t[0])/o;return t[0]===s?i>e?1:1-n:t[1]===s?i>=e?n:1:0})}function ei(r,i){return r.map((e,t)=>e<i?r.length-t:t)}function _t(r,i){let e=R[r].keypointsNumber,{range:t,zero:s}=R[r];return[...new Set([...Re(t[0],s,e+1),...Re(s,t[1],e+1),s,i])].sort((o,n)=>o-n)}var Ie=class extends m{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=A(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(i){let e=this._operation,t=this.$["*loadingOperations"];return t.get(e)||t.set(e,new Map),t.get(e).get(i)||(t.set(e,t.get(e).set(i,!0)),this.$["*loadingOperations"]=t),()=>{var s;(s=t==null?void 0:t.get(e))!=null&&s.has(i)&&(t.get(e).delete(i),this.$["*loadingOperations"]=t)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let i of this._keypoints){let{image:e}=i;e&&(e.style.opacity=i.opacity.toString(),e.style.zIndex=i.zIndex.toString())}})}_imageSrc({url:i=this._url,filter:e=this._filter,operation:t,value:s}={}){let o={...this._transformations};t&&(o[t]=e?{name:e,amount:s}:s);let n=this.offsetWidth;return this.proxyUrl(j(i,n,o))}_constructKeypoint(i,e){return{src:this._imageSrc({operation:i,value:e}),image:null,opacity:0,zIndex:0,value:e}}_isSame(i,e){return this._operation===i&&this._filter===e}_addKeypoint(i,e,t){let s=()=>!this._isSame(i,e)||this._value!==t||!!this._keypoints.find(a=>a.value===t);if(s())return;let o=this._constructKeypoint(i,t),n=new Image;n.src=o.src;let l=this._handleImageLoading(o.src);n.addEventListener("load",l,{once:!0}),n.addEventListener("error",l,{once:!0}),o.image=n,n.classList.add("fader-image"),n.addEventListener("load",()=>{if(s())return;let a=this._keypoints,c=a.findIndex(d=>d.value>t),h=c<a.length?a[c].image:null;!this._container||h&&!this._container.contains(h)||(a.splice(c,0,o),this._container.insertBefore(n,h),this._update(i,t))},{once:!0}),n.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(i){i=typeof i=="string"?parseInt(i,10):i,this._update(this._operation,i),this._addKeypointDebounced(this._operation,this._filter,i)}_update(i,e){this._operation=i,this._value=e;let{zero:t}=R[i],s=this._keypoints.map(l=>l.value),o=Jt(s,e,t),n=ei(s,t);for(let[l,a]of Object.entries(this._keypoints))a.opacity=o[l],a.zIndex=n[l];this._flush()}_createPreviewImage(){let i=new Image;return i.classList.add("fader-image","fader-image--preview"),i.style.opacity="0",i}async _initNodes(){let i=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&i.appendChild(this._previewImage);let e=document.createElement("div");i.appendChild(e);let t=this._keypoints.map(c=>c.src),{images:s,promise:o,cancel:n}=Z(t);s.forEach(c=>{let h=this._handleImageLoading(c.src);c.addEventListener("load",h),c.addEventListener("error",h)}),this._cancelLastImages=()=>{n(),this._cancelLastImages=void 0};let l=this._operation,a=this._filter;await o,this._isActive&&this._isSame(l,a)&&(this._container&&this._container.remove(),this._container=e,this._keypoints.forEach((c,h)=>{let d=s[h];d.classList.add("fader-image"),c.image=d,this._container.appendChild(d)}),this.appendChild(i),this._flush())}setTransformations(i){if(this._transformations=i,this._previewImage){let e=this._imageSrc(),t=this._handleImageLoading(e);this._previewImage.src=e,this._previewImage.addEventListener("load",t,{once:!0}),this._previewImage.addEventListener("error",t,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}preload({url:i,filter:e,operation:t,value:s}){this._cancelBatchPreload&&this._cancelBatchPreload();let n=_t(t,s).map(a=>this._imageSrc({url:i,filter:e,operation:t,value:a})),{cancel:l}=Z(n);this._cancelBatchPreload=l}_setOriginalSrc(i){let e=this._previewImage||this._createPreviewImage();if(!this.contains(e)&&this.appendChild(e),this._previewImage=e,e.src===i){e.style.opacity="1",e.style.transform="scale(1)",this.className=v({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1});return}e.style.opacity="0";let t=this._handleImageLoading(i);e.addEventListener("error",t,{once:!0}),e.src=i,e.addEventListener("load",()=>{t(),e&&(e.style.opacity="1",e.style.transform="scale(1)",this.className=v({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}))},{once:!0}),e.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}activate({url:i,operation:e,value:t,filter:s,fromViewer:o}){if(this._isActive=!0,this._hidden=!1,this._url=i,this._operation=e||"initial",this._value=t,this._filter=s,this._fromViewer=o,typeof t!="number"&&!s){let l=this._imageSrc({operation:e,value:t});this._setOriginalSrc(l),this._container&&this._container.remove();return}this._keypoints=_t(e,t).map(l=>this._constructKeypoint(e,l)),this._update(e,t),this._initNodes()}deactivate({hide:i=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),i&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=v({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:!0}),this.addEventListener("transitionend",()=>{this._container&&this._container.remove()},{once:!0})):this._container&&this._container.remove()}};var ti=1,ue=class extends m{initCallback(){super.initCallback(),this.addEventListener("wheel",i=>{i.preventDefault();let{deltaY:e,deltaX:t}=i;Math.abs(t)>ti?this.scrollLeft+=t:this.scrollLeft+=e})}};ue.template=" <slot></slot> ";function ii(r){return`<lr-btn-ui theme="boring" ref="tab-toggle-${r}" data-id="${r}" icon="${r}" tabindex="0" set="onclick: on.clickTab;" ></lr-btn-ui>`}function ri(r){return`<lr-presence-toggle class="tab-content" set="visible: presence.tabContent.${r}; styles: presence.tabContentStyles"><lr-editor-scroller hidden-scrollbar><div class="controls-list_align"><div class="controls-list_inner" ref="controls-list-${r}"></div></div></lr-editor-scroller></lr-presence-toggle>`}var pe=class extends m{constructor(){super();f(this,"_updateInfoTooltip",A(()=>{var o,n;let e=this.$["*editorTransformations"],t="",s=!1;if(this.$["*tabId"]===w.FILTERS)if(s=!0,this.$["*currentFilter"]&&((o=e==null?void 0:e.filter)==null?void 0:o.name)===this.$["*currentFilter"]){let l=((n=e==null?void 0:e.filter)==null?void 0:n.amount)||100;t=this.l10n(this.$["*currentFilter"])+" "+l}else t=this.l10n(I);else if(this.$["*tabId"]===w.SLIDERS&&this.$["*currentOperation"]){s=!0;let l=(e==null?void 0:e[this.$["*currentOperation"]])||R[this.$["*currentOperation"]].zero;t=this.$["*currentOperation"]+" "+l}s&&(this.$["*operationTooltip"]=t),this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",s)},0));this.init$={...this.ctxInit,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*currentFilter":I,"*currentOperation":null,"*tabId":w.CROP,showLoader:!1,filters:nt,colorOperations:ot,cropOperations:lt,"*operationTooltip":null,"l10n.cancel":this.l10n("cancel"),"l10n.apply":this.l10n("apply"),"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabContent.crop":!1,"presence.tabContent.sliders":!1,"presence.tabContent.filters":!1,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"on.cancel":e=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":e=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":e=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":e=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":e=>{let t=e.currentTarget.getAttribute("data-id");this._activateTab(t,{fromViewer:!1})}},this._debouncedShowLoader=A(this._showLoader.bind(this),500)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===w.SLIDERS&&this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",!1)}_createOperationControl(e){let t=W.is&&new W;return t.operation=e,t}_createFilterControl(e){let t=U.is&&new U;return t.filter=e,t}_createToggleControl(e){let t=X.is&&new X;return t.operation=e,t}_renderControlsList(e){let t=this.ref[`controls-list-${e}`],s=document.createDocumentFragment();e===w.CROP?this.$.cropOperations.forEach(o=>{let n=this._createToggleControl(o);s.appendChild(n)}):e===w.FILTERS?[I,...this.$.filters].forEach(o=>{let n=this._createFilterControl(o);s.appendChild(n)}):e===w.SLIDERS&&this.$.colorOperations.forEach(o=>{let n=this._createOperationControl(o);s.appendChild(n)}),s.childNodes.forEach((o,n)=>{n===s.childNodes.length-1&&o.classList.add("controls-list_last-item")}),t.innerHTML="",t.appendChild(s)}_activateTab(e,{fromViewer:t}){this.$["*tabId"]=e,e===w.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:t})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:t}),this.$["*cropperEl"].deactivate());for(let s of oe){let o=s===e,n=this.ref[`tab-toggle-${s}`];n.active=o,o?(this._renderControlsList(e),this._syncTabIndicator()):this._unmountTabControls(s),this.$[`presence.tabContent.${s}`]=o}}_unmountTabControls(e){let t=this.ref[`controls-list-${e}`];t&&(t.innerHTML="")}_syncTabIndicator(){let e=this.ref[`tab-toggle-${this.$["*tabId"]}`],t=this.ref["tabs-indicator"];t.style.transform=`translateX(${e.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let e=this.$["*imgContainerEl"].offsetWidth,t=this.proxyUrl(j(this.$["*originalUrl"],e,this.$["*editorTransformations"]));this._cancelPreload&&this._cancelPreload();let{cancel:s}=Z([t]);this._cancelPreload=()=>{s(),this._cancelPreload=void 0}}}_showLoader(e){this.$.showLoader=e}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",e=>{e&&setTimeout(()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})},0)}),this.sub("*editorTransformations",e=>{var s;let t=(s=e==null?void 0:e.filter)==null?void 0:s.name;this.$["*currentFilter"]!==t&&(this.$["*currentFilter"]=t)}),this.sub("*currentFilter",()=>{this._updateInfoTooltip()}),this.sub("*currentOperation",()=>{this._updateInfoTooltip()}),this.sub("*tabId",()=>{this._updateInfoTooltip()}),this.sub("*originalUrl",e=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()}),this.sub("*editorTransformations",e=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(e)}),this.sub("*loadingOperations",e=>{let t=!1;for(let[,s]of e.entries()){if(t)break;for(let[,o]of s.entries())if(o){t=!0;break}}this._debouncedShowLoader(t)}),this.sub("*showSlider",e=>{this.$["presence.subToolbar"]=e,this.$["presence.mainToolbar"]=!e}),this._updateInfoTooltip()}};pe.template=`<lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui><div class="info-tooltip_container"><div class="info-tooltip_wrapper"><div ref="tooltip-el" class="info-tooltip info-tooltip_hidden">{{*operationTooltip}}</div></div></div><div class="toolbar-container"><lr-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles"><div class="tab-content-row">${oe.map(ri).join("")}</div><div class="controls-row"><lr-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"></lr-btn-ui><div class="tab-toggles"><div ref="tabs-indicator" class="tab-toggles_indicator"></div> ${oe.map(ii).join("")} </div><lr-btn-ui theme="primary" icon="done" set="onclick: on.apply"></lr-btn-ui></div></lr-presence-toggle><lr-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles"><div class="slider"><lr-editor-slider ref="slider-el"></lr-editor-slider></div><div class="controls-row"><lr-btn-ui theme="boring" set="@text: l10n.cancel; onclick: on.cancelSlider;"></lr-btn-ui><lr-btn-ui theme="primary" set="@text: l10n.apply; onclick: on.applySlider;"></lr-btn-ui></div></lr-presence-toggle></div>`;var J=class extends m{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.ctxInit,text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",i=>{i?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return v("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",i=>{this._iconSingle=!this.$.text,this._iconHidden=!i,this.$.iconCss=this._iconCss()}),this.sub("theme",i=>{i!=="custom"&&(this.className=i)}),this.sub("text",i=>{this._iconSingle=!1}),this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(i){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}};J.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"});J.template=`<lr-icon size="20" set="className: iconCss; @name: icon;"></lr-icon><div class="text">{{text}}</div>`;var fe=class extends m{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let i=this.ref["line-el"];i.style.transition="initial",i.style.opacity="0",i.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",i=>{typeof i=="boolean"&&(i?this._start():this._stop())})}_start(){this._active=!0;let{width:i}=this.getBoundingClientRect(),e=this.ref["line-el"];e.style.transition="transform 1s",e.style.opacity="1",e.style.transform=`translateX(${i}px)`,e.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}};fe.template=`<div class="inner"><div class="line" ref="line-el"></div></div>`;var me={transition:"transition",visible:"visible",hidden:"hidden"},_e=class extends m{constructor(){super(),this._visible=!1,this._visibleStyle=me.visible,this._hiddenStyle=me.hidden,this._externalTransitions=!1,this.defineAccessor("styles",i=>{i&&(this._externalTransitions=!0,this._visibleStyle=i.visible,this._hiddenStyle=i.hidden)}),this.defineAccessor("visible",i=>{typeof i=="boolean"&&(this._visible=i,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",Je(this,{[me.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(me.transition),this._handleVisible(),setTimeout(()=>this.removeAttribute("hidden"),0)}};_e.template=" <slot></slot> ";var ge=class extends m{constructor(){super();f(this,"init$",{...this.ctxInit,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e),this.$.onInput&&this.$.onInput(e)},"on.sliderChange":()=>{let e=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(e)}});this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",t=>{this.$.disabled=t}),this.defineAccessor("min",t=>{this.$.min=t}),this.defineAccessor("max",t=>{this.$.max=t}),this.defineAccessor("defaultValue",t=>{this.$.defaultValue=t,this.ref["input-el"].value=t,this._updateValue(t)}),this.defineAccessor("zero",t=>{this._zero=t}),this.defineAccessor("onInput",t=>{t&&(this.$.onInput=t)}),this.defineAccessor("onChange",t=>{t&&(this.$.onChange=t)}),this._updateSteps(),this._observer=new ResizeObserver(()=>{this._updateSteps();let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)}),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)},0),this.sub("disabled",t=>{let s=this.ref["input-el"];t?s.setAttribute("disabled","disabled"):s.removeAttribute("disabled")});let e=this.ref["input-el"];e.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),e.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}_updateValue(e){this._updateZeroDot(e);let{width:t}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(e-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this.ref["thumb-el"].style.transform=`translateX(${n}px)`})}_updateZeroDot(e){if(!this._zeroDotEl)return;e===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:t}=this.getBoundingClientRect(),n=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl.style.transform=`translateX(${n}px)`})}_updateSteps(){let t=this.ref["steps-el"],{width:s}=t.getBoundingClientRect(),o=Math.ceil(s/2),n=Math.ceil(o/15)-2;if(this._stepsCount===n)return;let l=document.createDocumentFragment(),a=document.createElement("div"),c=document.createElement("div");a.className="minor-step",c.className="border-step",l.appendChild(c);for(let d=0;d<n;d++)l.appendChild(a.cloneNode());l.appendChild(c.cloneNode());for(let d=0;d<n;d++)l.appendChild(a.cloneNode());l.appendChild(c.cloneNode());let h=document.createElement("div");h.className="zero-dot",l.appendChild(h),this._zeroDotEl=h,t.innerHTML="",t.appendChild(l),this._stepsCount=n}destroyCallback(){var e;(e=this._observer)==null||e.disconnect()}};ge.template=`<div class="steps" ref="steps-el"></div><div ref="thumb-el" class="thumb"></div><input class="input" type="range" ref="input-el" tabindex="0" set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;" />`;export{K as CloudEditor,ae as CropFrame,X as EditorCropButtonControl,U as EditorFilterControl,de as EditorImageCropper,Ie as EditorImageFader,W as EditorOperationControl,ue as EditorScroller,he as EditorSlider,pe as EditorToolbar,fe as LineLoaderUi,J as LrBtnUi,_e as PresenceToggle,ge as SliderUi};