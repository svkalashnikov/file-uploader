/**
 * @license
 * MIT License
 * 
 * Copyright (c) 2022 Uploadcare (hello@uploadcare.com). All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
var li=Object.defineProperty;var ci=(e,i,t)=>i in e?li(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t;var c=(e,i,t)=>(ci(e,typeof i!="symbol"?i+"":i,t),t),Gt=(e,i,t)=>{if(!i.has(e))throw TypeError("Cannot "+t)};var I=(e,i,t)=>(Gt(e,i,"read from private field"),t?t.call(e):i.get(e)),et=(e,i,t)=>{if(i.has(e))throw TypeError("Cannot add the same private member more than once");i instanceof WeakSet?i.add(e):i.set(e,t)},bt=(e,i,t,s)=>(Gt(e,i,"write to private field"),s?s.call(e,t):i.set(e,t),t);var Rt=(e,i,t)=>(Gt(e,i,"access private method"),t);function ye(e){for(let i in e){let t=[...i].reduce((s,r)=>(r.toUpperCase()===r&&(r="-"+r.toLowerCase()),s+=r),"");t.startsWith("-")&&(t=t.replace("-","")),t.startsWith("lr-")||(t="lr-"+t),e[i].reg&&e[i].reg(t)}}var ui=Object.defineProperty,hi=(e,i,t)=>i in e?ui(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,Kt=(e,i,t)=>(hi(e,typeof i!="symbol"?i+"":i,t),t);function di(e){let i=t=>{var s;for(let r in t)((s=t[r])==null?void 0:s.constructor)===Object&&(t[r]=i(t[r]));return{...t}};return i(e)}var v=class{constructor(e){e.constructor===Object?this.store=di(e):(this._storeIsProxy=!0,this.store=e),this.callbackMap=Object.create(null)}static warn(e,i){console.warn(`Symbiote Data: cannot ${e}. Prop name: `+i)}read(e){return!this._storeIsProxy&&!this.store.hasOwnProperty(e)?(v.warn("read",e),null):this.store[e]}has(e){return this._storeIsProxy?this.store[e]!==void 0:this.store.hasOwnProperty(e)}add(e,i,t=!1){!t&&Object.keys(this.store).includes(e)||(this.store[e]=i,this.notify(e))}pub(e,i){if(!this._storeIsProxy&&!this.store.hasOwnProperty(e)){v.warn("publish",e);return}this.store[e]=i,this.notify(e)}multiPub(e){for(let i in e)this.pub(i,e[i])}notify(e){this.callbackMap[e]&&this.callbackMap[e].forEach(i=>{i(this.store[e])})}sub(e,i,t=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(e)?(v.warn("subscribe",e),null):(this.callbackMap[e]||(this.callbackMap[e]=new Set),this.callbackMap[e].add(i),t&&i(this.store[e]),{remove:()=>{this.callbackMap[e].delete(i),this.callbackMap[e].size||delete this.callbackMap[e]},callback:i})}static registerCtx(e,i=Symbol()){let t=v.globalStore.get(i);return t?console.warn('State: context UID "'+i+'" already in use'):(t=new v(e),v.globalStore.set(i,t)),t}static deleteCtx(e){v.globalStore.delete(e)}static getCtx(e,i=!0){return v.globalStore.get(e)||(i&&console.warn('State: wrong context UID - "'+e+'"'),null)}};v.globalStore=new Map;var g=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),Te="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",pi=Te.length-1,Ct=class{static generate(e="XXXXXXXXX-XXX"){let i="";for(let t=0;t<e.length;t++)i+=e[t]==="-"?e[t]:Te.charAt(Math.random()*pi);return i}};function Ee(e,i,t){let s=!0,r,n=i.split(".");return n.forEach((o,a)=>{a<n.length-1?e=e[o]:r=o}),e?e[r]=t:s=!1,s}function fi(e){return e.split("-").map((i,t)=>i&&t?i[0].toUpperCase()+i.slice(1):i).join("").split("_").map((i,t)=>i&&t?i.toUpperCase():i).join("")}function mi(e,i){[...e.querySelectorAll(`[${g.REPEAT_ATTR}]`)].forEach(t=>{let s=t.getAttribute(g.REPEAT_ITEM_TAG_ATTR),r;if(s&&(r=window.customElements.get(s)),!r){r=class extends i.BaseComponent{constructor(){super(),s||(this.style.display="contents")}};let o=t.innerHTML;r.template=o,r.reg(s)}for(;t.firstChild;)t.firstChild.remove();let n=t.getAttribute(g.REPEAT_ATTR);i.sub(n,o=>{if(!o){for(;t.firstChild;)t.firstChild.remove();return}let a=[...t.children],l,u=h=>{h.forEach((p,f)=>{if(a[f])if(a[f].set$)setTimeout(()=>{a[f].set$(p)});else for(let _ in p)a[f][_]=p[_];else{l||(l=new DocumentFragment);let _=new r;Object.assign(_.init$,p),l.appendChild(_)}}),l&&t.appendChild(l);let d=a.slice(h.length,a.length);for(let p of d)p.remove()};if(o.constructor===Array)u(o);else if(o.constructor===Object){let h=[];for(let d in o){let p=o[d];Object.defineProperty(p,"_KEY_",{value:d,enumerable:!0}),h.push(p)}u(h)}else console.warn("Symbiote repeat data type error:"),console.log(o)}),t.removeAttribute(g.REPEAT_ATTR),t.removeAttribute(g.REPEAT_ITEM_TAG_ATTR)})}var Ce="__default__";function gi(e,i){if(i.shadowRoot)return;let t=[...e.querySelectorAll("slot")];if(!t.length)return;let s={};t.forEach(r=>{let n=r.getAttribute("name")||Ce;s[n]={slot:r,fr:document.createDocumentFragment()}}),i.initChildren.forEach(r=>{var n;let o=Ce;r instanceof Element&&r.hasAttribute("slot")&&(o=r.getAttribute("slot"),r.removeAttribute("slot")),(n=s[o])==null||n.fr.appendChild(r)}),Object.values(s).forEach(r=>{if(r.fr.childNodes.length)r.slot.parentNode.replaceChild(r.fr,r.slot);else if(r.slot.childNodes.length){let n=document.createDocumentFragment();n.append(...r.slot.childNodes),r.slot.parentNode.replaceChild(n,r.slot)}else r.slot.remove()})}function _i(e,i){[...e.querySelectorAll(`[${g.EL_REF_ATTR}]`)].forEach(t=>{let s=t.getAttribute(g.EL_REF_ATTR);i.ref[s]=t,t.removeAttribute(g.EL_REF_ATTR)})}function bi(e,i){[...e.querySelectorAll(`[${g.BIND_ATTR}]`)].forEach(t=>{let r=t.getAttribute(g.BIND_ATTR).split(";");[...t.attributes].forEach(n=>{if(n.name.startsWith("-")&&n.value){let o=fi(n.name.replace("-",""));r.push(o+":"+n.value),t.removeAttribute(n.name)}}),r.forEach(n=>{if(!n)return;let o=n.split(":").map(h=>h.trim()),a=o[0],l;a.indexOf(g.ATTR_BIND_PRFX)===0&&(l=!0,a=a.replace(g.ATTR_BIND_PRFX,""));let u=o[1].split(",").map(h=>h.trim());for(let h of u){let d;h.startsWith("!!")?(d="double",h=h.replace("!!","")):h.startsWith("!")&&(d="single",h=h.replace("!","")),i.sub(h,p=>{d==="double"?p=!!p:d==="single"&&(p=!p),l?(p==null?void 0:p.constructor)===Boolean?p?t.setAttribute(a,""):t.removeAttribute(a):t.setAttribute(a,p):Ee(t,a,p)||(t[g.SET_LATER_KEY]||(t[g.SET_LATER_KEY]=Object.create(null)),t[g.SET_LATER_KEY][a]=p)})}}),t.removeAttribute(g.BIND_ATTR)})}var It="{{",yt="}}",yi="skip-text";function Ci(e){let i,t=[],s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:r=>{var n;return!((n=r.parentElement)!=null&&n.hasAttribute(yi))&&r.textContent.includes(It)&&r.textContent.includes(yt)&&1}});for(;i=s.nextNode();)t.push(i);return t}var vi=function(e,i){Ci(e).forEach(s=>{let r=[],n;for(;s.textContent.includes(yt);)s.textContent.startsWith(It)?(n=s.textContent.indexOf(yt)+yt.length,s.splitText(n),r.push(s)):(n=s.textContent.indexOf(It),s.splitText(n)),s=s.nextSibling;r.forEach(o=>{let a=o.textContent.replace(It,"").replace(yt,"");o.textContent="",i.sub(a,l=>{o.textContent=l})})})},Ti=[mi,gi,_i,bi,vi],Ot="'",at='"',Ei=/\\([0-9a-fA-F]{1,6} ?)/g;function Ai(e){return(e[0]===at||e[0]===Ot)&&(e[e.length-1]===at||e[e.length-1]===Ot)}function wi(e){return(e[0]===at||e[0]===Ot)&&(e=e.slice(1)),(e[e.length-1]===at||e[e.length-1]===Ot)&&(e=e.slice(0,-1)),e}function xi(e){let i="",t="";for(var s=0;s<e.length;s++){let r=e[s+1];e[s]==="\\"&&r==='"'?(i+='\\"',s++):e[s]==='"'&&t!=="\\"?i+='\\"':i+=e[s],t=e[s]}return i}function Si(e){let i=e;Ai(e)&&(i=wi(i),i=i.replace(Ei,(t,s)=>String.fromCodePoint(parseInt(s.trim(),16))),i=i.replaceAll(`\\
`,"\\n"),i=xi(i),i=at+i+at);try{return JSON.parse(i)}catch{throw new Error(`Failed to parse CSS property value: ${i}. Original input: ${e}`)}}var ve=0,ot=null,X=null,K=class extends HTMLElement{constructor(){super(),Kt(this,"updateCssData",()=>{var e;this.dropCssDataCache(),(e=this.__boundCssProps)==null||e.forEach(i=>{let t=this.getCssData(this.__extractCssName(i),!0);t!==null&&this.$[i]!==t&&(this.$[i]=t)})}),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return K}initCallback(){}__initCallback(){var e;this.__initialized||(this.__initialized=!0,(e=this.initCallback)==null||e.call(this))}render(e,i=this.renderShadow){let t;if((i||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.allowCustomTemplate){let r=this.getAttribute(g.USE_TPL);if(r){let n=this.getRootNode(),o=(n==null?void 0:n.querySelector(r))||document.querySelector(r);o?e=o.content.cloneNode(!0):console.warn(`Symbiote template "${r}" is not found...`)}}if(this.processInnerHtml)for(let r of this.tplProcessors)r(this,this);if(e||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(e==null?void 0:e.constructor)===DocumentFragment)t=e;else if((e==null?void 0:e.constructor)===String){let r=document.createElement("template");r.innerHTML=e,t=r.content.cloneNode(!0)}else this.constructor.__tpl&&(t=this.constructor.__tpl.content.cloneNode(!0));for(let r of this.tplProcessors)r(t,this)}let s=()=>{t&&(i&&this.shadowRoot.appendChild(t)||this.appendChild(t)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){i=!0;let r=document.createElement("link");r.rel="stylesheet",r.href=this.constructor.__shadowStylesUrl,r.onload=s,this.shadowRoot.prepend(r)}else s()}addTemplateProcessor(e){this.tplProcessors.add(e)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=Ct.generate(),this.style.setProperty(g.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(g.CSS_CTX_PROP,!0)}get ctxName(){var e;let i=((e=this.getAttribute(g.CTX_NAME_ATTR))==null?void 0:e.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=i,i}get localCtx(){return this.__localCtx||(this.__localCtx=v.registerCtx({},this)),this.__localCtx}get nodeCtx(){return v.getCtx(this.ctxName,!1)||v.registerCtx({},this.ctxName)}static __parseProp(e,i){let t,s;if(e.startsWith(g.EXT_DATA_CTX_PRFX))t=i.nodeCtx,s=e.replace(g.EXT_DATA_CTX_PRFX,"");else if(e.includes(g.NAMED_DATA_CTX_SPLTR)){let r=e.split(g.NAMED_DATA_CTX_SPLTR);t=v.getCtx(r[0]),s=r[1]}else t=i.localCtx,s=e;return{ctx:t,name:s}}sub(e,i,t=!0){let s=n=>{this.isConnected&&i(n)},r=K.__parseProp(e,this);r.ctx.has(r.name)?this.allSubs.add(r.ctx.sub(r.name,s,t)):window.setTimeout(()=>{this.allSubs.add(r.ctx.sub(r.name,s,t))})}notify(e){let i=K.__parseProp(e,this);i.ctx.notify(i.name)}has(e){let i=K.__parseProp(e,this);return i.ctx.has(i.name)}add(e,i,t=!1){let s=K.__parseProp(e,this);s.ctx.add(s.name,i,t)}add$(e,i=!1){for(let t in e)this.add(t,e[t],i)}get $(){if(!this.__stateProxy){let e=Object.create(null);this.__stateProxy=new Proxy(e,{set:(i,t,s)=>{let r=K.__parseProp(t,this);return r.ctx.pub(r.name,s),!0},get:(i,t)=>{let s=K.__parseProp(t,this);return s.ctx.read(s.name)}})}return this.__stateProxy}set$(e,i=!1){for(let t in e){let s=e[t];i||![String,Number,Boolean].includes(s==null?void 0:s.constructor)?this.$[t]=s:this.$[t]!==s&&(this.$[t]=s)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(g.CTX_OWNER_ATTR)&&this.getAttribute(g.CTX_OWNER_ATTR)!=="false"}__initDataCtx(){let e=this.constructor.__attrDesc;if(e)for(let i of Object.values(e))Object.keys(this.init$).includes(i)||(this.init$[i]="");for(let i in this.init$)if(i.startsWith(g.EXT_DATA_CTX_PRFX))this.nodeCtx.add(i.replace(g.EXT_DATA_CTX_PRFX,""),this.init$[i],this.__ctxOwner);else if(i.includes(g.NAMED_DATA_CTX_SPLTR)){let t=i.split(g.NAMED_DATA_CTX_SPLTR),s=t[0].trim(),r=t[1].trim();if(s&&r){let n=v.getCtx(s,!1);n||(n=v.registerCtx({},s)),n.add(r,this.init$[i])}}else this.localCtx.add(i,this.init$[i]);for(let i in this.cssInit$)this.bindCssData(i,this.cssInit$[i]);this.__dataCtxInitialized=!0}connectedCallback(){var e;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let i=(e=this.getAttribute(g.CTX_NAME_ATTR))==null?void 0:e.trim();if(i&&this.style.setProperty(g.CSS_CTX_PROP,`'${i}'`),this.__initDataCtx(),this[g.SET_LATER_KEY]){for(let t in this[g.SET_LATER_KEY])Ee(this,t,this[g.SET_LATER_KEY][t]);delete this[g.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let t of Ti)this.addTemplateProcessor(t);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let t=this.getRootNode();if(!t)return;if(t==null?void 0:t.querySelector(`link[${g.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`)){this.render();return}let r=this.constructor.__rootStylesLink.cloneNode(!0);r.setAttribute(g.ROOT_STYLE_ATTR_NAME,this.constructor.is),r.onload=()=>{this.render()},t.nodeType===Node.DOCUMENT_NODE?t.head.appendChild(r):t.prepend(r)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let e of this.allSubs)e.remove(),this.allSubs.delete(e);for(let e of this.tplProcessors)this.tplProcessors.delete(e);X==null||X.delete(this.updateCssData),X!=null&&X.size||(ot==null||ot.disconnect(),ot=null,X=null)},100)))}static reg(e,i=!1){if(e||(ve++,e=`${g.AUTO_TAG_PRFX}-${ve}`),this.__tag=e,window.customElements.get(e)){console.warn(`${e} - is already in "customElements" registry`);return}window.customElements.define(e,i?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(e){this.observedAttributes=Object.keys(e),this.__attrDesc=e}attributeChangedCallback(e,i,t){var s;if(i===t)return;let r=(s=this.constructor.__attrDesc)==null?void 0:s[e];r?this.__dataCtxInitialized?this.$[r]=t:this.init$[r]=t:this[e]=t}getCssData(e,i=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(e)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let t=this.__computedStyle.getPropertyValue(e).trim();try{this.__cssDataCache[e]=Si(t)}catch{!i&&console.warn(`CSS Data error: ${e}`),this.__cssDataCache[e]=null}}return this.__cssDataCache[e]}__extractCssName(e){return e.split("--").map((i,t)=>t===0?"":i).join("--")}__initStyleAttrObserver(){X||(X=new Set),X.add(this.updateCssData),ot||(ot=new MutationObserver(e=>{e[0].type==="attributes"&&X.forEach(i=>{i()})}),ot.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}))}bindCssData(e,i=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(e);let t=this.getCssData(this.__extractCssName(e),!0);t===null&&(t=i),this.add(e,t),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(e,i,t){let s="__"+e;this[s]=this[e],Object.defineProperty(this,e,{set:r=>{this[s]=r,t?window.setTimeout(()=>{i==null||i(r)}):i==null||i(r)},get:()=>this[s]}),this[e]=this[s]}static set shadowStyles(e){let i=new Blob([e],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(i)}static set rootStyles(e){if(!this.__rootStylesLink){let i=new Blob([e],{type:"text/css"}),t=URL.createObjectURL(i),s=document.createElement("link");s.href=t,s.rel="stylesheet",this.__rootStylesLink=s}}},Yt=K;Kt(Yt,"template");var qt=class{static _print(e){console.warn(e)}static setDefaultTitle(e){this.defaultTitle=e}static setRoutingMap(e){Object.assign(this.appMap,e);for(let i in this.appMap)!this.defaultRoute&&this.appMap[i].default===!0?this.defaultRoute=i:!this.errorRoute&&this.appMap[i].error===!0&&(this.errorRoute=i)}static set routingEventName(e){this.__routingEventName=e}static get routingEventName(){return this.__routingEventName||"sym-on-route"}static readAddressBar(){let e={route:null,options:{}};return window.location.search.split(this.separator).forEach(t=>{if(t.includes("?"))e.route=t.replace("?","");else if(t.includes("=")){let s=t.split("=");e.options[s[0]]=decodeURI(s[1])}else e.options[t]=!0}),e}static notify(){let e=this.readAddressBar(),i=this.appMap[e.route];if(i&&i.title&&(document.title=i.title),e.route===null&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!i&&this.errorRoute){this.applyRoute(this.errorRoute);return}else if(!i&&this.defaultRoute){this.applyRoute(this.defaultRoute);return}else if(!i){this._print(`Route "${e.route}" not found...`);return}let t=new CustomEvent(qt.routingEventName,{detail:{route:e.route,options:Object.assign(i||{},e.options)}});window.dispatchEvent(t)}static reflect(e,i={}){let t=this.appMap[e];if(!t){this._print("Wrong route: "+e);return}let s="?"+e;for(let n in i)i[n]===!0?s+=this.separator+n:s+=this.separator+n+`=${i[n]}`;let r=t.title||this.defaultTitle||"";window.history.pushState(null,r,s),document.title=r}static applyRoute(e,i={}){this.reflect(e,i),this.notify()}static setSeparator(e){this._separator=e}static get separator(){return this._separator||"&"}static createRouterData(e,i){this.setRoutingMap(i);let t=v.registerCtx({route:null,options:null,title:null},e);return window.addEventListener(this.routingEventName,s=>{var r;t.multiPub({route:s.detail.route,options:s.detail.options,title:((r=s.detail.options)==null?void 0:r.title)||this.defaultTitle||""})}),qt.notify(),this.initPopstateListener(),t}static initPopstateListener(){this.__onPopstate||(this.__onPopstate=()=>{this.notify()},window.addEventListener("popstate",this.__onPopstate))}static removePopstateListener(){window.removeEventListener("popstate",this.__onPopstate),this.__onPopstate=null}};qt.appMap=Object.create(null);var Ae="idb-store-ready",Ri="symbiote-db",Ii="symbiote-idb-update_",Oi=class{_notifyWhenReady(e=null){window.dispatchEvent(new CustomEvent(Ae,{detail:{dbName:this.name,storeName:this.storeName,event:e}}))}get _updEventName(){return Ii+this.name}_getUpdateEvent(e){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:e}})}_notifySubscribers(e){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,e),window.dispatchEvent(this._getUpdateEvent(e))}constructor(e,i){this.name=e,this.storeName=i,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=t=>{this.db=t.target.result,this.objStore=this.db.createObjectStore(i,{keyPath:"_key"}),this.objStore.transaction.oncomplete=s=>{this._notifyWhenReady(s)}},this.request.onsuccess=t=>{this.db=t.target.result,this._notifyWhenReady(t)},this.request.onerror=t=>{console.error(t)},this._subscriptionsMap={},this._updateHandler=t=>{t.key===this.name&&this._subscriptionsMap[t.newValue]&&this._subscriptionsMap[t.newValue].forEach(async r=>{r(await this.read(t.newValue))})},this._localUpdateHandler=t=>{this._updateHandler(t.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(e){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(e);return new Promise((s,r)=>{t.onsuccess=n=>{var o;(o=n.target.result)!=null&&o._value?s(n.target.result._value):(s(null),console.warn(`IDB: cannot read "${e}"`))},t.onerror=n=>{r(n)}})}write(e,i,t=!1){let s={_key:e,_value:i},n=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(s);return new Promise((o,a)=>{n.onsuccess=l=>{t||this._notifySubscribers(e),o(l.target.result)},n.onerror=l=>{a(l)}})}delete(e,i=!1){let s=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);return new Promise((r,n)=>{s.onsuccess=o=>{i||this._notifySubscribers(e),r(o)},s.onerror=o=>{n(o)}})}getAll(){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((t,s)=>{i.onsuccess=r=>{let n=r.target.result;t(n.map(o=>o._value))},i.onerror=r=>{s(r)}})}subscribe(e,i){this._subscriptionsMap[e]||(this._subscriptionsMap[e]=new Set);let t=this._subscriptionsMap[e];return t.add(i),{remove:()=>{t.delete(i),t.size||delete this._subscriptionsMap[e]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,we.clear(this.name)}},we=class{static get readyEventName(){return Ae}static open(e=Ri,i="store"){let t=e+"/"+i;return this._reg[t]||(this._reg[t]=new Oi(e,i)),this._reg[t]}static clear(e){window.indexedDB.deleteDatabase(e);for(let i in this._reg)i.split("/")[0]===e&&delete this._reg[i]}};Kt(we,"_reg",Object.create(null));var Di=e=>e,Jt="{{",Se="}}",xe="plural:";function Qt(e,i,t={}){var o;let{openToken:s=Jt,closeToken:r=Se,transform:n=Di}=t;for(let a in i){let l=(o=i[a])==null?void 0:o.toString();e=e.replaceAll(s+a+r,typeof l=="string"?n(l):l)}return e}function Re(e){let i=[],t=e.indexOf(Jt);for(;t!==-1;){let s=e.indexOf(Se,t),r=e.substring(t+2,s);if(r.startsWith(xe)){let n=e.substring(t+2,s).replace(xe,""),o=n.substring(0,n.indexOf("(")),a=n.substring(n.indexOf("(")+1,n.indexOf(")"));i.push({variable:r,pluralKey:o,countVariable:a})}t=e.indexOf(Jt,s)}return i}function Ie(e,i){[...e.querySelectorAll("[l10n]")].forEach(t=>{let s=t.getAttribute("l10n"),r="textContent";if(s.includes(":")){let o=s.split(":");r=o[0],s=o[1]}let n="l10n:"+s;i.__l10nKeys.push(n),i.add(n,s),i.sub(n,o=>{t[r]=i.l10n(o)}),t.removeAttribute("l10n")})}var Zt=()=>({"*blocksRegistry":new Set}),te=e=>({...Zt(),"*currentActivity":"","*currentActivityParams":{},"*history":[],"*historyBack":null,"*closeModal":()=>{e.set$({"*modalActive":!1,"*currentActivity":""})}}),Dt=e=>({...te(e),"*commonProgress":0,"*uploadList":[],"*outputData":null,"*focusedEntry":null,"*uploadMetadata":null});function W(e,i){let t,s=(...r)=>{clearTimeout(t),t=setTimeout(()=>e(...r),i)};return s.cancel=()=>{clearTimeout(t)},s}var ki="--uploadcare-blocks-window-height",kt="__UPLOADCARE_BLOCKS_WINDOW_HEIGHT_TRACKER_ENABLED__";function ee(){return typeof window[kt]=="undefined"?!1:!!window[kt]}function Oe(){if(ee())return;let e=()=>{document.documentElement.style.setProperty(ki,`${window.innerHeight}px`),window[kt]=!0},i=W(e,100);return window.addEventListener("resize",i,{passive:!0}),e(),()=>{window[kt]=!1,window.removeEventListener("resize",i)}}var De="lr-",R=class extends Yt{constructor(){super();c(this,"allowCustomTemplate",!0);c(this,"ctxInit",Zt());c(this,"init$",this.ctxInit);c(this,"updateCtxCssData",()=>{let t=this.$["*blocksRegistry"];for(let s of t)s.isConnected&&s.updateCssData()});this.activityType=null,this.addTemplateProcessor(Ie),this.__l10nKeys=[]}l10n(t,s={}){if(!t)return"";let r=this.getCssData("--l10n-"+t,!0)||t,n=Re(r);for(let a of n)s[a.variable]=this.pluralize(a.pluralKey,Number(s[a.countVariable]));return Qt(r,s)}pluralize(t,s){let r=this.l10n("locale-name")||"en-US",n=new Intl.PluralRules(r).select(s);return this.l10n(`${t}__${n}`)}applyL10nKey(t,s){let r="l10n:"+t;this.$[r]=s,this.__l10nKeys.push(t)}findBlockInCtx(t){let s=this.$["*blocksRegistry"];for(let r of s)if(t(r))return!0;return!1}setForCtxTarget(t,s,r){this.findBlockInCtx(n=>n.constructor.StateConsumerScope===t)&&(this.$[s]=r)}setActivity(t){if(this.findBlockInCtx(s=>s.activityType===t)){this.$["*currentActivity"]=t;return}console.warn(`Activity type "${t}" not found in the context`)}connectedCallback(){if(ee()||(this._destroyInnerHeightTracker=Oe()),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.isConnected&&this.__ctxOwner){let t=v.getCtx(this.ctxName,!1);t&&(t.store={...this.ctxInit})}super.connectedCallback()}disconnectedCallback(){var t;super.disconnectedCallback(),(t=this._destroyInnerHeightTracker)==null||t.call(this)}initCallback(){this.$["*blocksRegistry"].add(this)}destroyCallback(){this.$["*blocksRegistry"].delete(this)}fileSizeFmt(t,s=2){let r=["B","KB","MB","GB","TB"],n=u=>this.getCssData("--l10n-unit-"+u.toLowerCase(),!0)||u;if(t===0)return`0 ${n(r[0])}`;let o=1024,a=s<0?0:s,l=Math.floor(Math.log(t)/Math.log(o));return parseFloat((t/o**l).toFixed(a))+" "+n(r[l])}proxyUrl(t){let s=this.getCssData("--cfg-secure-delivery-proxy",!0);return s?Qt(s,{previewUrl:t},{transform:r=>window.encodeURIComponent(r)}):t}static reg(t){if(!t){super.reg();return}super.reg(t.startsWith(De)?t:De+t)}};c(R,"StateConsumerScope",null);var Ui="css-src",Ut=class extends R{constructor(){super(...arguments);c(this,"pauseRender",!0)}shadowReadyCallback(){}initCallback(){super.initCallback(),this.setAttribute("hidden","");let t=this.getAttribute(Ui);if(t){this.renderShadow=!0,this.attachShadow({mode:"open"});let s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href=t,s.onload=()=>{window.requestAnimationFrame(()=>{this.render(),window.setTimeout(()=>{this.removeAttribute("hidden"),this.shadowReadyCallback()})})},this.shadowRoot.prepend(s)}else this.render(),this.removeAttribute("hidden"),this.shadowReadyCallback()}};var Lt=class extends Ut{constructor(){super(...arguments);c(this,"ctxInit",Dt(this));c(this,"ctxOwner",!0);c(this,"_template",null)}static set template(t){this._template=t+"<slot></slot>"}static get template(){return this._template}};var ie=class extends R{constructor(){super(...arguments);c(this,"_handleBackdropClick",()=>{this._closeDialog()});c(this,"_closeDialog",()=>{this.setForCtxTarget(ie.StateConsumerScope,"*modalActive",!1)});c(this,"_handleDialogClose",()=>{this._closeDialog()});c(this,"_handleDialogClick",t=>{t.target===this.ref.dialog&&this._closeDialog()});c(this,"init$",{...this.ctxInit,"*modalActive":!1,isOpen:!1,closeClicked:this._handleDialogClose});c(this,"cssInit$",{"--cfg-modal-backdrop-strokes":0})}show(){this.ref.dialog.showModal?this.ref.dialog.showModal():this.ref.dialog.setAttribute("open","")}hide(){this.ref.dialog.close?this.ref.dialog.close():this.ref.dialog.removeAttribute("open")}initCallback(){if(super.initCallback(),typeof HTMLDialogElement=="function")this.ref.dialog.addEventListener("close",this._handleDialogClose),this.ref.dialog.addEventListener("click",this._handleDialogClick);else{this.setAttribute("dialog-fallback","");let t=document.createElement("div");t.className="backdrop",this.appendChild(t),t.addEventListener("click",this._handleBackdropClick)}this.sub("*modalActive",t=>{this.$.isOpen!==t&&(this.$.isOpen=t),t&&this.getCssData("--cfg-modal-scroll-lock")?document.body.style.overflow="hidden":document.body.style.overflow=null}),this.sub("--cfg-modal-backdrop-strokes",t=>{t?this.setAttribute("strokes",""):this.removeAttribute("strokes")}),this.sub("isOpen",t=>{t?this.show():this.hide()})}destroyCallback(){super.destroyCallback(),document.body.style.overflow=null,this.ref.dialog.removeEventListener("close",this._handleDialogClose),this.ref.dialog.removeEventListener("click",this._handleDialogClick)}},P=ie;c(P,"StateConsumerScope","modal");P.template=`<dialog ref="dialog"><slot></slot></dialog>`;var ke="active",vt="___ACTIVITY_IS_ACTIVE___",V=class extends R{constructor(){super(...arguments);c(this,"historyTracked",!1);c(this,"ctxInit",te(this));c(this,"_debouncedHistoryFlush",W(this._historyFlush.bind(this),10))}_deactivate(){var s;let t=V._activityRegistry[this.activityKey];this[vt]=!1,this.removeAttribute(ke),(s=t==null?void 0:t.deactivateCallback)==null||s.call(t)}_activate(){var s;let t=V._activityRegistry[this.activityKey];this.$["*historyBack"]=this.historyBack.bind(this),this[vt]=!0,this.setAttribute(ke,""),(s=t==null?void 0:t.activateCallback)==null||s.call(t),this._debouncedHistoryFlush()}initCallback(){super.initCallback(),this.hasAttribute("current-activity")&&this.sub("*currentActivity",t=>{this.setAttribute("current-activity",t)}),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",t=>{this.activityType!==t&&this[vt]?this._deactivate():this.activityType===t&&!this[vt]&&this._activate(),t||(this.$["*history"]=[])}))}_historyFlush(){let t=this.$["*history"];t&&(t.length>10&&(t=t.slice(t.length-11,t.length-1)),this.historyTracked&&t.push(this.activityType),this.$["*history"]=t)}_isActivityRegistered(){return this.activityType&&!!V._activityRegistry[this.activityKey]}get isActivityActive(){return this[vt]}registerActivity(t,s={}){let{onActivate:r,onDeactivate:n}=s;V._activityRegistry||(V._activityRegistry=Object.create(null)),V._activityRegistry[this.activityKey]={activateCallback:r,deactivateCallback:n}}unregisterActivity(){this.isActivityActive&&this._deactivate(),V._activityRegistry[this.activityKey]=void 0}destroyCallback(){super.destroyCallback(),this._isActivityRegistered()&&this.unregisterActivity(),Object.keys(V._activityRegistry).length===0&&(this.$["*currentActivity"]=null)}get activityKey(){return this.ctxName+this.activityType}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){let t=this.$["*history"];if(t){let s=t.pop();for(;s===this.activityType;)s=t.pop();this.$["*currentActivity"]=s,this.$["*history"]=t,s||this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!1)}}},T=V;c(T,"_activityRegistry",Object.create(null));T.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});var Tt=class extends Lt{constructor(){super(...arguments);c(this,"pauseRender",!0);c(this,"init$",{...this.ctxInit,selectClicked:()=>{this.ref.uBlock.openSystemDialog()}})}shadowReadyCallback(){let t=this.ref.uBlock;this.sub("*currentActivity",s=>{s||(this.$["*currentActivity"]=t.initActivity||T.activities.START_FROM)}),this.sub("*uploadList",s=>{(s==null?void 0:s.length)===0&&(this.$["*currentActivity"]=t.initActivity||T.activities.START_FROM)})}};Tt.template=`<lr-start-from><lr-drop-area clickable l10n="choose-file"></lr-drop-area><lr-copyright></lr-copyright></lr-start-from><lr-upload-list ref="uBlock"></lr-upload-list><lr-message-box></lr-message-box>`;var Pt=class extends T{constructor(){super(...arguments);c(this,"historyTracked",!0);c(this,"activityType","start-from")}initCallback(){super.initCallback(),this.registerActivity(this.activityType)}};var lt=(e,i=",")=>e.trim().split(i).map(t=>t.trim()).filter(t=>t.length>0);var ct=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],Nt=e=>e?e.filter(i=>typeof i=="string").map(i=>lt(i)).flat():[],se=(e,i)=>i.some(t=>t.endsWith("*")?(t=t.replace("*",""),e.startsWith(t)):e===t),Mt=e=>{let i=e==null?void 0:e.type;return i?se(i,ct):!1};function Ue(e){return Object.prototype.toString.call(e)==="[object Object]"}var Li=/\W|_/g;function Pi(e){return e.split(Li).map((i,t)=>i.charAt(0)[t>0?"toUpperCase":"toLowerCase"]()+i.slice(1)).join("")}function Le(e,{ignoreKeys:i}={ignoreKeys:[]}){return Array.isArray(e)?e.map(t=>q(t,{ignoreKeys:i})):e}function q(e,{ignoreKeys:i}={ignoreKeys:[]}){if(Array.isArray(e))return Le(e,{ignoreKeys:i});if(!Ue(e))return e;let t={};for(let s of Object.keys(e)){let r=e[s];if(i.includes(s)){t[s]=r;continue}Ue(r)?r=q(r,{ignoreKeys:i}):Array.isArray(r)&&(r=Le(r,{ignoreKeys:i})),t[Pi(s)]=r}return t}var Ni=e=>new Promise(i=>setTimeout(i,e));function ue({libraryName:e,libraryVersion:i,userAgent:t,publicKey:s="",integration:r=""}){let n="JavaScript";if(typeof t=="string")return t;if(typeof t=="function")return t({publicKey:s,libraryName:e,libraryVersion:i,languageName:n,integration:r});let o=[e,i,s].filter(Boolean).join("/"),a=[n,r].filter(Boolean).join("; ");return`${o} (${a})`}var Mi={factor:2,time:100};function $i(e,i=Mi){let t=0;function s(r){let n=Math.round(i.time*i.factor**t);return r({attempt:t,retry:a=>Ni(a!=null?a:n).then(()=>(t+=1,s(r)))})}return s(e)}var ft=class extends Error{constructor(t){super();c(this,"originalProgressEvent");this.name="UploadcareNetworkError",this.message="Network error",Object.setPrototypeOf(this,ft.prototype),this.originalProgressEvent=t}},Ft=(e,i)=>{e&&(e.aborted?Promise.resolve().then(i):e.addEventListener("abort",()=>i(),{once:!0}))},Y=class extends Error{constructor(t="Request canceled"){super(t);c(this,"isCancel",!0);Object.setPrototypeOf(this,Y.prototype)}},Fi=500,Me=({check:e,interval:i=Fi,timeout:t,signal:s})=>new Promise((r,n)=>{let o,a;Ft(s,()=>{o&&clearTimeout(o),n(new Y("Poll cancelled"))}),t&&(a=setTimeout(()=>{o&&clearTimeout(o),n(new Y("Timed out"))},t));let l=()=>{try{Promise.resolve(e(s)).then(u=>{u?(a&&clearTimeout(a),r(u)):o=setTimeout(l,i)}).catch(u=>{a&&clearTimeout(a),n(u)})}catch(u){a&&clearTimeout(a),n(u)}};o=setTimeout(l,0)}),y={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",maxContentLength:50*1024*1024,retryThrottledRequestMaxTimes:1,retryNetworkErrorMaxTimes:3,multipartMinFileSize:25*1024*1024,multipartChunkSize:5*1024*1024,multipartMinLastPartSize:1024*1024,maxConcurrentRequests:4,pollingTimeoutMilliseconds:1e4,pusherKey:"79ae88bd931ea68464d9"},Vt="application/octet-stream",$e="original",Q=({method:e,url:i,data:t,headers:s={},signal:r,onProgress:n})=>new Promise((o,a)=>{let l=new XMLHttpRequest,u=(e==null?void 0:e.toUpperCase())||"GET",h=!1;l.open(u,i,!0),s&&Object.entries(s).forEach(d=>{let[p,f]=d;typeof f!="undefined"&&!Array.isArray(f)&&l.setRequestHeader(p,f)}),l.responseType="text",Ft(r,()=>{h=!0,l.abort(),a(new Y)}),l.onload=()=>{if(l.status!=200)a(new Error(`Error ${l.status}: ${l.statusText}`));else{let d={method:u,url:i,data:t,headers:s||void 0,signal:r,onProgress:n},p=l.getAllResponseHeaders().trim().split(/[\r\n]+/),f={};p.forEach(function(E){let A=E.split(": "),b=A.shift(),m=A.join(": ");b&&typeof b!="undefined"&&(f[b]=m)});let _=l.response,C=l.status;o({request:d,data:_,headers:f,status:C})}},l.onerror=d=>{h||a(new ft(d))},n&&typeof n=="function"&&(l.upload.onprogress=d=>{d.lengthComputable?n({isComputable:!0,value:d.loaded/d.total}):n({isComputable:!1})}),t?l.send(t):l.send()});function Vi(e,...i){return e}var Bi=({name:e})=>e?[e]:[],ji=Vi,zi=()=>new FormData,Fe=e=>!1,Bt=e=>typeof Blob!="undefined"&&e instanceof Blob,jt=e=>typeof File!="undefined"&&e instanceof File,zt=e=>!!e&&typeof e=="object"&&!Array.isArray(e)&&"uri"in e&&typeof e.uri=="string",Et=e=>Bt(e)||jt(e)||Fe()||zt(e),Hi=e=>typeof e=="string"||typeof e=="number"||typeof e=="undefined",Xi=e=>!!e&&typeof e=="object"&&!Array.isArray(e),Wi=e=>!!e&&typeof e=="object"&&"data"in e&&Et(e.data);function Gi(e,i,t){if(Wi(t)){let{name:s,contentType:r}=t,n=ji(t.data,s,r!=null?r:Vt),o=Bi({name:s,contentType:r});e.push([i,n,...o])}else if(Xi(t))for(let[s,r]of Object.entries(t))typeof r!="undefined"&&e.push([`${i}[${s}]`,String(r)]);else Hi(t)&&t&&e.push([i,t.toString()])}function qi(e){let i=[];for(let[t,s]of Object.entries(e))Gi(i,t,s);return i}function he(e){let i=zi(),t=qi(e);for(let s of t){let[r,n,...o]=s;i.append(r,n,...o)}return i}var k=class extends Error{constructor(t,s,r,n,o){super();c(this,"isCancel");c(this,"code");c(this,"request");c(this,"response");c(this,"headers");this.name="UploadClientError",this.message=t,this.code=s,this.request=r,this.response=n,this.headers=o,Object.setPrototypeOf(this,k.prototype)}},Ki=e=>{let i=new URLSearchParams;for(let[t,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?Object.entries(s).filter(r=>{var n;return(n=r[1])!=null?n:!1}).forEach(r=>i.set(`${t}[${r[0]}]`,String(r[1]))):Array.isArray(s)?s.forEach(r=>{i.append(`${t}[]`,r)}):typeof s=="string"&&s?i.set(t,s):typeof s=="number"&&i.set(t,s.toString());return i.toString()},G=(e,i,t)=>{let s=new URL(e);return s.pathname=(s.pathname+i).replace("//","/"),t&&(s.search=Ki(t)),s.toString()},Yi="6.6.1",Ji="UploadcareUploadClient",Qi=Yi;function rt(e){return ue({libraryName:Ji,libraryVersion:Qi,...e})}var Zi="RequestThrottledError",Pe=15e3,ts=1e3;function es(e){let{headers:i}=e||{};if(!i||typeof i["retry-after"]!="string")return Pe;let t=parseInt(i["retry-after"],10);return Number.isFinite(t)?t*1e3:Pe}function Z(e,i){let{retryThrottledRequestMaxTimes:t,retryNetworkErrorMaxTimes:s}=i;return $i(({attempt:r,retry:n})=>e().catch(o=>{if("response"in o&&(o==null?void 0:o.code)===Zi&&r<t)return n(es(o));if(o instanceof ft&&r<s)return n((r+1)*ts);throw o}))}var Ve=e=>{let i="";return(Bt(e)||jt(e)||zt(e))&&(i=e.type),i||Vt},Be=e=>{let i="";return jt(e)&&e.name?i=e.name:Bt(e)||Fe()?i="":zt(e)&&e.name&&(i=e.name),i||$e};function de(e){return typeof e=="undefined"||e==="auto"?"auto":e?"1":"0"}function is(e,{publicKey:i,fileName:t,contentType:s,baseURL:r=y.baseURL,secureSignature:n,secureExpire:o,store:a,signal:l,onProgress:u,source:h="local",integration:d,userAgent:p,retryThrottledRequestMaxTimes:f=y.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:_=y.retryNetworkErrorMaxTimes,metadata:C}){return Z(()=>Q({method:"POST",url:G(r,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":rt({publicKey:i,integration:d,userAgent:p})},data:he({file:{data:e,name:t||Be(e),contentType:s||Ve(e)},UPLOADCARE_PUB_KEY:i,UPLOADCARE_STORE:de(a),signature:n,expire:o,source:h,metadata:C}),signal:l,onProgress:u}).then(({data:E,headers:A,request:b})=>{let m=q(JSON.parse(E));if("error"in m)throw new k(m.error.content,m.error.errorCode,b,m,A);return m}),{retryNetworkErrorMaxTimes:_,retryThrottledRequestMaxTimes:f})}var oe;(function(e){e.Token="token",e.FileInfo="file_info"})(oe||(oe={}));function ss(e,{publicKey:i,baseURL:t=y.baseURL,store:s,fileName:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,source:u="url",signal:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f=y.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:_=y.retryNetworkErrorMaxTimes,metadata:C}){return Z(()=>Q({method:"POST",headers:{"X-UC-User-Agent":rt({publicKey:i,integration:d,userAgent:p})},url:G(t,"/from_url/",{jsonerrors:1,pub_key:i,source_url:e,store:de(s),filename:r,check_URL_duplicates:n?1:void 0,save_URL_duplicates:o?1:void 0,signature:a,expire:l,source:u,metadata:C}),signal:h}).then(({data:E,headers:A,request:b})=>{let m=q(JSON.parse(E));if("error"in m)throw new k(m.error.content,m.error.errorCode,b,m,A);return m}),{retryNetworkErrorMaxTimes:_,retryThrottledRequestMaxTimes:f})}var N;(function(e){e.Unknown="unknown",e.Waiting="waiting",e.Progress="progress",e.Error="error",e.Success="success"})(N||(N={}));var rs=e=>"status"in e&&e.status===N.Error;function ns(e,{publicKey:i,baseURL:t=y.baseURL,signal:s,integration:r,userAgent:n,retryThrottledRequestMaxTimes:o=y.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=y.retryNetworkErrorMaxTimes}={}){return Z(()=>Q({method:"GET",headers:i?{"X-UC-User-Agent":rt({publicKey:i,integration:r,userAgent:n})}:void 0,url:G(t,"/from_url/status/",{jsonerrors:1,token:e}),signal:s}).then(({data:l,headers:u,request:h})=>{let d=q(JSON.parse(l));if("error"in d&&!rs(d))throw new k(d.error.content,void 0,h,d,u);return d}),{retryNetworkErrorMaxTimes:a,retryThrottledRequestMaxTimes:o})}function os(e,{publicKey:i,baseURL:t=y.baseURL,jsonpCallback:s,secureSignature:r,secureExpire:n,signal:o,source:a,integration:l,userAgent:u,retryThrottledRequestMaxTimes:h=y.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:d=y.retryNetworkErrorMaxTimes}){return Z(()=>Q({method:"POST",headers:{"X-UC-User-Agent":rt({publicKey:i,integration:l,userAgent:u})},url:G(t,"/group/",{jsonerrors:1,pub_key:i,files:e,callback:s,signature:r,expire:n,source:a}),signal:o}).then(({data:p,headers:f,request:_})=>{let C=q(JSON.parse(p));if("error"in C)throw new k(C.error.content,C.error.errorCode,_,C,f);return C}),{retryNetworkErrorMaxTimes:d,retryThrottledRequestMaxTimes:h})}function je(e,{publicKey:i,baseURL:t=y.baseURL,signal:s,source:r,integration:n,userAgent:o,retryThrottledRequestMaxTimes:a=y.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=y.retryNetworkErrorMaxTimes}){return Z(()=>Q({method:"GET",headers:{"X-UC-User-Agent":rt({publicKey:i,integration:n,userAgent:o})},url:G(t,"/info/",{jsonerrors:1,pub_key:i,file_id:e,source:r}),signal:s}).then(({data:u,headers:h,request:d})=>{let p=q(JSON.parse(u));if("error"in p)throw new k(p.error.content,p.error.errorCode,d,p,h);return p}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function as(e,{publicKey:i,contentType:t,fileName:s,multipartChunkSize:r=y.multipartChunkSize,baseURL:n="",secureSignature:o,secureExpire:a,store:l,signal:u,source:h="local",integration:d,userAgent:p,retryThrottledRequestMaxTimes:f=y.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:_=y.retryNetworkErrorMaxTimes,metadata:C}){return Z(()=>Q({method:"POST",url:G(n,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":rt({publicKey:i,integration:d,userAgent:p})},data:he({filename:s||$e,size:e,content_type:t||Vt,part_size:r,UPLOADCARE_STORE:de(l),UPLOADCARE_PUB_KEY:i,signature:o,expire:a,source:h,metadata:C}),signal:u}).then(({data:E,headers:A,request:b})=>{let m=q(JSON.parse(E));if("error"in m)throw new k(m.error.content,m.error.errorCode,b,m,A);return m.parts=Object.keys(m.parts).map(F=>m.parts[F]),m}),{retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:_})}function ls(e,i,{contentType:t,signal:s,onProgress:r,retryThrottledRequestMaxTimes:n=y.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:o=y.retryNetworkErrorMaxTimes}){return Z(()=>Q({method:"PUT",url:i,data:e,onProgress:r,signal:s,headers:{"Content-Type":t||Vt}}).then(a=>(r&&r({isComputable:!0,value:1}),a)).then(({status:a})=>({code:a})),{retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o})}function cs(e,{publicKey:i,baseURL:t=y.baseURL,source:s="local",signal:r,integration:n,userAgent:o,retryThrottledRequestMaxTimes:a=y.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=y.retryNetworkErrorMaxTimes}){return Z(()=>Q({method:"POST",url:G(t,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":rt({publicKey:i,integration:n,userAgent:o})},data:he({uuid:e,UPLOADCARE_PUB_KEY:i,source:s}),signal:r}).then(({data:u,headers:h,request:d})=>{let p=q(JSON.parse(u));if("error"in p)throw new k(p.error.content,p.error.errorCode,d,p,h);return p}),{retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})}function pe({file:e,publicKey:i,baseURL:t,source:s,integration:r,userAgent:n,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a,signal:l,onProgress:u}){return Me({check:h=>je(e,{publicKey:i,baseURL:t,signal:h,source:s,integration:r,userAgent:n,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a}).then(d=>d.isReady?d:(u&&u({isComputable:!0,value:1}),!1)),signal:l})}var J=class{constructor(i,{baseCDN:t=y.baseCDN,fileName:s}={}){c(this,"uuid");c(this,"name",null);c(this,"size",null);c(this,"isStored",null);c(this,"isImage",null);c(this,"mimeType",null);c(this,"cdnUrl",null);c(this,"s3Url",null);c(this,"originalFilename",null);c(this,"imageInfo",null);c(this,"videoInfo",null);c(this,"contentInfo",null);c(this,"metadata",null);c(this,"s3Bucket",null);let{uuid:r,s3Bucket:n}=i,o=G(t,`${r}/`),a=n?G(`https://${n}.s3.amazonaws.com/`,`${r}/${i.filename}`):null;this.uuid=r,this.name=s||i.filename,this.size=i.size,this.isStored=i.isStored,this.isImage=i.isImage,this.mimeType=i.mimeType,this.cdnUrl=o,this.originalFilename=i.originalFilename,this.imageInfo=i.imageInfo,this.videoInfo=i.videoInfo,this.contentInfo=i.contentInfo,this.metadata=i.metadata||null,this.s3Bucket=n||null,this.s3Url=a}},us=(e,{publicKey:i,fileName:t,baseURL:s,secureSignature:r,secureExpire:n,store:o,contentType:a,signal:l,onProgress:u,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:_,baseCDN:C,metadata:E})=>is(e,{publicKey:i,fileName:t,contentType:a,baseURL:s,secureSignature:r,secureExpire:n,store:o,signal:l,onProgress:u,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:_,metadata:E}).then(({file:A})=>pe({file:A,publicKey:i,baseURL:s,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:_,onProgress:u,signal:l})).then(A=>new J(A,{baseCDN:C})),hs=(e,{publicKey:i,fileName:t,baseURL:s,signal:r,onProgress:n,source:o,integration:a,userAgent:l,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:h,baseCDN:d})=>je(e,{publicKey:i,baseURL:s,signal:r,source:o,integration:a,userAgent:l,retryThrottledRequestMaxTimes:u,retryNetworkErrorMaxTimes:h}).then(p=>new J(p,{baseCDN:d,fileName:t})).then(p=>(n&&n({isComputable:!0,value:1}),p)),ds=(e,{signal:i}={})=>{let t=null,s=null,r=e.map(()=>new AbortController),n=o=>()=>{s=o,r.forEach((a,l)=>l!==o&&a.abort())};return Ft(i,()=>{r.forEach(o=>o.abort())}),Promise.all(e.map((o,a)=>{let l=n(a);return Promise.resolve().then(()=>o({stopRace:l,signal:r[a].signal})).then(u=>(l(),u)).catch(u=>(t=u,null))})).then(o=>{if(s===null)throw t;return o[s]})},ps=window.WebSocket,ae=class{constructor(){c(this,"events",Object.create({}))}emit(i,t){var s;(s=this.events[i])==null||s.forEach(r=>r(t))}on(i,t){this.events[i]=this.events[i]||[],this.events[i].push(t)}off(i,t){t?this.events[i]=this.events[i].filter(s=>s!==t):this.events[i]=[]}},fs=(e,i)=>e==="success"?{status:N.Success,...i}:e==="progress"?{status:N.Progress,...i}:{status:N.Error,...i},le=class{constructor(i,t=3e4){c(this,"key");c(this,"disconnectTime");c(this,"ws");c(this,"queue",[]);c(this,"isConnected",!1);c(this,"subscribers",0);c(this,"emmitter",new ae);c(this,"disconnectTimeoutId",null);this.key=i,this.disconnectTime=t}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){let i=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new ps(i),this.ws.addEventListener("error",t=>{this.emmitter.emit("error",new Error(t.message))}),this.emmitter.on("connected",()=>{this.isConnected=!0,this.queue.forEach(t=>this.send(t.event,t.data)),this.queue=[]}),this.ws.addEventListener("message",t=>{let s=JSON.parse(t.data.toString());switch(s.event){case"pusher:connection_established":{this.emmitter.emit("connected",void 0);break}case"pusher:ping":{this.send("pusher:pong",{});break}case"progress":case"success":case"fail":this.emmitter.emit(s.channel,fs(s.event,JSON.parse(s.data)))}})}}disconnect(){let i=()=>{var t;(t=this.ws)==null||t.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout(()=>{i()},this.disconnectTime):i()}send(i,t){var r;let s=JSON.stringify({event:i,data:t});(r=this.ws)==null||r.send(s)}subscribe(i,t){this.subscribers+=1,this.connect();let s=`task-status-${i}`,r={event:"pusher:subscribe",data:{channel:s}};this.emmitter.on(s,t),this.isConnected?this.send(r.event,r.data):this.queue.push(r)}unsubscribe(i){this.subscribers-=1;let t=`task-status-${i}`,s={event:"pusher:unsubscribe",data:{channel:t}};this.emmitter.off(t),this.isConnected?this.send(s.event,s.data):this.queue=this.queue.filter(r=>r.data.channel!==t),this.subscribers===0&&this.disconnect()}onError(i){return this.emmitter.on("error",i),()=>this.emmitter.off("error",i)}},re=null,fe=e=>{if(!re){let i=typeof window=="undefined"?0:3e4;re=new le(e,i)}return re},ms=e=>{fe(e).connect()};function gs({token:e,publicKey:i,baseURL:t,integration:s,userAgent:r,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o,onProgress:a,signal:l}){return Me({check:u=>ns(e,{publicKey:i,baseURL:t,integration:s,userAgent:r,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:o,signal:u}).then(h=>{switch(h.status){case N.Error:return new k(h.error,h.errorCode);case N.Waiting:return!1;case N.Unknown:return new k(`Token "${e}" was not found.`);case N.Progress:return a&&(h.total==="unknown"?a({isComputable:!1}):a({isComputable:!0,value:h.done/h.total})),!1;case N.Success:return a&&a({isComputable:!0,value:h.done/h.total}),h;default:throw new Error("Unknown status")}}),signal:l})}var _s=({token:e,pusherKey:i,signal:t,onProgress:s})=>new Promise((r,n)=>{let o=fe(i),a=o.onError(n),l=()=>{a(),o.unsubscribe(e)};Ft(t,()=>{l(),n(new Y("pusher cancelled"))}),o.subscribe(e,u=>{switch(u.status){case N.Progress:{s&&(u.total==="unknown"?s({isComputable:!1}):s({isComputable:!0,value:u.done/u.total}));break}case N.Success:{l(),s&&s({isComputable:!0,value:u.done/u.total}),r(u);break}case N.Error:l(),n(new k(u.msg,u.error_code))}})}),bs=(e,{publicKey:i,fileName:t,baseURL:s,baseCDN:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,store:u,signal:h,onProgress:d,source:p,integration:f,userAgent:_,retryThrottledRequestMaxTimes:C,pusherKey:E=y.pusherKey,metadata:A})=>Promise.resolve(ms(E)).then(()=>ss(e,{publicKey:i,fileName:t,baseURL:s,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:o,secureSignature:a,secureExpire:l,store:u,signal:h,source:p,integration:f,userAgent:_,retryThrottledRequestMaxTimes:C,metadata:A})).catch(b=>{let m=fe(E);return m==null||m.disconnect(),Promise.reject(b)}).then(b=>b.type===oe.FileInfo?b:ds([({signal:m})=>gs({token:b.token,publicKey:i,baseURL:s,integration:f,userAgent:_,retryThrottledRequestMaxTimes:C,onProgress:d,signal:m}),({signal:m})=>_s({token:b.token,pusherKey:E,signal:m,onProgress:d})],{signal:h})).then(b=>{if(b instanceof k)throw b;return b}).then(b=>pe({file:b.uuid,publicKey:i,baseURL:s,integration:f,userAgent:_,retryThrottledRequestMaxTimes:C,onProgress:d,signal:h})).then(b=>new J(b,{baseCDN:r})),ne=new WeakMap,ys=async e=>{if(ne.has(e))return ne.get(e);let i=await fetch(e.uri).then(t=>t.blob());return ne.set(e,i),i},ze=async e=>{if(jt(e)||Bt(e))return e.size;if(zt(e))return(await ys(e)).size;throw new Error("Unknown file type. Cannot determine file size.")},Cs=(e,i=y.multipartMinFileSize)=>e>=i,He=e=>{let i="[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}",t=new RegExp(i);return!Et(e)&&t.test(e)},Xe=e=>{let i="^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$",t=new RegExp(i);return!Et(e)&&t.test(e)},vs=(e,i)=>new Promise((t,s)=>{let r=[],n=!1,o=i.length,a=[...i],l=()=>{let u=i.length-a.length,h=a.shift();h&&h().then(d=>{n||(r[u]=d,o-=1,o?l():t(r))}).catch(d=>{n=!0,s(d)})};for(let u=0;u<e;u++)l()}),Ts=(e,i,t,s)=>{let r=s*i,n=Math.min(r+s,t);return e.slice(r,n)},Es=async(e,i,t)=>s=>Ts(e,s,i,t),As=(e,i,{publicKey:t,contentType:s,onProgress:r,signal:n,integration:o,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l})=>ls(e,i,{publicKey:t,contentType:s,onProgress:r,signal:n,integration:o,retryThrottledRequestMaxTimes:a,retryNetworkErrorMaxTimes:l}),ws=async(e,{publicKey:i,fileName:t,fileSize:s,baseURL:r,secureSignature:n,secureExpire:o,store:a,signal:l,onProgress:u,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:_,contentType:C,multipartChunkSize:E=y.multipartChunkSize,maxConcurrentRequests:A=y.maxConcurrentRequests,baseCDN:b,metadata:m})=>{let F=s!=null?s:await ze(e),j,tt=(S,$)=>{if(!u)return;j||(j=Array(S).fill(0));let z=L=>L.reduce((H,Wt)=>H+Wt,0);return L=>{L.isComputable&&(j[$]=L.value,u({isComputable:!0,value:z(j)/S}))}};return C||(C=Ve(e)),as(F,{publicKey:i,contentType:C,fileName:t||Be(e),baseURL:r,secureSignature:n,secureExpire:o,store:a,signal:l,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:_,metadata:m}).then(async({uuid:S,parts:$})=>{let z=await Es(e,F,E);return Promise.all([S,vs(A,$.map((L,H)=>()=>As(z(H),L,{publicKey:i,contentType:C,onProgress:tt($.length,H),signal:l,integration:d,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:_})))])}).then(([S])=>cs(S,{publicKey:i,baseURL:r,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:_})).then(S=>S.isReady?S:pe({file:S.uuid,publicKey:i,baseURL:r,source:h,integration:d,userAgent:p,retryThrottledRequestMaxTimes:f,retryNetworkErrorMaxTimes:_,onProgress:u,signal:l})).then(S=>new J(S,{baseCDN:b}))};async function me(e,{publicKey:i,fileName:t,baseURL:s=y.baseURL,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:u,integration:h,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:f,contentType:_,multipartMinFileSize:C,multipartChunkSize:E,maxConcurrentRequests:A,baseCDN:b=y.baseCDN,checkForUrlDuplicates:m,saveUrlForRecurrentUploads:F,pusherKey:j,metadata:tt}){if(Et(e)){let S=await ze(e);return Cs(S,C)?ws(e,{publicKey:i,contentType:_,multipartChunkSize:E,fileSize:S,fileName:t,baseURL:s,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:u,integration:h,userAgent:d,maxConcurrentRequests:A,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:f,baseCDN:b,metadata:tt}):us(e,{publicKey:i,fileName:t,contentType:_,baseURL:s,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:u,integration:h,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:f,baseCDN:b,metadata:tt})}if(Xe(e))return bs(e,{publicKey:i,fileName:t,baseURL:s,baseCDN:b,checkForUrlDuplicates:m,saveUrlForRecurrentUploads:F,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:u,integration:h,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:f,pusherKey:j,metadata:tt});if(He(e))return hs(e,{publicKey:i,fileName:t,baseURL:s,signal:a,onProgress:l,source:u,integration:h,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:f,baseCDN:b});throw new TypeError(`File uploading from "${e}" is not supported`)}var ce=class{constructor(i,t){c(this,"uuid");c(this,"filesCount");c(this,"totalSize");c(this,"isStored");c(this,"isImage");c(this,"cdnUrl");c(this,"files");c(this,"createdAt");c(this,"storedAt",null);this.uuid=i.id,this.filesCount=i.filesCount,this.totalSize=Object.values(i.files).reduce((s,r)=>s+r.size,0),this.isStored=!!i.datetimeStored,this.isImage=!!Object.values(i.files).filter(s=>s.isImage).length,this.cdnUrl=i.cdnUrl,this.files=t,this.createdAt=i.datetimeCreated,this.storedAt=i.datetimeStored}},xs=e=>{for(let i of e)if(!Et(i))return!1;return!0},Ss=e=>{for(let i of e)if(!He(i))return!1;return!0},Rs=e=>{for(let i of e)if(!Xe(i))return!1;return!0};function We(e,{publicKey:i,fileName:t,baseURL:s=y.baseURL,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:l,source:u,integration:h,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:f,contentType:_,multipartChunkSize:C=y.multipartChunkSize,baseCDN:E=y.baseCDN,checkForUrlDuplicates:A,saveUrlForRecurrentUploads:b,jsonpCallback:m}){if(!xs(e)&&!Rs(e)&&!Ss(e))throw new TypeError(`Group uploading from "${e}" is not supported`);let F,j=!0,tt=e.length,S=($,z)=>{if(!l)return;F||(F=Array($).fill(0));let L=H=>H.reduce((Wt,ai)=>Wt+ai)/$;return H=>{if(!H.isComputable||!j){j=!1,l({isComputable:!1});return}F[z]=H.value,l({isComputable:!0,value:L(F)})}};return Promise.all(e.map(($,z)=>me($,{publicKey:i,fileName:t,baseURL:s,secureSignature:r,secureExpire:n,store:o,signal:a,onProgress:S(tt,z),source:u,integration:h,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:f,contentType:_,multipartChunkSize:C,baseCDN:E,checkForUrlDuplicates:A,saveUrlForRecurrentUploads:b}))).then($=>{let z=$.map(L=>L.uuid);return os(z,{publicKey:i,baseURL:s,jsonpCallback:m,secureSignature:r,secureExpire:n,signal:a,source:u,integration:h,userAgent:d,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:f}).then(L=>new ce(L,$)).then(L=>(l&&l({isComputable:!0,value:1}),L))})}var it,ut,st,ht,dt,pt,$t,Ne=class{constructor(i){et(this,pt);et(this,it,1);et(this,ut,[]);et(this,st,0);et(this,ht,new WeakMap);et(this,dt,new WeakMap);bt(this,it,i)}add(i){return new Promise((t,s)=>{I(this,ht).set(i,t),I(this,dt).set(i,s),I(this,ut).push(i),Rt(this,pt,$t).call(this)})}get pending(){return I(this,ut).length}get running(){return I(this,st)}set concurrency(i){bt(this,it,i),Rt(this,pt,$t).call(this)}get concurrency(){return I(this,it)}};it=new WeakMap,ut=new WeakMap,st=new WeakMap,ht=new WeakMap,dt=new WeakMap,pt=new WeakSet,$t=function(){let i=I(this,it)-I(this,st);for(let t=0;t<i;t++){let s=I(this,ut).shift();if(!s)return;let r=I(this,ht).get(s),n=I(this,dt).get(s);if(!r||!n)throw new Error("Unexpected behavior: resolver or rejector is undefined");bt(this,st,I(this,st)+1),s().finally(()=>{I(this,ht).delete(s),I(this,dt).delete(s),bt(this,st,I(this,st)-1),Rt(this,pt,$t).call(this)}).then(o=>r(o)).catch(o=>n(o))}};var Ge=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null,nullable:!0},fileSize:{type:Number,value:null},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null},uploadError:{type:Error,value:null,nullable:!0},validationErrorMsg:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},cdnUrl:{type:String,value:null},cdnUrlModifiers:{type:String,value:null},fileInfo:{type:J,value:null},isUploading:{type:Boolean,value:!1},abortController:{type:AbortController,value:null,nullable:!0},thumbUrl:{type:String,value:null,nullable:!0}});var qe="blocks",Ke="0.21.7";function Ye(e){return ue({...e,libraryName:qe,libraryVersion:Ke})}var Je="[Typed State] Wrong property name: ",Is="[Typed State] Wrong property type: ",Ht=class{constructor(i,t){this.__typedSchema=i,this.__ctxId=t||Ct.generate(),this.__schema=Object.keys(i).reduce((s,r)=>(s[r]=i[r].value,s),{}),this.__data=v.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(i,t){if(!this.__typedSchema.hasOwnProperty(i)){console.warn(Je+i);return}let s=this.__typedSchema[i];if((t==null?void 0:t.constructor)===s.type||t instanceof s.type||s.nullable&&t===null){this.__data.pub(i,t);return}console.warn(Is+i)}setMultipleValues(i){for(let t in i)this.setValue(t,i[t])}getValue(i){if(!this.__typedSchema.hasOwnProperty(i)){console.warn(Je+i);return}return this.__data.read(i)}subscribe(i,t){return this.__data.sub(i,t)}remove(){v.deleteCtx(this.__ctxId)}};var Xt=class{constructor(i){this.__typedSchema=i.typedSchema,this.__ctxId=i.ctxName||Ct.generate(),this.__data=v.registerCtx({},this.__ctxId),this.__watchList=i.watchList||[],this.__handler=i.handler||null,this.__subsMap=Object.create(null),this.__observers=new Set,this.__items=new Set,this.__removed=new Set,this.__added=new Set;let t=Object.create(null);this.__notifyObservers=(s,r)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),t[s]||(t[s]=new Set),t[s].add(r),this.__observeTimeout=window.setTimeout(()=>{this.__observers.forEach(n=>{n({...t})}),t=Object.create(null)})}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{var s;let i=this.__added,t=this.__removed;this.__added.clear(),this.__removed.clear(),(s=this.__handler)==null||s.call(this,[...this.__items],i,t)})}add(i){let t=new Ht(this.__typedSchema);for(let s in i)t.setValue(s,i[s]);return this.__data.add(t.uid,t),this.__added.add(t),this.__watchList.forEach(s=>{this.__subsMap[t.uid]||(this.__subsMap[t.uid]=[]),this.__subsMap[t.uid].push(t.subscribe(s,()=>{this.__notifyObservers(s,t.uid)}))}),this.__items.add(t.uid),this.notify(),t}read(i){return this.__data.read(i)}readProp(i,t){return this.read(i).getValue(t)}publishProp(i,t,s){this.read(i).setValue(t,s)}remove(i){this.__removed.add(this.__data.read(i)),this.__items.delete(i),this.notify(),this.__data.pub(i,null),delete this.__subsMap[i]}clearAll(){this.__items.forEach(i=>{this.remove(i)})}observe(i){this.__observers.add(i)}unobserve(i){this.__observers.delete(i)}findItems(i){let t=[];return this.__items.forEach(s=>{let r=this.read(s);i(r)&&t.push(s)}),t}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){v.deleteCtx(this.__data),this.__observers=null;for(let i in this.__subsMap)this.__subsMap[i].forEach(t=>{t.remove()}),delete this.__subsMap[i]}};var x={UPLOAD_START:"UPLOAD_START",REMOVE:"REMOVE",UPLOAD_PROGRESS:"UPLOAD_PROGRESS",UPLOAD_FINISH:"UPLOAD_FINISH",UPLOAD_ERROR:"UPLOAD_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",CDN_MODIFICATION:"CLOUD_MODIFICATION",DATA_OUTPUT:"DATA_OUTPUT",DONE_FLOW:"DONE_FLOW",INIT_FLOW:"INIT_FLOW"},O=class{constructor(i){this.ctx=i.ctx,this.type=i.type,this.data=i.data}},w=class{static eName(i){return"LR_"+i}static emit(i,t=window,s=!0){let r=()=>{t.dispatchEvent(new CustomEvent(this.eName(i.type),{detail:i}))};if(!s){r();return}let n=i.type+i.ctx;this._timeoutStore[n]&&window.clearTimeout(this._timeoutStore[n]),this._timeoutStore[n]=window.setTimeout(()=>{r(),delete this._timeoutStore[n]},20)}};c(w,"_timeoutStore",Object.create(null));var D=class extends T{constructor(){super(...arguments);c(this,"ctxInit",Dt(this));c(this,"__initialUploadMetadata",null);c(this,"_handleCollectionUpdate",t=>{let s=this.uploadCollection;if(t.uploadProgress){let r=0,n=s.findItems(a=>!a.getValue("uploadError"));n.forEach(a=>{r+=s.readProp(a,"uploadProgress")});let o=Math.round(r/n.length);this.$["*commonProgress"]=o,w.emit(new O({type:x.UPLOAD_PROGRESS,ctx:this.ctxName,data:o}),void 0,o===100)}if(t.uuid){let r=s.findItems(o=>!!o.getValue("uuid")),n=s.findItems(o=>!!o.getValue("uploadError")||!!o.getValue("validationErrorMsg"));if(s.size-n.length===r.length){let o=this.getOutputData(a=>!!a.getValue("uuid"));w.emit(new O({type:x.UPLOAD_FINISH,ctx:this.ctxName,data:o}))}}t.uploadError&&s.findItems(n=>!!n.getValue("uploadError")).forEach(n=>{w.emit(new O({type:x.UPLOAD_ERROR,ctx:this.ctxName,data:s.readProp(n,"uploadError")}),void 0,!1)}),t.validationErrorMsg&&s.findItems(n=>!!n.getValue("validationErrorMsg")).forEach(n=>{w.emit(new O({type:x.VALIDATION_ERROR,ctx:this.ctxName,data:s.readProp(n,"validationErrorMsg")}),void 0,!1)}),t.cdnUrlModifiers&&s.findItems(n=>!!n.getValue("cdnUrlModifiers")).forEach(n=>{w.emit(new O({type:x.CDN_MODIFICATION,ctx:this.ctxName,data:v.getCtx(n).store}),void 0,!1)})})}setUploadMetadata(t){this.connectedOnce?this.$["*uploadMetadata"]=t:this.__initialUploadMetadata=t}initCallback(){super.initCallback(),this.__initialUploadMetadata&&(this.$["*uploadMetadata"]=this.__initialUploadMetadata)}destroyCallback(){super.destroyCallback();let t=this.$["*blocksRegistry"];t.has(this)&&(this.uploadCollection.unobserve(this._handleCollectionUpdate),t.delete(this))}addFiles(t){t.forEach(s=>{this.uploadCollection.add({file:s,isImage:Mt(s),mimeType:s.type,fileName:s.name,fileSize:s.size})})}openSystemDialog(t={}){let s=Nt([this.getCssData("--cfg-accept"),...this.getCssData("--cfg-img-only")?ct:[]]).join(",");this.getCssData("--cfg-accept")&&this.getCssData("--cfg-img-only")&&console.warn("There could be a mistake.\nBoth `--cfg-accept` and `--cfg-img-only` parameters are set.\nThe value of `--cfg-accept` will be concatenated with the internal image mime types list."),this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=!!this.getCssData("--cfg-multiple"),t.captureCamera?(this.fileInput.capture="",this.fileInput.accept=ct.join(",")):this.fileInput.accept=s,this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{this.addFiles([...this.fileInput.files]),this.$["*currentActivity"]=T.activities.UPLOAD_LIST,this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!0),this.fileInput.value="",this.fileInput=null}}get sourceList(){let t=null;return this.getCssData("--cfg-source-list")&&(t=lt(this.getCssData("--cfg-source-list"))),t}initFlow(t=!1){var s,r;if((s=this.$["*uploadList"])!=null&&s.length&&!t)this.set$({"*currentActivity":T.activities.UPLOAD_LIST}),this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!0);else if(((r=this.sourceList)==null?void 0:r.length)===1){let n=this.sourceList[0];n==="local"?(this.$["*currentActivity"]=T.activities.UPLOAD_LIST,this==null||this.openSystemDialog()):(Object.values(D.extSrcList).includes(n)?this.set$({"*currentActivityParams":{externalSourceType:n},"*currentActivity":T.activities.EXTERNAL}):this.$["*currentActivity"]=n,this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!0))}else this.set$({"*currentActivity":T.activities.START_FROM}),this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!0);w.emit(new O({type:x.INIT_FLOW,ctx:this.ctxName}),void 0,!1)}doneFlow(){this.set$({"*currentActivity":this.doneActivity,"*history":this.doneActivity?[this.doneActivity]:[]}),this.$["*currentActivity"]||this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!1),w.emit(new O({type:x.DONE_FLOW,ctx:this.ctxName}),void 0,!1)}get uploadCollection(){if(!this.has("*uploadCollection")){let t=new Xt({typedSchema:Ge,watchList:["uploadProgress","uuid","uploadError","validationErrorMsg","cdnUrlModifiers"],handler:(s,r,n)=>{var o;for(let a of n)(o=a==null?void 0:a.getValue("abortController"))==null||o.abort(),a==null||a.setValue("abortController",null),URL.revokeObjectURL(a==null?void 0:a.getValue("thumbUrl"));this.$["*uploadList"]=s.map(a=>({uid:a}))}});t.observe(this._handleCollectionUpdate),this.add("*uploadCollection",t)}return this.$["*uploadCollection"]}getUploadClientOptions(){let t=this.getCssData("--cfg-store",!0),s={store:t===null?void 0:!!t,publicKey:this.getCssData("--cfg-pubkey"),baseCDN:this.getCssData("--cfg-cdn-cname"),baseURL:this.getCssData("--cfg-base-url"),userAgent:Ye,integration:this.getCssData("--cfg-user-agent-integration"),secureSignature:this.getCssData("--cfg-secure-signature"),secureExpire:this.getCssData("--cfg-secure-expire"),retryThrottledRequestMaxTimes:this.getCssData("--cfg-retry-throttled-request-max-times"),multipartMinFileSize:this.getCssData("--cfg-multipart-min-file-size"),multipartChunkSize:this.getCssData("--cfg-multipart-chunk-size"),maxConcurrentRequests:this.getCssData("--cfg-max-concurrent-requests"),multipartMaxAttempts:this.getCssData("--cfg-multipart-max-attempts"),checkForUrlDuplicates:!!this.getCssData("--cfg-check-for-url-duplicates"),saveUrlForRecurrentUploads:!!this.getCssData("--cfg-save-url-for-recurrent-uploads"),metadata:this.$["*uploadMetadata"]};return console.log("Upload client options:",s),s}getOutputData(t){let s=[];return this.uploadCollection.findItems(t).forEach(n=>{let o=v.getCtx(n).store,a=o.fileInfo||{name:o.fileName,fileSize:o.fileSize,isImage:o.isImage,mimeType:o.mimeType},l={...a,cdnUrlModifiers:o.cdnUrlModifiers,cdnUrl:o.cdnUrl||a.cdnUrl};s.push(l)}),s}};D.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"});D.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...D.extSrcList});Object.values(x).forEach(e=>{let i=w.eName(e);window.addEventListener(i,t=>{if([x.UPLOAD_FINISH,x.REMOVE,x.CDN_MODIFICATION].includes(t.detail.type)){let r=v.getCtx(t.detail.ctx),n=r.read("uploadCollection"),o=[];n.items().forEach(a=>{let l=v.getCtx(a).store,u=l.fileInfo;if(u){let h={...u,cdnUrlModifiers:l.cdnUrlModifiers,cdnUrl:l.cdnUrl||u.cdnUrl};o.push(h)}}),w.emit(new O({type:x.DATA_OUTPUT,ctx:t.detail.ctx,data:o})),r.pub("outputData",o)}})});function Os(e){return new Promise(i=>{typeof window.FileReader!="function"&&i(!1);try{let t=new FileReader;t.onerror=()=>{i(!0)};let s=r=>{r.type!=="loadend"&&t.abort(),i(!1)};t.onloadend=s,t.onprogress=s,t.readAsDataURL(e)}catch{i(!1)}})}function Ds(e){return new Promise(i=>{let t=0,s=[],r=o=>{o||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),i(null)),o.isFile?(t++,o.file(a=>{t--,s.push(a),t===0&&i(s)})):o.isDirectory&&n(o.createReader())},n=o=>{t++,o.readEntries(a=>{t--;for(let l of a)r(l);t===0&&i(s)})};r(e)})}function Qe(e){let i=[],t=[];for(let s=0;s<e.items.length;s++){let r=e.items[s];if(r)if(r.kind==="file"){if(typeof r.webkitGetAsEntry=="function"||typeof r.getAsEntry=="function"){let o=typeof r.webkitGetAsEntry=="function"?r.webkitGetAsEntry():r.getAsEntry();t.push(Ds(o).then(a=>{i.push(...a)}));continue}let n=r.getAsFile();t.push(Os(n).then(o=>{o||i.push(n)}))}else r.kind==="string"&&r.type.match("^text/uri-list")&&t.push(new Promise(n=>{r.getAsString(o=>{i.push(o),n()})}))}return Promise.all(t).then(()=>i)}var U={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3},Ze=["focus"],ks=100,ge=new Map;function Us(e,i){let t=Math.max(Math.min(e[0],i.x+i.width),i.x),s=Math.max(Math.min(e[1],i.y+i.height),i.y);return Math.sqrt((e[0]-t)*(e[0]-t)+(e[1]-s)*(e[1]-s))}function _e(e){let i=0,t=document.body,s=new Set,r=f=>s.add(f),n=U.INACTIVE,o=f=>{e.shouldIgnore()&&f!==U.INACTIVE||(n!==f&&s.forEach(_=>_(f)),n=f)};r(f=>e.onChange(f));let a=()=>{i=0,o(U.INACTIVE)},l=()=>{i+=1,n===U.INACTIVE&&o(U.ACTIVE)},u=()=>{i-=1,i>0||o(U.INACTIVE)},h=f=>{f.preventDefault(),i=0,o(U.INACTIVE)},d=f=>{f.preventDefault();let _=[f.x,f.y],C=e.element.getBoundingClientRect(),E=Math.floor(Us(_,C)),A=E<ks,b=f.composedPath().includes(e.element);ge.set(e.element,E);let m=Math.min(...ge.values())===E;o(b&&m?U.OVER:A&&m?U.NEAR:U.ACTIVE)},p=async f=>{if(e.shouldIgnore())return;f.preventDefault();let _=await Qe(f.dataTransfer);e.onItems(_),o(U.INACTIVE)};return t.addEventListener("drop",h),t.addEventListener("dragleave",u),t.addEventListener("dragenter",l),t.addEventListener("dragover",d),e.element.addEventListener("drop",p),Ze.forEach(f=>{window.addEventListener(f,a)}),()=>{ge.delete(e.element),t.removeEventListener("drop",h),t.removeEventListener("dragleave",u),t.removeEventListener("dragenter",l),t.removeEventListener("dragover",d),e.element.removeEventListener("drop",p),Ze.forEach(f=>{window.removeEventListener(f,a)})}}var mt=class extends D{constructor(){super(...arguments);c(this,"init$",{...this.ctxInit,state:U.INACTIVE,withIcon:!1,isClickable:!1,isFullscreen:!1,isDisabled:!1,isHidden:!1,text:this.l10n("drop-files-here"),"lr-drop-area/targets":null});c(this,"cssInit$",{"--cfg-source-list":""})}isActive(){if(!this.$.isDisabled)return!1;let t=this.getBoundingClientRect(),s=t.width>0&&t.height>0,r=t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth),n=window.getComputedStyle(this),o=n.visibility!=="hidden"&&n.display!=="none";return s&&o&&r}initCallback(){super.initCallback(),this.$["lr-drop-area/targets"]||(this.$["lr-drop-area/targets"]=new Set),this.$["lr-drop-area/targets"].add(this),this.defineAccessor("disabled",s=>{this.set$({isDisabled:typeof s=="string"})}),this.defineAccessor("clickable",s=>{this.set$({isClickable:typeof s=="string"})}),this.defineAccessor("with-icon",s=>{this.set$({withIcon:typeof s=="string"})}),this.defineAccessor("fullscreen",s=>{this.set$({isFullscreen:typeof s=="string"})}),this.defineAccessor("text",s=>{s?this.set$({text:this.l10n(s)||s}):this.set$({text:this.l10n("drop-files-here")})}),this._destroyDropzone=_e({element:this,shouldIgnore:()=>this._shouldIgnore(),onChange:s=>{this.$.state=s},onItems:s=>{debugger;if(!s.length)return;let r=this.getCssData("--cfg-multiple"),n=this.getCssData("--cfg-multiple-max"),o=this.uploadCollection.size;r&&n?s=s.slice(0,n-o-1):r||(s=s.slice(0,o>0?0:1)),s.forEach(a=>{if(typeof a=="string"){this.uploadCollection.add({externalUrl:a});return}let l=Mt(a);this.uploadCollection.add({file:a,isImage:l,mimeType:a.type,fileName:a.name,fileSize:a.size})}),this.uploadCollection.size&&(this.set$({"*currentActivity":T.activities.UPLOAD_LIST}),this.setForCtxTarget(P.StateConsumerScope,"*modalActive",!0))}});let t=this.ref["content-wrapper"];t&&(this._destroyContentWrapperDropzone=_e({element:t,onChange:s=>{var n;let r=(n=Object.entries(U).find(([,o])=>o===s))==null?void 0:n[0].toLowerCase();r&&t.setAttribute("drag-state",r)},onItems:()=>{},shouldIgnore:()=>this._shouldIgnore()})),this.sub("state",s=>{var n;let r=(n=Object.entries(U).find(([,o])=>o===s))==null?void 0:n[0].toLowerCase();r&&this.setAttribute("drag-state",r)}),this.sub("--cfg-source-list",s=>{let r=lt(s);this.$.isDisabled=!r.includes(D.sourceTypes.LOCAL),this.$.isHidden=this.$.isDisabled&&!!this.querySelector("[data-default-slot]")}),this.sub("isHidden",s=>{this.toggleAttribute("hidden",s)}),this.$.isClickable&&(this._onAreaClicked=()=>{this.openSystemDialog()},this.addEventListener("click",this._onAreaClicked))}_shouldIgnore(){return this.$.isDisabled||!this._couldHandleFiles()?!0:this.$.isFullscreen?[...this.$["lr-drop-area/targets"]].filter(r=>r!==this).filter(r=>r.isActive()).length>0:!1}_couldHandleFiles(){let t=this.getCssData("--cfg-multiple"),s=this.getCssData("--cfg-multiple-max"),r=this.uploadCollection.size;return!(t&&s&&r>=s||!t&&r>0)}destroyCallback(){var t,s,r,n;super.destroyCallback(),(s=(t=this.$["lr-drop-area/targets"])==null?void 0:t.remove)==null||s.call(t,this),(r=this._destroyDropzone)==null||r.call(this),(n=this._destroyContentWrapperDropzone)==null||n.call(this),this._onAreaClicked&&this.removeEventListener("click",this._onAreaClicked)}};mt.template=`<slot><div data-default-slot hidden></div><div ref="content-wrapper" class="content-wrapper" set="@hidden: isHidden"><div class="icon-container" set="@hidden: !withIcon"><lr-icon name="default"></lr-icon><lr-icon name="arrow-down"></lr-icon></div><span class="text">{{text}}</span></div></slot>`;mt.bindAttributes({"with-icon":null,clickable:null,text:null,fullscreen:null,disabled:null});var gt=class{constructor(){c(this,"caption","");c(this,"text","");c(this,"iconName","");c(this,"isError",!1)}},At=class extends R{constructor(){super(...arguments);c(this,"init$",{...this.ctxInit,iconName:"info",captionTxt:"Message caption",msgTxt:"Message...","*message":null,onClose:()=>{this.$["*message"]=null}})}initCallback(){super.initCallback(),this.sub("*message",t=>{t?(this.setAttribute("active",""),this.set$({captionTxt:t.caption||"",msgTxt:t.text||"",iconName:t.isError?"error":"info"}),t.isError?this.setAttribute("error",""):this.removeAttribute("error")):this.removeAttribute("active")})}};At.template=`<div class="heading"><lr-icon set="@name: iconName"></lr-icon><div class="caption">{{captionTxt}}</div><button type="button" set="onclick: onClose"><lr-icon name="close"></lr-icon></button></div><div class="msg">{{msgTxt}}</div>`;var wt=class extends D{constructor(){super(...arguments);c(this,"historyTracked",!0);c(this,"activityType",T.activities.UPLOAD_LIST);c(this,"init$",{...this.ctxInit,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,headerText:"",hasFiles:!1,onAdd:()=>{this.initFlow(!0)},onUpload:()=>{this.$["*uploadTrigger"]={},this._updateUploadsState()},onDone:()=>{this.doneFlow()},onCancel:()=>{let t=this.getOutputData(s=>!!s.getValue("uuid"));w.emit(new O({type:x.REMOVE,ctx:this.ctxName,data:t})),this.uploadCollection.clearAll()}});c(this,"cssInit$",{"--cfg-multiple":1,"--cfg-multiple-min":0,"--cfg-multiple-max":0});c(this,"_debouncedHandleCollectionUpdate",W(()=>{this.isConnected&&(this._updateUploadsState(),this._updateCountLimitMessage())},0))}_validateFilesCount(){var h,d;let t=!!this.getCssData("--cfg-multiple"),s=t?(h=this.getCssData("--cfg-multiple-min"))!=null?h:0:1,r=t?(d=this.getCssData("--cfg-multiple-max"))!=null?d:0:1,n=this.uploadCollection.size,o=s?n<s:!1,a=r?n>r:!1;return{passed:!o&&!a,tooFew:o,tooMany:a,min:s,max:r,exact:r===n}}_updateCountLimitMessage(){let t=this.uploadCollection.size,s=this._validateFilesCount();if(t&&!s.passed){let r=new gt,n=s.tooFew?"files-count-limit-error-too-few":"files-count-limit-error-too-many";r.caption=this.l10n("files-count-limit-error-title"),r.text=this.l10n(n,{min:s.min,max:s.max,total:t}),r.isError=!0,this.set$({"*message":r})}}_updateUploadsState(){let t=this.uploadCollection.items(),r={total:t.length,succeed:0,uploading:0,failed:0};for(let p of t){let f=this.uploadCollection.read(p);f.getValue("uuid")&&!f.getValue("validationErrorMsg")&&(r.succeed+=1),f.getValue("isUploading")&&(r.uploading+=1),(f.getValue("validationErrorMsg")||f.getValue("uploadError"))&&(r.failed+=1)}let n=r.total===r.succeed+r.failed,{passed:o,tooMany:a,exact:l}=this._validateFilesCount(),u=r.failed===0,h=r.total>0&&o&&u,d=!n&&r.total-r.succeed-r.uploading-r.failed>0&&o;this.set$({doneBtnVisible:n,doneBtnEnabled:h,uploadBtnVisible:d,addMoreBtnEnabled:r.total===0||!a&&!l,addMoreBtnVisible:!l||this.getCssData("--cfg-multiple"),headerText:this._getHeaderText(r)})}_getHeaderText(t){let s=r=>{let n=t[r];return this.l10n(`header-${r}`,{count:n})};return t.uploading>0?s("uploading"):t.failed>0?s("failed"):t.succeed>0?s("succeed"):s("total")}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.sub("--cfg-multiple",this._debouncedHandleCollectionUpdate),this.sub("--cfg-multiple-min",this._debouncedHandleCollectionUpdate),this.sub("--cfg-multiple-max",this._debouncedHandleCollectionUpdate),this.sub("*currentActivity",t=>{var s;((s=this.uploadCollection)==null?void 0:s.size)===0&&!this.getCssData("--cfg-show-empty-list")&&t===this.activityType&&(this.$["*currentActivity"]=this.initActivity)}),this.uploadCollection.observe(this._debouncedHandleCollectionUpdate),this.sub("*uploadList",t=>{this._debouncedHandleCollectionUpdate(),this.set$({hasFiles:t.length>0}),(t==null?void 0:t.length)===0&&!this.getCssData("--cfg-show-empty-list")&&this.historyBack()})}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserve(this._debouncedHandleCollectionUpdate)}};wt.template=`<lr-activity-header><span class="header-text">{{headerText}}</span><button type="button" class="mini-btn close-btn" set="onclick: *closeModal"><lr-icon name="close"></lr-icon></button></lr-activity-header><div class="no-files" set="@hidden: hasFiles"><slot name="empty"><span l10n="no-files"></span></slot></div><div class="files" repeat="*uploadList" repeat-item-tag="lr-file-item"></div><div class="toolbar"><button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel;" l10n="clear"></button><div class="toolbar-spacer"></div><button type="button" class="add-more-btn secondary-btn" set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible" ><lr-icon name="add"></lr-icon><span l10n="add-more"></span></button><button type="button" class="upload-btn primary-btn" set="@hidden: !uploadBtnVisible; onclick: onUpload;" l10n="upload" ></button><button type="button" class="done-btn primary-btn" set="@hidden: !doneBtnVisible; onclick: onDone; @disabled: !doneBtnEnabled" l10n="done" ></button></div><lr-drop-area ghost></lr-drop-area>`;function ti(e,i=40){if(e.type==="image/svg+xml")return URL.createObjectURL(e);let t=document.createElement("canvas"),s=t.getContext("2d"),r=new Image,n=new Promise((o,a)=>{r.onload=()=>{let l=r.height/r.width;l>1?(t.width=i,t.height=i*l):(t.height=i,t.width=i/l),s.fillStyle="rgb(240, 240, 240)",s.fillRect(0,0,t.width,t.height),s.drawImage(r,0,0,t.width,t.height),t.toBlob(u=>{if(!u){a();return}let h=URL.createObjectURL(u);o(h)})},r.onerror=l=>{a(l)}});return r.src=URL.createObjectURL(e),n}function Ls(e){let i=new Blob([e],{type:"image/svg+xml"});return URL.createObjectURL(i)}function be(e="hsl(209, 21%, 65%)",i=32,t=32){return Ls(`<svg width="${i}" height="${t}" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" fill="${e}" d="M9.68848 8.70068C9.68848 8.42454 9.91233 8.20068 10.1885 8.20068H15.0885C15.2211 8.20068 15.3483 8.25336 15.442 8.34713L20.342 13.2471C20.4358 13.3409 20.4885 13.4681 20.4885 13.6007V21.3007C20.4885 21.5768 20.2646 21.8007 19.9885 21.8007H10.1885C9.91233 21.8007 9.68848 21.5768 9.68848 21.3007V8.70068ZM10.6885 9.20068V20.8007H19.4885V14.1007L15.0885 14.1007C14.8123 14.1007 14.5885 13.8768 14.5885 13.6007L14.5885 9.20068H10.6885ZM15.5885 9.90779L18.7814 13.1007L15.5885 13.1007L15.5885 9.90779Z"/></svg>`)}var Ps=e=>{if(typeof e!="string"||!e)return"";let i=e.trim();return i.startsWith("-/")?i=i.slice(2):i.startsWith("/")&&(i=i.slice(1)),i.endsWith("/")&&(i=i.slice(0,i.length-1)),i},Ns=(...e)=>e.filter(i=>typeof i=="string"&&i).map(i=>Ps(i)).join("/-/"),ei=(...e)=>{let i=Ns(...e);return i?`-/${i}/`:""};function ii(e){let i=new URL(e),t=i.pathname+i.search+i.hash,s=t.lastIndexOf("http"),r=t.lastIndexOf("/"),n="";return s>=0?n=t.slice(s):r>=0&&(n=t.slice(r+1)),n}function Ms(e){let i=new URL(e),t=ii(e),s=si(t)?ri(t).pathname:t;return i.pathname=i.pathname.replace(s,""),i.search="",i.hash="",i.toString()}function si(e){return e.startsWith("http")}function ri(e){let i=new URL(e);return{pathname:i.origin+i.pathname||"",search:i.search||"",hash:i.hash||""}}var ni=(e,i,t)=>{let s=new URL(Ms(e));if(t=t||ii(e),s.pathname.startsWith("//")&&(s.pathname=s.pathname.replace("//","/")),si(t)){let r=ri(t);s.pathname=s.pathname+(i||"")+(r.pathname||""),s.search=r.search,s.hash=r.hash}else s.pathname=s.pathname+(i||"")+(t||"");return s.toString()},oi=(e,i)=>{let t=new URL(e);return t.pathname=i+"/",t.toString()};var M=Object.freeze({FINISHED:Symbol(0),FAILED:Symbol(1),UPLOADING:Symbol(2),IDLE:Symbol(3)}),B=class extends D{constructor(){super(...arguments);c(this,"pauseRender",!0);c(this,"_entrySubs",new Set);c(this,"_entry",null);c(this,"_isIntersecting",!1);c(this,"_debouncedGenerateThumb",W(this._generateThumbnail.bind(this),100));c(this,"_debouncedCalculateState",W(this._calculateState.bind(this),100));c(this,"_renderedOnce",!1);c(this,"cssInit$",{"--cfg-use-cloud-image-editor":0});c(this,"init$",{...this.ctxInit,uid:"",itemName:"",errorText:"",thumbUrl:"",progressValue:0,progressVisible:!1,progressUnknown:!1,badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,isEditable:!1,state:M.IDLE,"*uploadTrigger":null,onEdit:()=>{this.set$({"*focusedEntry":this._entry}),this.findBlockInCtx(t=>t.activityType===T.activities.DETAILS)?this.$["*currentActivity"]=T.activities.DETAILS:this.$["*currentActivity"]=T.activities.CLOUD_IMG_EDIT},onRemove:()=>{let t=this._entry.getValue("uuid");if(t){let s=this.getOutputData(r=>r.getValue("uuid")===t);w.emit(new O({type:x.REMOVE,ctx:this.ctxName,data:s}))}this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}})}_reset(){for(let t of this._entrySubs)t.remove();this._debouncedGenerateThumb.cancel(),this._entrySubs=new Set,this._entry=null,this._isIntersecting=!1}_observerCallback(t){let[s]=t;this._isIntersecting=s.isIntersecting,s.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0),s.intersectionRatio===0?this._debouncedGenerateThumb.cancel():this._debouncedGenerateThumb()}_calculateState(){if(!this._entry)return;let t=this._entry,s=M.IDLE;t.getValue("uploadError")||t.getValue("validationErrorMsg")?s=M.FAILED:t.getValue("isUploading")?s=M.UPLOADING:t.getValue("uuid")&&(s=M.FINISHED),this.$.state!==s&&(this.$.state=s)}async _generateThumbnail(){var s;if(!this._entry)return;let t=this._entry;if(t.getValue("uuid")&&t.getValue("isImage")){let r=this.getCssData("--cfg-thumb-size")||76,n=this.proxyUrl(ni(oi(this.getCssData("--cfg-cdn-cname"),this._entry.getValue("uuid")),ei(t.getValue("cdnUrlModifiers"),`scale_crop/${r}x${r}/center`))),o=t.getValue("thumbUrl");o!==n&&(t.setValue("thumbUrl",n),o.startsWith("blob:")&&URL.revokeObjectURL(o));return}if(!t.getValue("thumbUrl"))if((s=t.getValue("file"))!=null&&s.type.includes("image"))try{let r=await ti(t.getValue("file"),this.getCssData("--cfg-thumb-size")||76);t.setValue("thumbUrl",r)}catch{let n=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",be(n))}else{let r=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");t.setValue("thumbUrl",be(r))}}_showMessage(t,s,r){let n=new gt;n.caption=s,n.text=r,n.isError=t==="error",this.set$({badgeIcon:`badge-${t}`,"*message":n})}_subEntry(t,s){let r=this._entry.subscribe(t,n=>{this.isConnected&&s(n)});this._entrySubs.add(r)}_handleEntryId(t){var r;this._reset();let s=(r=this.uploadCollection)==null?void 0:r.read(t);this._entry=s,s&&(this._subEntry("validationErrorMsg",n=>{this._debouncedCalculateState(),this.$.errorText=n}),this._subEntry("uploadError",n=>{this._debouncedCalculateState(),this.$.errorText=n==null?void 0:n.message}),this._subEntry("isUploading",()=>{this._debouncedCalculateState()}),this._subEntry("uploadProgress",n=>{this.$.progressValue=n}),this._subEntry("fileName",n=>{this.$.itemName=n||s.getValue("externalUrl")||this.l10n("file-no-name")}),this._subEntry("fileSize",n=>{let o=this.getCssData("--cfg-max-local-file-size-bytes");o&&n&&n>o&&s.setValue("validationErrorMsg",this.l10n("files-max-size-limit-error",{maxFileSize:o}))}),this._subEntry("mimeType",n=>{if(!n)return;let o=this.getCssData("--cfg-img-only"),a=this.getCssData("--cfg-accept"),l=Nt([...o?ct:[],a]);l.length>0&&!se(n,l)&&s.setValue("validationErrorMsg",this.l10n("file-type-not-allowed"))}),this._subEntry("isImage",n=>{let o=this.getCssData("--cfg-img-only");s.getValue("externalUrl")&&!s.getValue("uuid")&&o&&!n||o&&!n&&s.setValue("validationErrorMsg",this.l10n("images-only-accepted"))}),this._subEntry("externalUrl",n=>{this.$.itemName=s.getValue("fileName")||n||this.l10n("file-no-name")}),this._subEntry("uuid",n=>{this._debouncedCalculateState(),n&&this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("cdnUrlModifiers",()=>{this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("thumbUrl",n=>{this.$.thumbUrl=n?`url(${n})`:""}),this.getCssData("--cfg-confirm-upload")||this.upload(),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.sub("uid",t=>{this._handleEntryId(t)}),this.sub("state",t=>{this._handleState(t)}),this.sub("--cfg-use-cloud-image-editor",()=>{this._handleState(this.$.state)}),this.onclick=()=>{B.activeInstances.forEach(t=>{t===this?t.setAttribute("focused",""):t.removeAttribute("focused")})},this.$["*uploadTrigger"]=null,this.sub("*uploadTrigger",t=>{!t||!this.isConnected||this.upload()}),B.activeInstances.add(this)}_handleState(t){var s;this.set$({isFailed:t===M.FAILED,isUploading:t===M.UPLOADING,isFinished:t===M.FINISHED,progressVisible:t===M.UPLOADING,isEditable:this.$["--cfg-use-cloud-image-editor"]&&t===M.FINISHED&&((s=this._entry)==null?void 0:s.getValue("isImage"))}),t===M.FAILED?this.$.badgeIcon="badge-error":t===M.FINISHED&&(this.$.badgeIcon="badge-success"),t===M.UPLOADING?this.$.isFocused=!1:this.$.progressValue=0}destroyCallback(){super.destroyCallback(),B.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){var t;super.disconnectedCallback(),this._debouncedGenerateThumb.cancel(),(t=this._observer)==null||t.disconnect()}async upload(){let t=this._entry;if(t.getValue("uuid")||t.getValue("isUploading")||t.getValue("validationErrorMsg"))return;let s=this.getOutputData(r=>!r.getValue("uuid"));w.emit(new O({type:x.UPLOAD_START,ctx:this.ctxName,data:s})),this._debouncedCalculateState(),t.setValue("isUploading",!0),t.setValue("uploadError",null),t.setValue("validationErrorMsg",null),!t.getValue("file")&&t.getValue("externalUrl")&&(this.$.progressUnknown=!0);try{let r=new AbortController;t.setValue("abortController",r);let n=await me(t.getValue("file")||t.getValue("externalUrl"),{...this.getUploadClientOptions(),fileName:t.getValue("fileName"),onProgress:o=>{if(o.isComputable){let a=o.value*100;t.setValue("uploadProgress",a)}this.$.progressUnknown=!o.isComputable},signal:r.signal});t.setMultipleValues({fileInfo:n,isUploading:!1,fileName:n.name,fileSize:n.size,isImage:n.isImage,mimeType:n.mimeType,uuid:n.uuid,cdnUrl:n.cdnUrl}),t===this._entry&&this._debouncedCalculateState()}catch(r){t.setMultipleValues({abortController:null,isUploading:!1,uploadProgress:0}),t===this._entry&&this._debouncedCalculateState(),r!=null&&r.isCancel||t.setValue("uploadError",r)}}};B.template=`<div class="inner" set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @focused: isFocused"><div class="thumb" set="style.backgroundImage: thumbUrl"><div class="badge"><lr-icon set="@name: badgeIcon"></lr-icon></div></div><div class="file-name-wrapper"><span class="file-name" set="@title: itemName">{{itemName}}</span><span class="file-error" set="@hidden: !errorText">{{errorText}}</span></div><div class="file-actions"><button type="button" class="edit-btn mini-btn" set="onclick: onEdit; @hidden: !isEditable"><lr-icon name="edit-file"></lr-icon></button><button type="button" class="remove-btn mini-btn" set="onclick: onRemove;"><lr-icon name="remove-file"></lr-icon></button><button type="button" class="upload-btn mini-btn" set="onclick: onUpload;"><lr-icon name="upload"></lr-icon></button></div><lr-progress-bar class="progress-bar" set="value: progressValue; visible: progressVisible; unknown: progressUnknown" ></lr-progress-bar></div>`;B.activeInstances=new Set;var _t=class extends R{constructor(){super(...arguments);c(this,"init$",{...this.ctxInit,name:"",path:"",size:"24",viewBox:""})}initCallback(){super.initCallback(),this.sub("name",t=>{if(!t)return;let s=this.getCssData(`--icon-${t}`);s&&(this.$.path=s)}),this.sub("path",t=>{if(!t)return;t.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=t):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path fill-rule="evenodd" d="${t}"></path>`)}),this.sub("size",t=>{this.$.viewBox=`0 0 ${t} ${t}`})}};_t.template=`<svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>`;_t.bindAttributes({name:"name",size:"size"});var xt=class extends R{constructor(){super(...arguments);c(this,"_value",0);c(this,"_unknownMode",!1);c(this,"init$",{...this.ctxInit,width:0,opacity:0})}initCallback(){super.initCallback(),this.defineAccessor("value",t=>{t!==void 0&&(this._value=t,this._unknownMode||this.style.setProperty("--l-width",this._value.toString()))}),this.defineAccessor("visible",t=>{this.ref.line.classList.toggle("progress--hidden",!t)}),this.defineAccessor("unknown",t=>{this._unknownMode=t,this.ref.line.classList.toggle("progress--unknown",t)})}};xt.template='<div ref="line" class="progress"></div>';var St=class extends R{constructor(){super(...arguments);c(this,"cssInit$",{"--cfg-remove-copyright":0});c(this,"init$",{...this.ctxInit,removeCopyright:!1})}initCallback(){super.initCallback(),this.sub("--cfg-remove-copyright",t=>{this.$.removeCopyright=!!t})}};c(St,"template",`<a href="https://uploadcare.com/?utm_source=copyright&utm_medium=referral&utm_campaign=v4" target="_blank noopener" class="credits" set="@hidden: removeCopyright" >Powered by Uploadcare</a >`);var nt=class extends D{constructor(){super(...arguments);c(this,"processInnerHtml",!0);c(this,"init$",{...this.ctxInit,output:null,filesData:null});c(this,"cssInit$",{"--cfg-group-output":0})}get dict(){return nt.dict}get validationInput(){return this._validationInputElement}initCallback(){if(super.initCallback(),this.hasAttribute(this.dict.FORM_INPUT_ATTR)&&(this._dynamicInputsContainer=document.createElement("div"),this.appendChild(this._dynamicInputsContainer),this.hasAttribute(this.dict.INPUT_REQUIRED))){let t=document.createElement("input");t.type="text",t.name="__UPLOADCARE_VALIDATION_INPUT__",t.required=!0,this.appendChild(t),this._validationInputElement=t}this.sub("output",t=>{if(t){if(this.hasAttribute(this.dict.FIRE_EVENT_ATTR)&&this.dispatchEvent(new CustomEvent(this.dict.EVENT_NAME,{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),ctxName:this.ctxName,data:t}})),this.hasAttribute(this.dict.FORM_INPUT_ATTR)){this._dynamicInputsContainer.innerHTML="";let s=t.groupData?[t.groupData.cdnUrl]:t.map(r=>r.cdnUrl);for(let r of s){let n=document.createElement("input");n.type="hidden",n.name=this.getAttribute(this.dict.INPUT_NAME_ATTR)||this.ctxName,n.value=r,this._dynamicInputsContainer.appendChild(n)}this.hasAttribute(this.dict.INPUT_REQUIRED)&&(this._validationInputElement.value=s.length?"__VALUE__":"")}this.hasAttribute(this.dict.CONSOLE_ATTR)&&console.log(t)}},!1),this.sub(this.dict.SRC_CTX_KEY,async t=>{if(!t){this.$.output=null,this.$.filesData=null;return}if(this.$.filesData=t,this.getCssData("--cfg-group-output")||this.hasAttribute(this.dict.GROUP_ATTR)){let s=t.map(n=>n.uuid),r=await We(s,{...this.getUploadClientOptions()});this.$.output={groupData:r,files:t}}else this.$.output=t},!1)}};nt.dict={SRC_CTX_KEY:"*outputData",EVENT_NAME:"lr-data-output",FIRE_EVENT_ATTR:"use-event",CONSOLE_ATTR:"use-console",GROUP_ATTR:"use-group",FORM_INPUT_ATTR:"use-input",INPUT_NAME_ATTR:"input-name",INPUT_REQUIRED:"input-required"};ye({FileUploaderMinimal:Tt,StartFrom:Pt,DropArea:mt,UploadList:wt,FileItem:B,Icon:_t,ProgressBar:xt,MessageBox:At,Copyright:St,DataOutput:nt});export{St as Copyright,nt as DataOutput,mt as DropArea,B as FileItem,Tt as FileUploaderMinimal,_t as Icon,At as MessageBox,xt as ProgressBar,Pt as StartFrom,wt as UploadList,ye as registerBlocks};